(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{314:(e,t,s)=>{"use strict";s.d(t,{eu:()=>n,oY:()=>l});var a=s(1521);class i{startTimer(e){this.timers.set(e,performance.now())}endTimer(e,t,s){let a=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,n=this.timers.get(e);if(!n)return console.warn("Timer ".concat(e," not found")),0;let l=performance.now()-n;this.timers.delete(e);let c={timestamp:new Date().toISOString(),component:t,operation:s,duration_ms:Math.round(l),success:a,error_msg:i,metadata:r};return this.metrics.push(c),this.metrics.length>1e3&&(this.metrics=this.metrics.slice(-500)),l}recordInstantMetric(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,r={timestamp:new Date().toISOString(),component:e,operation:t,duration_ms:0,success:s,error_msg:a,metadata:i};this.metrics.push(r)}getFormData(e){return this.formData.has(e)||this.formData.set(e,{loadTime:0,validationTimes:{},submissionTimes:[],errorCount:0,interactionCount:0,fieldFocusCount:{},totalOperations:0}),this.formData.get(e)}updateFormData(e,t){let s=this.getFormData(e);this.formData.set(e,{...s,...t})}getMetrics(){return[...this.metrics]}getFormMetrics(e){return this.getFormData(e)}exportMetrics(){return JSON.stringify({timestamp:new Date().toISOString(),metrics:this.metrics,formData:Object.fromEntries(this.formData)},null,2)}constructor(){this.metrics=[],this.timers=new Map,this.formData=new Map}}let r=new i;function n(e){(0,a.useRef)(e),(0,a.useRef)(r.getFormData(e)),(0,a.useEffect)(()=>(r.recordInstantMetric(e,"component_mount",!0),()=>{r.recordInstantMetric(e,"component_unmount",!0)}),[e]);let t=(0,a.useCallback)(t=>{r.startTimer("".concat(e,"_").concat(t))},[e]),s=(0,a.useCallback)(function(t,s){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,l=r.endTimer("".concat(e,"_").concat(t),e,s,a,i,n),c=r.getFormData(e);return r.updateFormData(e,{totalOperations:c.totalOperations+1}),l},[e]),i=(0,a.useCallback)((t,s,a)=>{r.recordInstantMetric(e,"interaction_".concat(t),!0,void 0,{fieldId:s,...a});let i=r.getFormData(e),n={interactionCount:i.interactionCount+1};s&&"focus"===t&&(n.fieldFocusCount={...i.fieldFocusCount,[s]:(i.fieldFocusCount[s]||0)+1}),r.updateFormData(e,n)},[e]),n=(0,a.useCallback)((t,s,a)=>{r.recordInstantMetric(e,s,!1,t,a);let i=r.getFormData(e);r.updateFormData(e,{errorCount:i.errorCount+1})},[e]),l=(0,a.useCallback)((t,s,a,i)=>{r.recordInstantMetric(e,"validation_".concat(t),a,i,{duration:s,fieldId:t});let n={...r.getFormData(e).validationTimes};n[t]||(n[t]=[]),n[t].push(s),n[t].length>50&&(n[t]=n[t].slice(-25)),r.updateFormData(e,{validationTimes:n})},[e]),c=(0,a.useCallback)((t,s,a,i)=>{r.recordInstantMetric(e,"form_submission",s,a,{duration:t,...i});let n=[...r.getFormData(e).submissionTimes,t];n.length>20&&n.splice(0,n.length-10),r.updateFormData(e,{submissionTimes:n})},[e]),o=(0,a.useCallback)(t=>{r.recordInstantMetric(e,"form_load",!0,void 0,{duration:t}),r.updateFormData(e,{loadTime:t})},[e]),d=(0,a.useCallback)(()=>r.getMetrics().filter(t=>t.component===e),[e]);return{startTimer:t,endTimer:s,recordInteraction:i,recordError:n,recordValidation:l,recordSubmission:c,recordFormLoad:o,getMetrics:d,getFormMetrics:(0,a.useCallback)(()=>r.getFormMetrics(e),[e]),exportMetrics:(0,a.useCallback)(()=>r.exportMetrics(),[])}}let l={measureAsync:async(e,t,s,a)=>{let i=performance.now();try{let n=await e(),l=performance.now()-i;return r.recordInstantMetric(t,s,!0,void 0,{duration:l,...a}),{result:n,duration:l}}catch(n){let e=performance.now()-i;throw r.recordInstantMetric(t,s,!1,String(n),{duration:e,...a}),n}},measureSync:(e,t,s,a)=>{let i=performance.now();try{let n=e(),l=performance.now()-i;return r.recordInstantMetric(t,s,!0,void 0,{duration:l,...a}),{result:n,duration:l}}catch(n){let e=performance.now()-i;throw r.recordInstantMetric(t,s,!1,String(n),{duration:e,...a}),n}}}},740:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m});var a=s(1521);let i=0,r=new Map,n=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},l=[],c={toasts:[]};function o(e){c=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?n(s):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(c,e),l.forEach(e=>{e(c)})}function d(e){let{...t}=e,s=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString();return o({type:"ADD_TOAST",toast:{...t,id:s}}),{id:s,dismiss:()=>o({type:"DISMISS_TOAST",toastId:s}),update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(c);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},1305:(e,t,s)=>{"use strict";s.d(t,{N:()=>r});var a=s(7075);let i=null,r=new Proxy({},{get:(e,t)=>(function(){if(!i){let e="https://hnrysjrydbhrnqqkrqir.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhucnlzanJ5ZGJocm5xcWtycWlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4Mjg4MjUsImV4cCI6MjA2OTQwNDgyNX0.5C1YFb1VgjNC-clfDY1U_ojDGJCZhO-ckCtlULk2IcI";if(!e||!t)throw Error("Missing Supabase environment variables");i=(0,a.UU)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1}})}return i})()[t]})},1848:(e,t,s)=>{Promise.resolve().then(s.bind(s,9620))},8405:(e,t,s)=>{"use strict";s.r(t),s.d(t,{performanceMonitor:()=>l,performanceUtils:()=>r.oY,usePerformanceMonitor:()=>c,usePerformanceMonitorHook:()=>r.eu});class a{register(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;this.hooks.has(e)||this.hooks.set(e,[]);let a=this.hooks.get(e);return a.push({handler:t,priority:s}),a.sort((e,t)=>e.priority-t.priority),()=>{let e=a.findIndex(e=>e.handler===t);e>-1&&a.splice(e,1)}}async execute(e){for(var t=arguments.length,s=Array(t>1?t-1:0),a=1;a<t;a++)s[a-1]=arguments[a];let i=this.hooks.get(e)||[];if(["beforeQuery","beforeMutation","transformInput","transformOutput"].includes(e))return i.reduce(async(e,t)=>{let{handler:a}=t,i=await e;return a(s[0],s[1],i)},Promise.resolve(s[2]||s[1]));if(["afterQuery","afterMutation"].includes(e))return i.reduce(async(e,t)=>{let{handler:a}=t,i=await e;return a(s[0],s[1],i)},Promise.resolve(s[2]));if(["canRead","canWrite"].includes(e)){for(let{handler:e}of i)if(!await e(...s))return!1;return!0}if("onError"===e){for(let{handler:e}of i){let t=await e(...s);if(null!==t)return t}return null}if(["getCacheKey","shouldCache","shouldRetry"].includes(e))return i.length>0?i[0].handler(...s):void 0;await Promise.all(i.map(e=>{let{handler:t}=e;return t(...s)}))}async getFromCache(e){let t=this.cache.get(e);if(!t)return void await this.execute("onCacheMiss",e);if(Date.now()>t.timestamp+t.ttl){this.cache.delete(e),await this.execute("onCacheMiss",e);return}return await this.execute("onCacheHit",e,t.data),t.data}setCache(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e5;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}invalidateCache(e){for(let t of this.cache.keys())t.includes(e)&&this.cache.delete(t)}constructor(){this.hooks=new Map,this.cache=new Map}}let i=new a;var r=s(314);class n{initializeServiceHooks(){let e=new Map;i.register("onQueryStart",(t,s)=>{let a="".concat(t,":").concat(s,":").concat(Date.now());e.set(a,Date.now())},1),i.register("onQueryEnd",(e,t,s)=>{this.addMetric({queryDuration:s,tableName:e,operation:t,timestamp:Date.now()}),s>1e3&&(console.warn("[PERF] Slow query detected: ".concat(e,".").concat(t," took ").concat(s,"ms")),this.reportSlowQuery(e,t,s))},1)}initializeWebVitals(){s.e(651).then(s.bind(s,4651)).then(e=>{let{getCLS:t,getFID:s,getFCP:a,getLCP:i,getTTFB:r}=e;t(this.handleWebVital.bind(this)),s(this.handleWebVital.bind(this)),a(this.handleWebVital.bind(this)),i(this.handleWebVital.bind(this)),r(this.handleWebVital.bind(this))}).catch(()=>{this.initializeBasicPerformanceTracking()})}initializeBasicPerformanceTracking(){if(window.performance&&(window.addEventListener("load",()=>{let e=performance.now();this.addWebVital({name:"page-load",value:e,rating:e<2500?"good":e<4e3?"needs-improvement":"poor",delta:e,id:"page-load-"+Date.now(),timestamp:Date.now()})}),"PerformanceObserver"in window))try{new PerformanceObserver(e=>{for(let t of e.getEntries())"first-contentful-paint"===t.name&&this.addWebVital({name:"FCP",value:t.startTime,rating:t.startTime<1800?"good":t.startTime<3e3?"needs-improvement":"poor",delta:t.startTime,id:"fcp-"+Date.now(),timestamp:Date.now()})}).observe({entryTypes:["paint"]})}catch(e){}}handleWebVital(e){this.addWebVital({name:e.name,value:e.value,rating:e.rating,delta:e.delta,id:e.id,timestamp:Date.now()}),"poor"===e.rating&&console.warn("[WEB-VITALS] Poor ".concat(e.name,": ").concat(e.value))}addMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&(this.metrics=this.metrics.slice(-this.maxMetrics))}addWebVital(e){this.webVitals.push(e),this.webVitals.length>this.maxMetrics&&(this.webVitals=this.webVitals.slice(-this.maxMetrics))}reportSlowQuery(e,t,s){window.gtag&&window.gtag("event","slow_query",{table_name:e,operation:t,duration:s,custom_map:{metric1:"query_performance"}})}getMetrics(e){return e?this.metrics.filter(t=>t.timestamp>=e):[...this.metrics]}getWebVitals(){return[...this.webVitals]}getSlowQueries(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.metrics.filter(t=>t.queryDuration>=e)}getAverageQueryTime(e,t){let s=this.metrics;return(e&&(s=s.filter(t=>t.tableName===e)),t&&(s=s.filter(e=>e.operation===t)),0===s.length)?0:s.reduce((e,t)=>e+t.queryDuration,0)/s.length}getPerformanceSummary(){let e=this.getSlowQueries(),t=this.webVitals.filter(e=>"poor"===e.rating);return{totalQueries:this.metrics.length,slowQueries:e.length,averageQueryTime:this.getAverageQueryTime(),poorWebVitals:t.length,lastUpdated:new Date().toISOString()}}clear(){this.metrics=[],this.webVitals=[]}constructor(){this.metrics=[],this.webVitals=[],this.maxMetrics=1e3,this.initializeServiceHooks(),this.initializeWebVitals()}}let l=new n;function c(){return{getMetrics:l.getMetrics.bind(l),getWebVitals:l.getWebVitals.bind(l),getSlowQueries:l.getSlowQueries.bind(l),getAverageQueryTime:l.getAverageQueryTime.bind(l),getPerformanceSummary:l.getPerformanceSummary.bind(l)}}},9620:(e,t,s)=>{"use strict";let a;s.r(t),s.d(t,{default:()=>tS});var i=s(3365),r=s(1521),n=s(9671),l=s(9095),c=s(5230),o=s(2990),d=s(2833),m=s(2991),u=s(9394),p=s(2028),h=s(7216),_=s(3697),x=s(6414),f=s(2109),y=s(7460),j=s(2196),g=s(875),v=s(3149),b=s(6209),N=s(1305);class k{async getClient(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],N.N}handleError(e){var t,s;return(console.error("Service error:",e),(null==(t=e.message)?void 0:t.includes("JWT"))||(null==(s=e.message)?void 0:s.includes("auth")))?{message:"Authentication error - please try signing in",code:e.code||"AUTH_ERROR"}:e.code&&e.message?{message:e.message,code:e.code,details:e.details,hint:e.hint}:e instanceof Error?{message:e.message}:{message:"An unexpected error occurred"}}async createResponse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return arguments.length>2&&void 0!==arguments[2]&&arguments[2],{data:e,error:(null==t?void 0:t.message)||null,success:null===t}}createResponseSync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{data:e,error:(null==t?void 0:t.message)||null,success:null===t}}get supabase(){return N.N}}class w extends k{async getAll(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=(await this.getClient({fallbackToAnon:!0})).from("departments").select("*").order("name",{ascending:!0});e&&(t=t.eq("is_active",!0));let{data:s,error:a}=await t;if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s||[])}catch(e){return this.createResponseSync(null,this.handleError(e))}}async getById(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("departments").select("*").eq("department_id",e).single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async create(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("departments").insert([e]).select().single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async update(e,t){try{let s=await this.getClient({fallbackToAnon:!0}),{data:a,error:i}=await s.from("departments").update(t).eq("department_id",e).select().single();if(i)return this.createResponseSync(null,this.handleError(i));return this.createResponseSync(a)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async delete(e){try{let t=await this.getClient({fallbackToAnon:!0}),{error:s}=await t.from("departments").delete().eq("department_id",e);if(s)return this.createResponseSync(null,this.handleError(s));return this.createResponseSync(null)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async toggleActive(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("departments").select("is_active").eq("department_id",e).single();if(a)return this.createResponseSync(null,this.handleError(a));let{data:i,error:r}=await t.from("departments").update({is_active:!s.is_active}).eq("department_id",e).select().single();if(r)return this.createResponseSync(null,this.handleError(r));return this.createResponseSync(i)}catch(e){return this.createResponseSync(null,this.handleError(e))}}}let S=new w;class C extends k{async getAll(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=(await this.getClient({fallbackToAnon:!0})).from("job_optimized_patterns").select("*").order("name",{ascending:!0});e&&(t=t.eq("is_active",!0));let{data:s,error:a}=await t;if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s||[])}catch(e){return this.createResponseSync(null,this.handleError(e))}}async getById(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("job_optimized_patterns").select("*").eq("pattern_id",e).single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async create(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("job_optimized_patterns").insert([e]).select().single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async update(e,t){try{let s=await this.getClient({fallbackToAnon:!0}),{data:a,error:i}=await s.from("job_optimized_patterns").update(t).eq("pattern_id",e).select().single();if(i)return this.createResponseSync(null,this.handleError(i));return this.createResponseSync(a)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async delete(e){try{let t=await this.getClient({fallbackToAnon:!0}),{error:s}=await t.from("job_optimized_patterns").delete().eq("pattern_id",e);if(s)return this.createResponseSync(null,this.handleError(s));return this.createResponseSync(null)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async validateSolverParameters(e){try{if("object"!=typeof e||null===e||Array.isArray(e))return this.createResponseSync(null,{message:"Solver parameters must be a JSON object"});let t=["__proto__","constructor","prototype"];for(let s of Object.keys(e))if(t.includes(s)||"string"!=typeof s)return this.createResponseSync(null,{message:"Invalid property names in solver parameters"});let s=["max_preprocessing_time","search_strategy","num_search_workers","use_fast_restart","cp_model_probing_level","max_time_in_seconds","linearization_level","search_branching","cp_model_presolve","repair_hint"];for(let t of Object.keys(e))s.includes(t)||console.warn("Unknown solver parameter: ".concat(t));return this.createResponseSync(!0)}catch(e){return this.createResponseSync(null,this.handleError(e))}}}let E=new C;class T extends k{async getAll(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=(await this.getClient({fallbackToAnon:!0})).from("work_cells").select("*").order("name",{ascending:!0});e&&(t=t.eq("is_active",!0));let{data:s,error:a}=await t;if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s||[])}catch(e){return this.createResponseSync(null,this.handleError(e))}}async getById(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("work_cells").select("*").eq("cell_id",e).single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async create(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("work_cells").insert([e]).select().single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async update(e,t){try{let s=await this.getClient({fallbackToAnon:!0}),{data:a,error:i}=await s.from("work_cells").update(t).eq("cell_id",e).select().single();if(i)return this.createResponseSync(null,this.handleError(i));return this.createResponseSync(a)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async delete(e){try{let t=await this.getClient({fallbackToAnon:!0}),{error:s}=await t.from("work_cells").delete().eq("cell_id",e);if(s)return this.createResponseSync(null,this.handleError(s));return this.createResponseSync(null)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async toggleActive(e){try{let{data:t,error:s}=await (await this.getClient({fallbackToAnon:!0})).from("work_cells").select("is_active").eq("cell_id",e).single();if(s)return this.createResponseSync(null,this.handleError(s));let a=await this.getClient({fallbackToAnon:!0}),{data:i,error:r}=await a.from("work_cells").update({is_active:!t.is_active}).eq("cell_id",e).select().single();if(r)return this.createResponseSync(null,this.handleError(r));return this.createResponseSync(i)}catch(e){return this.createResponseSync(null,this.handleError(e))}}}let F=new T;class q extends k{async getAll(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=(await this.getClient({fallbackToAnon:!0})).from("machines").select("*").order("name",{ascending:!0});e&&(t=t.eq("is_active",!0));let{data:s,error:a}=await t;if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s||[])}catch(e){return this.createResponseSync(null,this.handleError(e))}}async getById(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("machines").select("*").eq("machine_resource_id",e).single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async create(e){try{let t=await this.getClient({fallbackToAnon:!0}),{data:s,error:a}=await t.from("machines").insert([e]).select().single();if(a)return this.createResponseSync(null,this.handleError(a));return this.createResponseSync(s)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async update(e,t){try{let s=await this.getClient({fallbackToAnon:!0}),{data:a,error:i}=await s.from("machines").update(t).eq("machine_resource_id",e).select().single();if(i)return this.createResponseSync(null,this.handleError(i));return this.createResponseSync(a)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async delete(e){try{let t=await this.getClient({fallbackToAnon:!0}),{error:s}=await t.from("machines").delete().eq("machine_resource_id",e);if(s)return this.createResponseSync(null,this.handleError(s));return this.createResponseSync(null)}catch(e){return this.createResponseSync(null,this.handleError(e))}}async toggleActive(e){try{let{data:t,error:s}=await await this.getClient({fallbackToAnon:!0}).from("machines").select("is_active").eq("machine_resource_id",e).single();if(s)return this.createResponseSync(null,this.handleError(s));let a=await this.getClient({fallbackToAnon:!0}),{data:i,error:r}=await a.from("machines").update({is_active:!t.is_active}).eq("machine_resource_id",e).select().single();if(r)return this.createResponseSync(null,this.handleError(r));return this.createResponseSync(i)}catch(e){return this.createResponseSync(null,this.handleError(e))}}}let A=new q,M={};var I=s(4089);class z extends k{get solverBaseUrl(){return this._solverBaseUrl||(this._solverBaseUrl=I.env.NEXT_PUBLIC_SOLVER_API_URL||"http://localhost:8000"),this._solverBaseUrl}async healthCheck(){return this.handleRequest(async()=>{let e=await fetch("".concat(this.solverBaseUrl,"/api/v1/health"));if(!e.ok)throw Error("Health check failed: ".concat(e.status));let t=await e.json();return{healthy:"healthy"===t.status,patterns_available:t.patterns_available||0}})}async getAvailablePatterns(){return this.handleRequest(async()=>{let e=await fetch("".concat(this.solverBaseUrl,"/api/v1/patterns"));if(!e.ok)throw Error("Failed to fetch patterns: ".concat(e.status));let t=await e.json();if(!t.success)throw Error(t.error||"Failed to fetch patterns");return t.patterns||[]})}async solveProblem(e){return this.handleRequest(async()=>{this.validateJobRequest(e);let t=await fetch("".concat(this.solverBaseUrl,"/api/v1/solve"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Solver API error: ".concat(t.status," ").concat(t.statusText));return await t.json()})}async validateConstraintSystem(){return this.handleRequest(async()=>{var e,t,s,a,i,r,n,l,c;let o=await fetch("".concat(this.solverBaseUrl,"/api/v1/validate"));if(!o.ok)throw Error("Validation failed: ".concat(o.status));let d=await o.json();return{phase1:(null==(e=d.phase1)?void 0:e.success)||!1,phase2:(null==(t=d.phase2)?void 0:t.success)||!1,phase3:(null==(s=d.phase3)?void 0:s.success)||!1,errors:[...(null==(a=d.phase1)?void 0:a.success)?[]:["Phase 1: ".concat((null==(i=d.phase1)?void 0:i.error)||"Unknown error")],...(null==(r=d.phase2)?void 0:r.success)?[]:["Phase 2: ".concat((null==(n=d.phase2)?void 0:n.error)||"Unknown error")],...(null==(l=d.phase3)?void 0:l.success)?[]:["Phase 3: ".concat((null==(c=d.phase3)?void 0:c.error)||"Unknown error")]]}})}transformFormDataToSolverRequest(e,t,s,a){var i;let r={enable_setup_times:!0,enable_skill_matching:!0,enable_multi_objective:!0,max_overtime_hours:10,wip_limits:{}};e.forEach(e=>{e.department_id&&e.is_active&&(r.wip_limits[e.department_id]=5)});let n=a.map((e,t)=>({instance_id:e.id||e.instance_id||"job_".concat(t),description:e.description||"Job ".concat(e.id||t),due_date:e.due_date||new Date(Date.now()+864e5).toISOString(),priority:e.priority||100}));return{pattern_id:(null==(i=a[0])?void 0:i.pattern_id)||"default-pattern",instances:n,constraints:r}}async getJobStatus(e){return this.handleRequest(async()=>{let t=await fetch("".concat(this.solverBaseUrl,"/api/v1/status/").concat(e));if(!t.ok)throw Error("Failed to get job status: ".concat(t.status));return await t.json()})}validateJobRequest(e){if(!e.pattern_id)throw Error("Pattern ID is required");if(!e.instances||0===e.instances.length)throw Error("At least one job instance is required");for(let t of e.instances){if(!t.instance_id)throw Error("Instance ID is required for all instances");if(!t.due_date)throw Error("Due date is required for all instances");if(t.priority<1||t.priority>1e3)throw Error("Priority must be between 1 and 1000")}if(e.constraints&&e.constraints.max_overtime_hours&&(e.constraints.max_overtime_hours<0||e.constraints.max_overtime_hours>24))throw Error("Max overtime hours must be between 0 and 24")}async monitorSolverPerformance(e,t,s){try{await fetch("".concat(this.solverBaseUrl,"/api/v1/performance"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation:e,duration_ms:t,timestamp:new Date().toISOString(),metadata:s})})}catch(e){console.warn("Failed to record solver performance metrics:",e)}}async handleRequest(e){let t=Date.now();try{let s=await e(),a=Date.now()-t;return await this.monitorSolverPerformance("request",a),{data:s,error:null,success:!0}}catch(s){let e=Date.now()-t;return await this.monitorSolverPerformance("request_error",e,{error:s instanceof Error?s.message:"Unknown error"}),{data:null,error:s instanceof Error?s.message:"Unknown error occurred",success:!1}}}constructor(){super(),this._solverBaseUrl=null}}!function(e,t){for(var s=arguments.length,a=Array(s>2?s-2:0),i=2;i<s;i++)a[i-2]=arguments[i];let r=function(e,t){for(var s=arguments.length,a=Array(s>2?s-2:0),i=2;i<s;i++)a[i-2]=arguments[i];return()=>(M[e]||(M[e]=new t(...a)),M[e])}(e,t,...a);new Proxy({},{get:(e,t)=>r()[t],set:(e,t,s)=>(r()[t]=s,!0)})}("solverService",z);var D=s(8491);let R=D.Ik({code:D.Yj().min(1,"Department code is required").max(50,"Code must be 50 characters or less").regex(/^[a-zA-Z0-9_-]+$/,"Code can only contain letters, numbers, underscores, and hyphens"),name:D.Yj().min(1,"Department name is required").max(255,"Name must be 255 characters or less"),description:D.Yj().optional().transform(e=>""===e?void 0:e),parent_department_id:D.Yj().optional().transform(e=>""===e||"none"===e?void 0:e),cost_center:D.Yj().optional().transform(e=>""===e?void 0:e),default_shift_start:D.ai().int().min(0,"Shift start must be a valid time index").max(95,"Shift start must be a valid time index"),default_shift_end:D.ai().int().min(0,"Shift end must be a valid time index").max(95,"Shift end must be a valid time index"),overtime_allowed:D.zM(),is_active:D.zM()}).refine(e=>e.default_shift_start<e.default_shift_end,{message:"Shift start time must be before end time",path:["default_shift_end"]}),O=D.Yj().min(1,"JSON is required").refine(e=>{try{return JSON.parse(e),!0}catch(e){return!1}},"Must be valid JSON").transform(e=>{try{return JSON.parse(e)}catch(e){throw Error("Invalid JSON")}}),P=D.Ik({num_search_workers:D.ai().int().min(0).max(16).optional(),search_branching:D.k5(["AUTOMATIC_SEARCH","FIXED_SEARCH","PORTFOLIO_SEARCH","LP_SEARCH"]).optional(),linearization_level:D.ai().int().min(0).max(2).optional(),cp_model_probing_level:D.ai().int().min(0).max(3).optional(),cp_model_presolve:D.zM().optional(),repair_hint:D.zM().optional(),hint_conflict_limit:D.ai().int().min(0).optional(),log_search_progress:D.zM().optional(),use_lp_lns:D.zM().optional(),max_time_in_seconds:D.ai().min(0).optional(),max_deterministic_time:D.ai().min(0).optional(),max_preprocessing_time:D.ai().min(0).optional(),max_number_of_conflicts:D.ai().int().min(0).optional(),stop_after_first_solution:D.zM().optional(),max_memory_in_mb:D.ai().int().min(0).optional(),optimize_with_core:D.zM().optional(),optimize_with_max_hs:D.zM().optional(),mip_max_bound:D.ai().optional(),relative_gap_limit:D.ai().min(0).max(1).optional(),absolute_gap_limit:D.ai().min(0).optional(),symmetry_level:D.ai().int().min(0).max(2).optional(),max_symmetry_detection_time:D.ai().min(0).optional(),use_fast_restart:D.zM().optional(),restart_period:D.ai().int().min(1).optional(),restart_running_window_size:D.ai().int().min(1).optional(),preferred_variable_order:D.k5(["IN_ORDER","IN_REVERSE_ORDER","IN_RANDOM_ORDER"]).optional(),initial_polarity:D.k5(["POLARITY_TRUE","POLARITY_FALSE","POLARITY_RANDOM"]).optional(),minimization_algorithm:D.k5(["NONE","SIMPLE","ROTATION"]).optional(),use_probing_search:D.zM().optional(),enumerate_all_solutions:D.zM().optional(),keep_all_feasible_solutions_in_presolve:D.zM().optional(),fill_additional_solutions_in_response:D.zM().optional(),instantiate_all_variables:D.zM().optional(),auto_detect_greater_than_at_least_one_of:D.zM().optional(),clause_cleanup_period:D.ai().int().min(1).optional(),clause_cleanup_ratio:D.ai().min(0).max(1).optional(),max_clause_activity_value:D.ai().min(0).optional(),random_seed:D.ai().int().min(0).optional(),hash_pattern_id:D.ai().optional(),search_strategy:D.Yj().optional()}).strict(),V=D.Ik({name:D.Yj().min(1,"Template name is required").max(255,"Name must be 255 characters or less"),description:D.Yj().optional().transform(e=>""===e?void 0:e),solver_parameters:O.pipe(P),task_count:D.ai().int().min(1,"Must have at least 1 task").max(1e3,"Task count cannot exceed 1000"),total_min_duration_minutes:D.ai().int().min(0,"Duration must be non-negative").max(10080,"Duration cannot exceed 1 week (10080 minutes)"),critical_path_length_minutes:D.ai().int().min(0,"Length must be non-negative").max(10080,"Length cannot exceed 1 week (10080 minutes)")}).refine(e=>e.critical_path_length_minutes<=e.total_min_duration_minutes,{message:"Critical path length cannot exceed total duration",path:["critical_path_length_minutes"]}),U=["production","assembly","testing","packaging","storage","maintenance"],B=D.Ik({name:D.Yj().min(1,"Work cell name is required").max(255,"Name must be 255 characters or less"),capacity:D.ai().int().min(1,"Capacity must be at least 1").max(1e3,"Capacity cannot exceed 1000"),department_id:D.Yj().optional().transform(e=>""===e||"none"===e?void 0:e),wip_limit:D.ai().int().min(1,"WIP limit must be at least 1").max(1e4,"WIP limit cannot exceed 10000").optional().transform(e=>0===e?void 0:e),flow_priority:D.ai().int().min(1,"Flow priority must be at least 1").max(100,"Flow priority cannot exceed 100"),floor_location:D.Yj().optional().transform(e=>""===e?void 0:e),cell_type:D.k5(U,{errorMap:()=>({message:"Please select a valid cell type"})}),target_utilization:D.ai().min(0,"Target utilization must be between 0 and 100").max(100,"Target utilization must be between 0 and 100").transform(e=>e/100),calendar_id:D.Yj().optional().transform(e=>""===e||"none"===e?void 0:e),average_throughput_per_hour:D.ai().min(0,"Throughput must be non-negative").max(1e4,"Throughput cannot exceed 10000").optional().transform(e=>0===e?void 0:e),is_active:D.zM()}),L=D.Ik({name:D.Yj().min(1,"Machine name is required").max(255,"Name must be 255 characters or less"),capacity:D.ai().int().min(1,"Capacity must be at least 1"),cost_per_hour:D.ai().min(0,"Cost must be non-negative"),department_id:D.Yj().optional().transform(e=>""===e||"none"===e?void 0:e),cell_id:D.Yj().min(1,"Work cell is required"),setup_time_minutes:D.ai().int().min(0,"Setup time must be non-negative"),teardown_time_minutes:D.ai().int().min(0,"Teardown time must be non-negative"),maintenance_window_start:D.ai().int().min(0,"Time must be non-negative").max(95,"Maximum 95 time units (23:45)").optional().transform(e=>0===e?void 0:e),maintenance_window_end:D.ai().int().min(0,"Time must be non-negative").max(95,"Maximum 95 time units (23:45)").optional().transform(e=>0===e?void 0:e),last_maintenance_date:D.Yj().optional().transform(e=>""===e?void 0:e),next_maintenance_due:D.Yj().optional().transform(e=>""===e?void 0:e),maintenance_interval_hours:D.ai().int().min(1,"Interval must be at least 1 hour"),machine_type:D.Yj().optional().transform(e=>""===e?void 0:e),manufacturer:D.Yj().optional().transform(e=>""===e?void 0:e),model:D.Yj().optional().transform(e=>""===e?void 0:e),year_installed:D.ai().int().min(1980,"Year must be 1980 or later").max(new Date().getFullYear()+5,"Year cannot be more than 5 years in the future").optional(),efficiency_rating:D.ai().min(.1,"Efficiency must be at least 0.1").max(2,"Efficiency cannot exceed 2.0"),average_utilization_percent:D.ai().int().min(0,"Utilization must be non-negative").max(100,"Utilization cannot exceed 100%").optional(),uptime_target_percent:D.ai().int().min(0,"Uptime target must be non-negative").max(100,"Uptime target cannot exceed 100%"),calendar_id:D.Yj().optional().transform(e=>""===e?void 0:e),is_active:D.zM()}).refine(e=>void 0===e.maintenance_window_start||void 0===e.maintenance_window_end||e.maintenance_window_start<e.maintenance_window_end,{message:"Maintenance window start time must be before end time",path:["maintenance_window_end"]});var J=s(740),Y=s(544),W=s(2934);let H=(0,W.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Q=r.forwardRef((e,t)=>{let{className:s,variant:a,size:r,asChild:l=!1,...c}=e,o=l?Y.DX:"button";return(0,i.jsx)(o,{className:(0,n.cn)(H({variant:a,size:r,className:s})),ref:t,...c})});Q.displayName="Button";let X=r.forwardRef((e,t)=>{let{className:s,type:a,...r}=e;return(0,i.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});X.displayName="Input";var $=s(2711);let G=(0,W.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Z=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)($.b,{ref:t,className:(0,n.cn)(G(),s),...a})});Z.displayName=$.b.displayName;let K=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});K.displayName="Textarea";var ee=s(2513),et=s(1e3);let es=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(ee.bL,{ref:t,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,i.jsx)(ee.C1,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,i.jsx)(et.A,{className:"h-4 w-4"})})})});es.displayName=ee.bL.displayName;var ea=s(4002),ei=s(2446),er=s(7811);let en=ea.bL;ea.YJ;let el=ea.WT,ec=r.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,i.jsxs)(ea.l9,{ref:t,className:(0,n.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[a,(0,i.jsx)(ea.In,{asChild:!0,children:(0,i.jsx)(ei.A,{className:"h-4 w-4 opacity-50"})})]})});ec.displayName=ea.l9.displayName;let eo=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(ea.PP,{ref:t,className:(0,n.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,i.jsx)(er.A,{className:"h-4 w-4"})})});eo.displayName=ea.PP.displayName;let ed=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(ea.wn,{ref:t,className:(0,n.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,i.jsx)(ei.A,{className:"h-4 w-4"})})});ed.displayName=ea.wn.displayName;let em=r.forwardRef((e,t)=>{let{className:s,children:a,position:r="popper",...l}=e;return(0,i.jsx)(ea.ZL,{children:(0,i.jsxs)(ea.UC,{ref:t,className:(0,n.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...l,children:[(0,i.jsx)(eo,{}),(0,i.jsx)(ea.LM,{className:(0,n.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,i.jsx)(ed,{})]})})});em.displayName=ea.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(ea.JU,{ref:t,className:(0,n.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=ea.JU.displayName;let eu=r.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,i.jsxs)(ea.q7,{ref:t,className:(0,n.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,i.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,i.jsx)(ea.VF,{children:(0,i.jsx)(et.A,{className:"h-4 w-4"})})}),(0,i.jsx)(ea.p4,{children:a})]})});eu.displayName=ea.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(ea.wv,{ref:t,className:(0,n.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=ea.wv.displayName;let ep=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});ep.displayName="Card";let eh=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...a})});eh.displayName="CardHeader";let e_=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});e_.displayName="CardTitle";let ex=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...a})});ex.displayName="CardDescription";let ef=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...a})});function ey(e){if(e<0||e>95)throw Error("Time index must be between 0 and 95");let t=Math.floor(e/4);return"".concat(0===t?12:t>12?t-12:t,":").concat((e%4*15).toString().padStart(2,"0")," ").concat(t<12?"AM":"PM")}function ej(e){return Number.isInteger(e)&&e>=0&&e<=95}function eg(e,t){return ej(e)&&ej(t)?"".concat(ey(e)," - ").concat(ey(t)):"Invalid time range"}function ev(e){let{label:t,value:s,onChange:a,id:n,placeholder:l="Select time",disabled:c=!1,required:o=!1,helperText:d,className:m=""}=e,[u]=(0,r.useState)(()=>(function(){let e=[];for(let t=0;t<=95;t++)e.push({index:t,time24:function(e){if(e<0||e>95)throw Error("Time index must be between 0 and 95");let t=Math.floor(e/4);return"".concat(t.toString().padStart(2,"0"),":").concat((e%4*15).toString().padStart(2,"0"))}(t),time12:ey(t)});return e})()),p=ej(s)?ey(s):"";return(0,i.jsxs)("div",{className:"space-y-2 ".concat(m),children:[(0,i.jsxs)(Z,{htmlFor:n,children:[t,o&&(0,i.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,i.jsxs)(en,{value:ej(s)?s.toString():void 0,onValueChange:e=>{let t=parseInt(e,10);ej(t)&&a(t)},disabled:c,children:[(0,i.jsx)(ec,{id:n,children:(0,i.jsx)(el,{placeholder:l,children:p||l})}),(0,i.jsx)(em,{className:"max-h-60",children:u.map(e=>(0,i.jsx)(eu,{value:e.index.toString(),children:(0,i.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,i.jsx)("span",{className:"font-medium",children:e.time12}),(0,i.jsx)("span",{className:"text-gray-500 text-sm ml-4",children:e.time24})]})},e.index))})]}),d&&(0,i.jsx)("p",{className:"text-xs text-gray-500",children:d}),ej(s)&&(0,i.jsxs)("p",{className:"text-xs text-gray-600",children:["Current value: ",(0,i.jsx)("span",{className:"font-medium",children:p})," (15-minute units from midnight)"]})]})}ef.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter";var eb=s(6300);let eN=eb.bL,ek=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(eb.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...a})});ek.displayName=eb.B8.displayName;let ew=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(eb.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...a})});ew.displayName=eb.l9.displayName;let eS=r.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)(eb.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...a})});eS.displayName=eb.UC.displayName;let eC=(0,W.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function eE(e){let{className:t,variant:s,...a}=e;return(0,i.jsx)("div",{className:(0,n.cn)(eC({variant:s}),t),...a})}var eT=s(1849),eF=s(1872),eq=s(3678),eA=s(2262),eM=s(5842),eI=s(1201),ez=s(9703),eD=s(6660),eR=s.n(eD);function eO(e){let{tableName:t,entityName:s,sampleData:a,onUploadComplete:n,requiredFields:l=[],fieldDescriptions:c={}}=e,[o,d]=(0,r.useState)(null),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null),{toast:_}=(0,J.dj)(),x=(e,t)=>{let s=[];return l.forEach(t=>{e.hasOwnProperty(t)&&null!==e[t]&&""!==e[t]||s.push("Missing required field: ".concat(t))}),s},f=async()=>{if(o){u(!0),h(null);try{let e=await o.text(),a=(e=>{let t=eR().parse(e,{header:!0,skipEmptyLines:!0,transform:e=>""===e?null:"true"===e.toLowerCase()||"false"!==e.toLowerCase()&&(isNaN(Number(e))||""===e||e.startsWith("0")?e:Number(e))});if(t.errors&&t.errors.length>0){let e=t.errors.map(e=>"Row ".concat(e.row||"unknown",": ").concat(e.message||"Unknown error")).join("; ");throw Error("CSV parsing errors: ".concat(e))}if(!t.data||0===t.data.length)throw Error("CSV must have at least one data row");return t.data})(e);if(0===a.length)throw Error("No data rows found in CSV");let i={success:0,errors:[],warnings:[]};for(let e=0;e<a.length;e++){let s=a[e],r=e+2,n=x(s,e);if(n.length>0){i.errors.push({row:r,error:n.join(", "),data:s});continue}try{let{error:e}=await N.N.from(t).insert([s]);e?i.errors.push({row:r,error:e.message,data:s}):i.success++}catch(e){i.errors.push({row:r,error:e.message||"Unknown error",data:s})}}h(i),i.success>0?(_({title:"Upload Complete",description:"Successfully uploaded ".concat(i.success," ").concat(s.toLowerCase()).concat(1!==i.success?"s":"").concat(i.errors.length>0?" with ".concat(i.errors.length," errors"):"")}),n&&n()):_({title:"Upload Failed",description:"No records were uploaded. Please check the errors below.",variant:"destructive"})}catch(e){console.error("Upload error:",e),_({title:"Upload Error",description:e.message||"Failed to process CSV file",variant:"destructive"})}finally{u(!1)}}};return(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsxs)(e_,{className:"flex items-center gap-2",children:[(0,i.jsx)(eT.A,{className:"h-5 w-5"}),"Mass Upload ",s]}),(0,i.jsxs)(ex,{children:["Upload multiple ",s.toLowerCase(),"s from a CSV file. Download the template first to see the required format."]})]}),(0,i.jsxs)(ef,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-blue-50",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(eF.A,{className:"h-5 w-5 text-blue-600"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium text-blue-900",children:"Download CSV Template"}),(0,i.jsx)("p",{className:"text-sm text-blue-700",children:"Get the correct format with sample data"})]})]}),(0,i.jsxs)(Q,{onClick:()=>{let e=Object.keys(a),i=Object.values(a),r=new Blob([[e.join(","),i.map(e=>null==e?"":"string"==typeof e&&(e.includes(",")||e.includes('"')||e.includes("\n"))?'"'.concat(e.replace(/"/g,'""'),'"'):String(e)).join(",")].join("\n")],{type:"text/csv"}),n=window.URL.createObjectURL(r),l=document.createElement("a");l.setAttribute("hidden",""),l.setAttribute("href",n),l.setAttribute("download","".concat(t,"_template.csv")),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(n),_({title:"Template Downloaded",description:"CSV template for ".concat(s," downloaded successfully")})},variant:"outline",size:"sm",children:[(0,i.jsx)(eF.A,{className:"h-4 w-4 mr-2"}),"Download Template"]})]}),l.length>0&&(0,i.jsxs)("div",{className:"p-4 border rounded-lg bg-amber-50",children:[(0,i.jsx)("h4",{className:"font-medium text-amber-900 mb-2",children:"Required Fields"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(e=>(0,i.jsxs)(eE,{variant:"secondary",className:"bg-amber-100 text-amber-800",children:[e,c[e]&&(0,i.jsxs)("span",{className:"ml-1 text-xs",children:["(",c[e],")"]})]},e))})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var t;return d((null==(t=e.target.files)?void 0:t[0])||null)},className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"}),(0,i.jsxs)(Q,{onClick:f,disabled:!o||m,className:"whitespace-nowrap",children:[m&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),m?"Uploading...":"Upload CSV"]})]}),o&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,i.jsx)(eA.A,{className:"h-4 w-4"}),"Selected: ",o.name," (",(o.size/1024).toFixed(1)," KB)"]})]}),p&&(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(eM.A,{className:"h-5 w-5 text-green-600"}),(0,i.jsxs)("span",{className:"font-medium text-green-700",children:[p.success," Successful"]})]}),p.errors.length>0&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(eI.A,{className:"h-5 w-5 text-red-600"}),(0,i.jsxs)("span",{className:"font-medium text-red-700",children:[p.errors.length," Failed"]})]}),p.warnings.length>0&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(ez.A,{className:"h-5 w-5 text-amber-600"}),(0,i.jsxs)("span",{className:"font-medium text-amber-700",children:[p.warnings.length," Warnings"]})]})]}),p.errors.length>0&&(0,i.jsxs)("div",{className:"border rounded-lg",children:[(0,i.jsx)("div",{className:"p-3 bg-red-50 border-b",children:(0,i.jsx)("h4",{className:"font-medium text-red-900",children:"Errors"})}),(0,i.jsx)("div",{className:"max-h-60 overflow-y-auto",children:p.errors.map((e,t)=>(0,i.jsxs)("div",{className:"p-3 border-b last:border-b-0",children:[(0,i.jsxs)("div",{className:"flex items-start gap-2",children:[(0,i.jsxs)(eE,{variant:"destructive",className:"text-xs",children:["Row ",e.row]}),(0,i.jsx)("p",{className:"text-sm text-red-700",children:e.error})]}),e.data&&(0,i.jsx)("div",{className:"mt-2 text-xs text-gray-600 font-mono bg-gray-50 p-2 rounded",children:JSON.stringify(e.data,null,2)})]},t))})]})]})]})]})}var eP=s(6296),eV=s(4630),eU=s(3385),eB=s(7521);function eL(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[a,i]=(0,r.useState)({}),[n,l]=(0,r.useState)(""),[c,o]=(0,r.useState)("asc"),[d,m]=(0,r.useState)(new Set),[u,p]=(0,r.useState)(!1),h=(0,r.useMemo)(()=>{let t=[...e];return s.enableFiltering&&Object.entries(a).forEach(e=>{let[s,a]=e;void 0!==a&&""!==a&&null!==a&&(t=t.filter(e=>{let t=e[s];return"boolean"==typeof a?t===a:"string"==typeof a?String(t).toLowerCase().includes(a.toLowerCase()):"number"!=typeof a||t===a}))}),s.enableSorting&&n&&t.sort((e,t)=>{let s=e[n],a=t[n],i=0;return s<a?i=-1:s>a&&(i=1),"desc"===c?-i:i}),t},[e,a,n,c,s.enableFiltering,s.enableSorting]),_=(0,r.useCallback)(e=>{m(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),x=(0,r.useCallback)((e,s)=>{m(new Set((e||h).map(s||t)))},[h,t]),f=(0,r.useCallback)(()=>{m(new Set)},[]),y=(0,r.useCallback)(()=>{p(!0)},[]),j=(0,r.useCallback)(()=>{p(!1),f()},[f]);return{filteredItems:h,totalCount:e.length,filteredCount:h.length,isEmpty:0===h.length,filters:a,setFilters:i,sortBy:n,setSortBy:l,sortDirection:c,setSortDirection:o,selectedItems:d,isSelectionMode:u,toggleSelection:_,selectAll:x,clearSelection:f,enterSelectionMode:y,exitSelectionMode:j}}function eJ(e){let{options:t,values:s,onChange:a,placeholder:n}=e,[l,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)(""),m=(0,r.useCallback)((e,t)=>{a({...s,[e]:t})},[s,a]),u=(0,r.useCallback)(()=>{a({}),d("")},[a]),p=Object.values(s).filter(e=>void 0!==e&&""!==e&&null!==e).length;return(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)("div",{className:"relative flex-1",children:[(0,i.jsx)(eP.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,i.jsx)(X,{placeholder:n||"Search...",value:o,onChange:e=>{d(e.target.value),t.length>0&&m(t[0].key,e.target.value)},className:"pl-10"})]}),(0,i.jsxs)(Q,{variant:"outline",size:"sm",onClick:()=>c(!l),className:"flex items-center space-x-2",children:[(0,i.jsx)(eV.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{children:"Filters"}),p>0&&(0,i.jsx)(eE,{variant:"secondary",className:"ml-1",children:p})]}),p>0&&(0,i.jsx)(Q,{variant:"ghost",size:"sm",onClick:u,children:"Clear"})]}),l&&(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 border rounded-lg bg-gray-50",children:t.slice(1).map(e=>(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:e.key,children:e.label}),"text"===e.type&&(0,i.jsx)(X,{id:e.key,value:s[e.key]||"",onChange:t=>m(e.key,t.target.value),placeholder:"Filter by ".concat(e.label.toLowerCase())}),"select"===e.type&&e.options&&(0,i.jsxs)(en,{value:s[e.key]||"",onValueChange:t=>m(e.key,t),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select ".concat(e.label.toLowerCase())})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"",children:"All"}),e.options.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))]})]}),"boolean"===e.type&&(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:e.key,checked:!0===s[e.key],onCheckedChange:t=>m(e.key,!!t||void 0)}),(0,i.jsx)(Z,{htmlFor:e.key,children:"Show only active"})]}),"number"===e.type&&(0,i.jsx)(X,{id:e.key,type:"number",value:s[e.key]||"",onChange:t=>m(e.key,parseFloat(t.target.value)||void 0),placeholder:"Filter by ".concat(e.label.toLowerCase())})]},e.key))})]})}function eY(e){let{items:t,selectedItems:s,onToggleSelection:a,onSelectAll:r,onClearSelection:n,onBulkDelete:l,onBulkEdit:c,getId:o,isSelectionMode:d,onEnterSelectionMode:m}=e,u=s.size;return d?(0,i.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)("div",{className:"text-sm font-medium text-blue-900",children:[u," item",1!==u?"s":""," selected"]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(Q,{variant:"ghost",size:"sm",onClick:r,children:"Select All"}),(0,i.jsx)(Q,{variant:"ghost",size:"sm",onClick:n,children:"Clear"})]})]}),u>0&&(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)(Q,{variant:"outline",size:"sm",onClick:()=>c(Array.from(s)),className:"flex items-center space-x-1",children:[(0,i.jsx)(eU.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{children:"Edit"})]}),(0,i.jsxs)(Q,{variant:"outline",size:"sm",onClick:()=>l(Array.from(s)),className:"flex items-center space-x-1 text-red-600 hover:text-red-700",children:[(0,i.jsx)(eB.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{children:"Delete"})]})]})]}):(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:[t.length," item",1!==t.length?"s":""]}),(0,i.jsx)(Q,{variant:"outline",size:"sm",onClick:m,children:"Select Items"})]})}function eW(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!1),[n,l]=(0,r.useState)(null),[c,o]=(0,r.useState)(!1),{toast:d}=(0,J.dj)(),m=eL(e,e=>e.department_id,{enableFiltering:!0,enableBulkOperations:!0,enableSorting:!0}),u=async e=>{for(let t of e){let e=await S.delete(t);if(!e.success)return void d({title:"Error",description:"Failed to delete department: ".concat(e.error),variant:"destructive"})}d({title:"Success",description:"Successfully deleted ".concat(e.length," departments")}),g(),m.clearSelection()},p=async t=>{for(let s of t){let t=e.find(e=>e.department_id===s);if(t){let e=await S.update(s,{is_active:!t.is_active});if(!e.success)return void d({title:"Error",description:"Failed to update department: ".concat(e.error),variant:"destructive"})}}d({title:"Success",description:"Successfully updated ".concat(t.length," departments")}),g(),m.clearSelection()},{register:h,handleSubmit:_,reset:x,setValue:f,watch:y,formState:{errors:j}}=(0,v.mN)({resolver:(0,b.u)(R),defaultValues:{code:"",name:"",description:"",parent_department_id:"",cost_center:"",default_shift_start:32,default_shift_end:64,overtime_allowed:!0,is_active:!0}}),g=(0,r.useCallback)(async()=>{a(!0),performance.now();try{let e=await S.getAll();performance.now(),e.success&&e.data?t(e.data):(console.error("Error fetching departments:",e.error),d({title:"Error",description:e.error||"Failed to fetch departments",variant:"destructive"}))}catch(e){console.error("Error in fetchDepartments:",e)}finally{a(!1)}},[d]);(0,r.useEffect)(()=>{g()},[g]);let N=async e=>{o(!0);try{let t,s={...e,code:e.code||"",name:e.name||""};(t=n?await S.update(n,s):await S.create(s)).success?(d({title:"Success",description:"Department ".concat(n?"updated":"created"," successfully")}),x(),l(null),g()):(console.error("Error saving department:",t.error),d({title:"Error",description:t.error||"Failed to save department",variant:"destructive"}))}catch(e){console.error("Error in onSubmit:",e)}finally{o(!1)}},k=async t=>{let s=e.find(e=>e.department_id===t);if(!s||!confirm('Are you sure you want to delete "'.concat(s.name,'"?\n\nThis action cannot be undone.')))return;performance.now();let a=await S.delete(t);if(performance.now(),a.success)d({title:"Success",description:'Department "'.concat(s.name,'" deleted successfully')}),g();else{var i,r,n;console.error("Error deleting department:",a.error);let e=a.error||"Failed to delete department",t="";(null==(i=a.error)?void 0:i.includes("foreign key constraint"))||(null==(r=a.error)?void 0:r.includes("violates foreign key"))?(e="Cannot delete department - it's still in use",t="This department has related records (job instances, operators, etc.). Either delete those first or deactivate this department instead."):(null==(n=a.error)?void 0:n.includes("dependent"))&&(e="Cannot delete department - has dependencies",t="Other departments or records depend on this one. Consider deactivating instead."),d({title:"Error",description:t||e,variant:"destructive"})}},w=e.filter(e=>!n||e.department_id!==n);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:n?"Edit Department":"Create New Department"}),(0,i.jsx)(ex,{children:n?"Update department information and hierarchy":'Create a department - use "None (Root Department)" for standalone departments or select a parent for hierarchy'})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:_(N),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"code",children:"Code *"}),(0,i.jsx)(X,{id:"code",...h("code",{required:"Department code is required",maxLength:{value:50,message:"Code must be 50 characters or less"}}),placeholder:"e.g., production, quality, DEPT_A"}),j.code&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:j.code.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Name *"}),(0,i.jsx)(X,{id:"name",...h("name",{required:"Department name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., Production Department"}),j.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:j.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"parent_department_id",children:"Parent Department"}),(0,i.jsxs)(en,{value:y("parent_department_id")||void 0,onValueChange:e=>{f("parent_department_id",e)},children:[(0,i.jsx)(ec,{id:"parent_department_id",children:(0,i.jsx)(el,{placeholder:"Select parent department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"None (Root Department)"}),w.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)("strong",{children:"For single department use:"}),' Select "None (Root Department)" to make this a top-level department.',(0,i.jsx)("br",{}),(0,i.jsx)("strong",{children:"For hierarchy:"})," Child departments inherit scheduling constraints from parent."]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"cost_center",children:"Cost Center Code"}),(0,i.jsx)(X,{id:"cost_center",...h("cost_center"),placeholder:"e.g., CC-PROD-001"}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Optional: For financial tracking and cost allocation (not currently mapped to solver constraints)"})]}),(0,i.jsx)(ev,{label:"Default Shift Start Time",value:y("default_shift_start")||32,onChange:e=>{f("default_shift_start",e)},id:"default_shift_start",placeholder:"Select start time",helperText:"Default start time for this department's shifts",required:!0}),(0,i.jsx)(ev,{label:"Default Shift End Time",value:y("default_shift_end")||64,onChange:e=>{f("default_shift_end",e)},id:"default_shift_end",placeholder:"Select end time",helperText:"Default end time for this department's shifts",required:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"description",children:"Description"}),(0,i.jsx)(K,{id:"description",...h("description"),placeholder:"Department description and responsibilities",rows:3})]}),(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"overtime_allowed",checked:y("overtime_allowed"),onCheckedChange:e=>{f("overtime_allowed",e)}}),(0,i.jsx)(Z,{htmlFor:"overtime_allowed",children:"Overtime Allowed"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:y("is_active"),onCheckedChange:e=>{f("is_active",e)}}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[n&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{x(),l(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:c,children:[c&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Update":"Create"," Department"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"departments",entityName:"Department",sampleData:{code:"PROD",name:"Production Department",description:"Main production operations",parent_department_id:null,cost_center:"CC-PROD-001",default_shift_start:32,default_shift_end:64,overtime_allowed:!0,is_active:!0},onUploadComplete:g,requiredFields:["code","name"],fieldDescriptions:{code:"Unique department code",name:"Department display name",default_shift_start:"Start time (15-min intervals from midnight)",default_shift_end:"End time (15-min intervals from midnight)"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsxs)(e_,{children:["Departments (",m.filteredCount," of ",m.totalCount,")"]}),(0,i.jsx)(ex,{children:"Manage existing departments with advanced filtering and bulk operations"})]}),(0,i.jsxs)(ef,{className:"space-y-4",children:[(0,i.jsx)(eJ,{options:[{key:"name",label:"Name",type:"text"},{key:"code",label:"Code",type:"text"},{key:"cost_center",label:"Cost Center",type:"text"},{key:"is_active",label:"Active",type:"boolean"},{key:"overtime_allowed",label:"Overtime Allowed",type:"boolean"}],values:m.filters,onChange:m.setFilters,placeholder:"Search departments..."}),(0,i.jsx)(eY,{items:m.filteredItems,selectedItems:m.selectedItems,onToggleSelection:m.toggleSelection,onSelectAll:m.selectAll,onClearSelection:m.clearSelection,onBulkDelete:u,onBulkEdit:p,getId:e=>e.department_id,isSelectionMode:m.isSelectionMode,onEnterSelectionMode:m.enterSelectionMode}),s?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):m.isEmpty?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:m.filters.length>0?"No departments match your filters":"No departments found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[m.isSelectionMode&&(0,i.jsx)("th",{className:"text-left p-2 w-12",children:(0,i.jsx)("input",{type:"checkbox",checked:m.selectedItems.size===m.filteredItems.length,onChange:()=>{m.selectedItems.size===m.filteredItems.length?m.clearSelection():m.selectAll(m.filteredItems,e=>e.department_id)},className:"rounded"})}),(0,i.jsx)("th",{className:"text-left p-2 font-medium cursor-pointer hover:bg-gray-50",onClick:()=>m.setSortBy("code"),children:"Code "}),(0,i.jsx)("th",{className:"text-left p-2 font-medium cursor-pointer hover:bg-gray-50",onClick:()=>m.setSortBy("name"),children:"Name "}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Cost Center"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Shift Times"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:m.filteredItems.map(e=>(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[m.isSelectionMode&&(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("input",{type:"checkbox",checked:m.selectedItems.has(e.department_id),onChange:()=>m.toggleSelection(e.department_id),className:"rounded"})}),(0,i.jsx)("td",{className:"p-2 font-medium",children:e.code}),(0,i.jsx)("td",{className:"p-2",children:e.name}),(0,i.jsx)("td",{className:"p-2",children:e.cost_center||"-"}),(0,i.jsx)("td",{className:"p-2",children:eg(e.default_shift_start,e.default_shift_end)}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{l(e.department_id),f("code",e.code),f("name",e.name),f("description",e.description||""),f("parent_department_id",e.parent_department_id||"none"),f("cost_center",e.cost_center||""),f("default_shift_start",e.default_shift_start),f("default_shift_end",e.default_shift_end),f("overtime_allowed",e.overtime_allowed),f("is_active",e.is_active)},disabled:s,children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>p([e.department_id]),className:e.is_active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50",disabled:s,children:e.is_active?"Deactivate":"Reactivate"}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>k(e.department_id),className:"text-red-600 hover:bg-red-50",disabled:s,children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.department_id))})]})})]})]})]})}class eH{addFormMetrics(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&(this.metrics=this.metrics.slice(-this.maxMetrics)),e.loadTime>2e3&&console.warn("[FORM-PERF] Slow form load: ".concat(e.formName," took ").concat(e.loadTime,"ms")),e.submissionTime&&e.submissionTime>5e3&&console.warn("[FORM-PERF] Slow form submission: ".concat(e.formName," took ").concat(e.submissionTime,"ms")),e.errorCount>5&&console.warn("[FORM-PERF] High error rate: ".concat(e.formName," had ").concat(e.errorCount," errors"))}addValidationMetrics(e){this.validationMetrics.push(e),this.validationMetrics.length>10*this.maxMetrics&&(this.validationMetrics=this.validationMetrics.slice(-(10*this.maxMetrics))),e.duration>100&&console.warn("[FORM-PERF] Slow validation: ".concat(e.fieldName," took ").concat(e.duration,"ms"))}addInteractionMetrics(e){this.interactionMetrics.push(e),this.interactionMetrics.length>50*this.maxMetrics&&(this.interactionMetrics=this.interactionMetrics.slice(-(50*this.maxMetrics)))}getFormMetrics(e){return e?this.metrics.filter(t=>t.formName===e):[...this.metrics]}getValidationMetrics(e){return e?this.validationMetrics.filter(t=>t.fieldName===e):[...this.validationMetrics]}getInteractionMetrics(e){return e?this.interactionMetrics.filter(t=>t.target===e):[...this.interactionMetrics]}getPerformanceSummary(e){let t=this.getFormMetrics(e);if(0===t.length)return null;let s=this.validationMetrics.filter(e=>t.some(t=>t.timestamp-1e4<e.validationStartTime&&e.validationStartTime<t.timestamp+6e4)),a=this.interactionMetrics.filter(e=>t.some(t=>t.timestamp-1e4<e.timestamp&&e.timestamp<t.timestamp+6e4)),i=t.reduce((e,t)=>e+t.loadTime,0)/t.length,r=t.filter(e=>null!==e.submissionTime).reduce((e,t)=>e+(t.submissionTime||0),0)/Math.max(1,t.filter(e=>null!==e.submissionTime).length),n=s.length>0?s.reduce((e,t)=>e+t.duration,0)/s.length:0;return{formName:e,totalSessions:t.length,averageLoadTime:Math.round(i),averageSubmissionTime:Math.round(r),averageValidationTime:Math.round(n),totalInteractions:a.length,totalValidations:s.length,errorRate:t.reduce((e,t)=>e+t.errorCount,0)/t.length,slowLoadSessions:t.filter(e=>e.loadTime>2e3).length,slowSubmissionSessions:t.filter(e=>e.submissionTime&&e.submissionTime>5e3).length,lastSession:t[t.length-1]}}constructor(){this.metrics=[],this.validationMetrics=[],this.interactionMetrics=[],this.maxMetrics=100}}let eQ=new eH;function eX(e){let[t,s]=(0,r.useState)(null),[a,i]=(0,r.useState)(null),[n,l]=(0,r.useState)(null),[c,o]=(0,r.useState)(0),[d,m]=(0,r.useState)(0),[u,p]=(0,r.useState)({}),[h,_]=(0,r.useState)({}),[x,f]=(0,r.useState)(!1),y=(0,r.useRef)(0),j=(0,r.useRef)(null),g=(0,r.useRef)({});(0,r.useEffect)(()=>{f(!0),0===y.current&&(y.current=Date.now())},[]),(0,r.useEffect)(()=>{x&&y.current>0&&s(Date.now()-y.current)},[x]);let v=(0,r.useCallback)((e,t,s)=>{if(!x)return;let r=Date.now();null===a&&y.current>0&&i(r-y.current),m(e=>e+1),"focus"===e&&p(e=>({...e,[t]:(e[t]||0)+1})),eQ.addInteractionMetrics({type:e,target:t,timestamp:r,duration:s})},[a,x]),b=(0,r.useCallback)((e,t,s)=>{if(!x)return;let a=Date.now(),i=g.current[e]||a,r=a-i;t&&(_(t=>({...t,[e]:(t[e]||0)+1})),o(e=>e+1)),eQ.addValidationMetrics({fieldName:e,validationStartTime:i,validationEndTime:a,duration:r,hasError:t,errorMessage:s}),delete g.current[e]},[x]),N=(0,r.useCallback)(e=>{x&&(g.current[e]=Date.now())},[x]),k=(0,r.useCallback)(()=>{x&&(j.current=Date.now())},[x]),w=(0,r.useCallback)(e=>{x&&j.current&&(l(Date.now()-j.current),e||o(e=>e+1),j.current=null)},[x]),S=(0,r.useCallback)(()=>{if(null!==t){let s={formName:e,loadTime:t,firstInteraction:a,submissionTime:n,validationTime:Object.keys(g.current).length>0?Date.now()-Math.min(...Object.values(g.current)):null,errorCount:c,interactionCount:d,fieldFocusCount:u,validationErrorCount:h,timestamp:y.current};eQ.addFormMetrics(s)}},[e,t,a,n,c,d,u,h]);return(0,r.useEffect)(()=>()=>{S()},[S]),{loadTime:t,firstInteraction:a,submissionTime:n,validationTime:Object.keys(g.current).length>0?Date.now()-Math.min(...Object.values(g.current)):null,errorCount:c,interactionCount:d,fieldFocusCount:u,validationErrorCount:h,trackInteraction:v,trackValidation:b,startValidation:N,endValidation:b,trackSubmissionStart:k,trackSubmissionEnd:w,finalizeMetrics:S,startSubmission:k,recordValidationComplete:()=>{},recordInteraction:v,reportMetric:(e,t)=>{},getFormSummary:()=>eQ.getPerformanceSummary(e),isSlowLoading:null!==t&&t>2e3,isSlowSubmission:null!==n&&n>5e3,hasHighErrorRate:c>5}}let e$={num_search_workers:8,max_time_in_seconds:60,linearization_level:1,search_branching:"FIXED_SEARCH",cp_model_presolve:!0,repair_hint:!0};function eG(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),{toast:u}=(0,J.dj)(),p=eX("job-template-form"),h=eL(e,e=>e.pattern_id,{enableFiltering:!0,enableBulkOperations:!0,enableSorting:!0}),_=async e=>{p.trackInteraction("click","bulk_delete");try{for(let t of e){let e=await E.delete(t);if(!e.success)return void u({title:"Error",description:"Failed to delete job template: ".concat(e.error),variant:"destructive"})}u({title:"Success",description:"Successfully deleted ".concat(e.length," job templates")}),C(),h.clearSelection()}catch(e){console.error("Error in handleBulkDelete:",e)}},x=async t=>{p.trackInteraction("click","bulk_toggle_active");try{for(let s of t){let t=e.find(e=>e.pattern_id===s);if(t){let e=await E.update(s,{is_active:!t.is_active});if(!e.success)return void u({title:"Error",description:"Failed to update job template: ".concat(e.error),variant:"destructive"})}}u({title:"Success",description:"Successfully updated ".concat(t.length," job templates")}),C(),h.clearSelection()}catch(e){console.error("Error in handleBulkToggleActive:",e)}},{register:f,handleSubmit:y,reset:j,setValue:g,watch:N,formState:{errors:k,isValidating:w}}=(0,v.mN)({resolver:(0,b.u)(V),defaultValues:{name:"",description:"",solver_parameters:JSON.stringify(e$,null,2),task_count:1,total_min_duration_minutes:60,critical_path_length_minutes:60}}),C=async()=>{l(!0);try{let e=await E.getAll();e.success&&e.data?t(e.data):(console.error("Error fetching job templates:",e.error),u({title:"Error",description:e.error||"Failed to fetch job templates",variant:"destructive"}))}catch(e){console.error("Error in fetchJobTemplates:",e)}finally{l(!1)}},T=async()=>{let e=await S.getAll(!0);e.success&&e.data?a(e.data):console.error("Error fetching departments:",e.error)};(0,r.useEffect)(()=>{(async()=>{await Promise.all([C(),T()])})()},[]),(0,r.useEffect)(()=>{let e=Object.keys(k).length;e>3&&console.warn("[FORM-PERF] High validation error count: ".concat(e," errors"))},[k]);let F=async e=>{p.trackSubmissionStart(),m(!0);try{let t;p.startValidation("solver_parameters");let s=await E.validateSolverParameters(e.solver_parameters);if(p.trackValidation("solver_parameters",!s.success),!s.success){u({title:"Error",description:s.error||"Invalid solver parameters",variant:"destructive"}),p.trackSubmissionEnd(!1);return}let a={name:e.name,description:e.description||null,solver_parameters:e.solver_parameters,task_count:e.task_count,total_min_duration_minutes:e.total_min_duration_minutes,critical_path_length_minutes:e.critical_path_length_minutes};(t=c?await E.update(c,a):await E.create(a)).success?(u({title:"Success",description:"Job template ".concat(c?"updated":"created"," successfully")}),j(),o(null),C(),p.trackSubmissionEnd(!0)):(console.error("Error saving job template:",t.error),u({title:"Error",description:t.error||"Failed to save job template",variant:"destructive"}),p.trackSubmissionEnd(!1))}catch(e){console.error("Error in form submission:",e),p.trackSubmissionEnd(!1)}finally{m(!1)}},q=async e=>{if(confirm("Are you sure you want to delete this job template?")){p.trackInteraction("click","delete_template");try{let t=await E.delete(e);t.success?(u({title:"Success",description:"Job template deleted successfully"}),C()):(console.error("Error deleting job template:",t.error),u({title:"Error",description:t.error||"Failed to delete job template",variant:"destructive"}))}catch(e){console.error("Error in handleDelete:",e)}}};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",onClick:()=>p.trackInteraction("click","button_click"),children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",onClick:()=>p.trackInteraction("click","button_click"),children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:c?"Edit Job Template":"Create New Job Template"}),(0,i.jsx)(ex,{children:c?"Update job template information":"Add a reusable job template for manufacturing scheduling"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:y(F),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Template Name *"}),(0,i.jsx)(X,{id:"name",...f("name"),placeholder:"e.g., Standard Manufacturing Template",onFocus:()=>p.trackInteraction("focus","field_focus"),onClick:()=>p.trackInteraction("click","button_click")}),k.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"task_count",children:"Task Count *"}),(0,i.jsx)(X,{id:"task_count",type:"number",min:"1",...f("task_count",{valueAsNumber:!0}),placeholder:"1",onFocus:()=>p.trackInteraction("focus","field_focus"),onClick:()=>p.trackInteraction("click","button_click")}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Number of tasks in this pattern"}),k.task_count&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.task_count.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"total_min_duration_minutes",children:"Total Min Duration (minutes)"}),(0,i.jsx)(X,{id:"total_min_duration_minutes",type:"number",min:"0",...f("total_min_duration_minutes",{valueAsNumber:!0}),placeholder:"60",onFocus:()=>p.trackInteraction("focus","field_focus"),onClick:()=>p.trackInteraction("click","button_click")}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Sum of minimum task durations"}),k.total_min_duration_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.total_min_duration_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"critical_path_length_minutes",children:"Critical Path Length (minutes)"}),(0,i.jsx)(X,{id:"critical_path_length_minutes",type:"number",min:"0",...f("critical_path_length_minutes",{valueAsNumber:!0}),placeholder:"60",onFocus:()=>p.trackInteraction("focus","field_focus"),onClick:()=>p.trackInteraction("click","button_click")}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Minimum time to complete pattern (longest path)"}),k.critical_path_length_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.critical_path_length_minutes.message})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"description",children:"Description"}),(0,i.jsx)(K,{id:"description",...f("description"),placeholder:"Template description and use cases",rows:3,onFocus:()=>p.trackInteraction("focus","field_focus"),onClick:()=>p.trackInteraction("click","button_click")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"solver_parameters",children:"Blessed Solver Parameters (JSON) *"}),(0,i.jsx)(K,{id:"solver_parameters",...f("solver_parameters"),rows:8,className:"font-mono text-sm",placeholder:JSON.stringify(e$,null,2),onFocus:()=>p.trackInteraction("focus","field_focus"),onClick:()=>p.trackInteraction("click","button_click")}),k.solver_parameters&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.solver_parameters.message}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Configure CP-SAT solver parameters for optimal performance. Default values shown above are production-tested."}),w&&(0,i.jsxs)("div",{className:"flex items-center text-xs text-blue-600",children:[(0,i.jsx)(eq.A,{className:"mr-1 h-3 w-3 animate-spin"}),"Validating parameters..."]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[c&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{p.trackInteraction("click","cancel"),j(),o(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:d,onClick:()=>p.trackInteraction("click","button_click"),children:[d&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update":"Create"," Template"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"job_optimized_patterns",entityName:"Job Template",sampleData:{name:"Standard Assembly Job",description:"Standard assembly process for product line A",department_id:null,estimated_duration_minutes:120,priority_weight:1,solver_parameters:e$,is_active:!0},onUploadComplete:()=>{p.trackInteraction("click","upload_complete"),C()},requiredFields:["name"],fieldDescriptions:{name:"Template display name",description:"Template description",estimated_duration_minutes:"Expected duration in minutes",priority_weight:"Priority weight (1.0 = normal)",solver_parameters:"JSON object with solver parameters"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsxs)(e_,{children:["Job Templates (",h.filteredCount," of ",h.totalCount,")"]}),(0,i.jsx)(ex,{children:"Manage existing job templates with advanced filtering and bulk operations"})]}),(0,i.jsxs)(ef,{className:"space-y-4",children:[(0,i.jsx)(eJ,{options:[{key:"name",label:"Name",type:"text"},{key:"description",label:"Description",type:"text"},{key:"is_active",label:"Active",type:"boolean"}],values:h.filters,onChange:e=>{p.trackInteraction("click","filter_change"),h.setFilters(e)},placeholder:"Search job templates..."}),(0,i.jsx)(eY,{items:h.filteredItems,selectedItems:h.selectedItems,onToggleSelection:e=>{p.trackInteraction("click","toggle_selection"),h.toggleSelection(e)},onSelectAll:()=>{p.trackInteraction("click","select_all"),h.selectAll()},onClearSelection:()=>{p.trackInteraction("click","clear_selection"),h.clearSelection()},onBulkDelete:_,onBulkEdit:x,getId:e=>e.pattern_id,isSelectionMode:h.isSelectionMode,onEnterSelectionMode:()=>{p.trackInteraction("click","enter_selection_mode"),h.enterSelectionMode()}}),n?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):h.isEmpty?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:h.filters.length>0?"No job templates match your filters":"No job templates found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[h.isSelectionMode&&(0,i.jsx)("th",{className:"text-left p-2 w-12",children:(0,i.jsx)("input",{type:"checkbox",checked:h.selectedItems.size===h.filteredItems.length,onChange:()=>{p.trackInteraction("click","select_all_toggle"),h.selectedItems.size===h.filteredItems.length?h.clearSelection():h.selectAll()},className:"rounded"})}),(0,i.jsx)("th",{className:"text-left p-2 font-medium cursor-pointer hover:bg-gray-50",onClick:()=>{p.trackInteraction("click","sort_by_name"),h.setSortBy("name")},children:"Name "}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Task Count"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Description"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Created"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:h.filteredItems.map(e=>(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[h.isSelectionMode&&(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("input",{type:"checkbox",checked:h.selectedItems.has(e.pattern_id),onChange:()=>{p.trackInteraction("click","row_select"),h.toggleSelection(e.pattern_id)},className:"rounded"})}),(0,i.jsx)("td",{className:"p-2 font-medium",children:(0,i.jsxs)("div",{children:[e.name,e.description&&(0,i.jsx)("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:e.description})]})}),(0,i.jsx)("td",{className:"p-2",children:e.task_count}),(0,i.jsx)("td",{className:"p-2",children:e.description||"-"}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:new Date(e.created_at).toLocaleDateString()}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{p.trackInteraction("click","edit_button"),p.trackInteraction("click","edit_template"),o(e.pattern_id),g("name",e.name),g("description",e.description||""),g("solver_parameters",JSON.stringify(e.solver_parameters,null,2)),g("task_count",e.task_count||1),g("total_min_duration_minutes",e.total_min_duration_minutes||60),g("critical_path_length_minutes",e.critical_path_length_minutes||60)},disabled:n,children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{p.trackInteraction("click","toggle_active_button"),x([e.pattern_id])},className:e.is_active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50",disabled:n,children:e.is_active?"Deactivate":"Reactivate"}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{p.trackInteraction("click","delete_button"),q(e.pattern_id)},className:"text-red-600 hover:bg-red-50",disabled:n,children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.pattern_id))})]})})]})]})]})}function eZ(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)([]),[d,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),[h,_]=(0,r.useState)(!1),{toast:x}=(0,J.dj)(),f=eX("machine-form"),y=eL(e,e=>e.machine_resource_id,{enableFiltering:!0,enableBulkOperations:!0,enableSorting:!0}),j=async e=>{for(let t of e){let e=await A.delete(t);if(!e.success)return void x({title:"Error",description:"Failed to delete machine: ".concat(e.error),variant:"destructive"})}x({title:"Success",description:"Successfully deleted ".concat(e.length," machines")}),I(),y.clearSelection()},g=async t=>{for(let s of t){let t=e.find(e=>e.machine_resource_id===s);if(t){let e=await A.update(s,{is_active:!t.is_active});if(!e.success)return void x({title:"Error",description:"Failed to update machine: ".concat(e.error),variant:"destructive"})}}x({title:"Success",description:"Successfully updated ".concat(t.length," machines")}),I(),y.clearSelection()},{register:N,handleSubmit:k,reset:w,setValue:C,watch:E,formState:{errors:T}}=(0,v.mN)({resolver:(0,b.u)(L),defaultValues:{name:"",capacity:1,cost_per_hour:0,department_id:"",cell_id:"",setup_time_minutes:0,teardown_time_minutes:0,maintenance_window_start:0,maintenance_window_end:0,last_maintenance_date:"",next_maintenance_due:"",maintenance_interval_hours:720,machine_type:"",manufacturer:"",model:"",year_installed:new Date().getFullYear(),efficiency_rating:1,average_utilization_percent:85,uptime_target_percent:95,calendar_id:"",is_active:!0}}),q=(0,r.useCallback)((e,t)=>({...N(e,t),onFocus:t=>{f.trackInteraction("focus",e)},onBlur:s=>{var a,i;f.startValidation(e);let r=!!T[e];f.trackValidation(e,r),null==(a=(i=N(e,t)).onBlur)||a.call(i,s)},onChange:s=>{var a,i;f.trackInteraction("change",e),null==(a=(i=N(e,t)).onChange)||a.call(i,s)}}),[N,f,T]),M=E("department_id"),I=(0,r.useCallback)(async()=>{m(!0);let e=await A.getAll();e.success&&e.data?t(e.data):(console.error("Error fetching machines:",e.error),x({title:"Error",description:e.error||"Failed to fetch machines",variant:"destructive"})),m(!1)},[x]),z=(0,r.useCallback)(async()=>{let e=await S.getAll(!0);e.success&&e.data?a(e.data):console.error("Error fetching departments:",e.error)},[]),D=(0,r.useCallback)(async()=>{let e=await F.getAll(!0);e.success&&e.data?l(e.data):console.error("Error fetching work cells:",e.error)},[]);(0,r.useEffect)(()=>{I(),z(),D()},[I,z,D]),(0,r.useEffect)(()=>{M?o(n.filter(e=>e.department_id===M)):o(n),C("cell_id","")},[M,n,C]);let R=async e=>{_(!0),f.trackSubmissionStart();try{let t;f.startValidation("form");let s={...e,department_id:"none"===e.department_id?null:e.department_id};f.trackValidation("form",!1),(t=u?await A.update(u,s):await A.create(s)).success?(f.trackSubmissionEnd(!0),x({title:"Success",description:"Machine ".concat(u?"updated":"created"," successfully")}),w(),p(null),I()):(f.trackSubmissionEnd(!1),console.error("Error saving machine:",t.error),x({title:"Error",description:t.error||"Failed to save machine",variant:"destructive"}))}catch(e){f.trackSubmissionEnd(!1),console.error("Unexpected error saving machine:",e),x({title:"Error",description:"An unexpected error occurred while saving the machine",variant:"destructive"})}finally{_(!1)}},O=async t=>{let s=e.find(e=>e.machine_resource_id===t);if(!s||!confirm('Are you sure you want to delete "'.concat(s.name,'"?\n\nThis action cannot be undone.')))return;let a=await A.delete(t);if(a.success)x({title:"Success",description:'Machine "'.concat(s.name,'" deleted successfully')}),I();else{var i,r,n;console.error("Error deleting machine:",a.error);let e=a.error||"Failed to delete machine",t="";(null==(i=a.error)?void 0:i.includes("foreign key constraint"))||(null==(r=a.error)?void 0:r.includes("violates foreign key"))?(e="Cannot delete machine - it's still in use",t="This machine has related records (job instances, assignments, etc.). Either delete those first or deactivate this machine instead."):(null==(n=a.error)?void 0:n.includes("dependent"))&&(e="Cannot delete machine - has dependencies",t="Other records depend on this machine. Consider deactivating instead."),x({title:"Error",description:t||e,variant:"destructive"})}};return(0,i.jsxs)("div",{className:"space-y-6",children:[!1,(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:u?"Edit Machine":"Create New Machine"}),(0,i.jsx)(ex,{children:u?"Update machine information":"Add a new machine resource to the production system"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:k(R),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Machine Name *"}),(0,i.jsx)(X,{id:"name",...q("name",{required:"Machine name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., CNC Machine 01"}),T.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"machine_type",children:"Machine Type"}),(0,i.jsx)(X,{id:"machine_type",...q("machine_type"),placeholder:"e.g., CNC, Assembly, Testing"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department"}),(0,i.jsxs)(en,{onValueChange:e=>{f.trackInteraction("click","department_id"),C("department_id",e)},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Department"}),s.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"cell_id",children:"Work Cell *"}),(0,i.jsxs)(en,{onValueChange:e=>{f.trackInteraction("click","cell_id"),C("cell_id",e)},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select work cell"})}),(0,i.jsx)(em,{children:c.map(e=>(0,i.jsx)(eu,{value:e.cell_id,children:e.name},e.cell_id))})]}),!E("cell_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Work cell is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"capacity",children:"Capacity"}),(0,i.jsx)(X,{id:"capacity",type:"number",min:"1",...q("capacity",{valueAsNumber:!0,min:{value:1,message:"Capacity must be at least 1"}})}),T.capacity&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.capacity.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"cost_per_hour",children:"Hourly Cost ($)"}),(0,i.jsx)(X,{id:"cost_per_hour",type:"number",min:"0",step:"0.01",...q("cost_per_hour",{valueAsNumber:!0,min:{value:0,message:"Cost must be non-negative"}})}),T.cost_per_hour&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.cost_per_hour.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"manufacturer",children:"Manufacturer"}),(0,i.jsx)(X,{id:"manufacturer",...N("manufacturer"),placeholder:"e.g., Haas, Fanuc, Siemens"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"model",children:"Model"}),(0,i.jsx)(X,{id:"model",...N("model"),placeholder:"e.g., VF-2SS, R-2000iB"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"year_installed",children:"Year Installed"}),(0,i.jsx)(X,{id:"year_installed",type:"number",min:"1980",max:new Date().getFullYear()+5,...N("year_installed",{valueAsNumber:!0,min:{value:1980,message:"Year must be 1980 or later"},max:{value:new Date().getFullYear()+5,message:"Year cannot be more than 5 years in the future"}})}),T.year_installed&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.year_installed.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"setup_time_minutes",children:"Setup Time (minutes)"}),(0,i.jsx)(X,{id:"setup_time_minutes",type:"number",min:"0",...N("setup_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Setup time must be non-negative"}})}),T.setup_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.setup_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"teardown_time_minutes",children:"Teardown Time (minutes)"}),(0,i.jsx)(X,{id:"teardown_time_minutes",type:"number",min:"0",...N("teardown_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Teardown time must be non-negative"}})}),T.teardown_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.teardown_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"maintenance_window_start",children:"Maintenance Window Start (time units)"}),(0,i.jsx)(X,{id:"maintenance_window_start",type:"number",min:"0",max:"95",...N("maintenance_window_start",{valueAsNumber:!0,min:{value:0,message:"Time must be non-negative"},max:{value:95,message:"Maximum 95 time units (23:45)"}})}),T.maintenance_window_start&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.maintenance_window_start.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"maintenance_window_end",children:"Maintenance Window End (time units)"}),(0,i.jsx)(X,{id:"maintenance_window_end",type:"number",min:"0",max:"95",...N("maintenance_window_end",{valueAsNumber:!0,min:{value:0,message:"Time must be non-negative"},max:{value:95,message:"Maximum 95 time units (23:45)"}})}),T.maintenance_window_end&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.maintenance_window_end.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"last_maintenance_date",children:"Last Maintenance Date"}),(0,i.jsx)(X,{id:"last_maintenance_date",type:"date",...N("last_maintenance_date")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"next_maintenance_due",children:"Next Maintenance Due"}),(0,i.jsx)(X,{id:"next_maintenance_due",type:"date",...N("next_maintenance_due")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"maintenance_interval_hours",children:"Maintenance Interval (hours)"}),(0,i.jsx)(X,{id:"maintenance_interval_hours",type:"number",min:"1",...N("maintenance_interval_hours",{valueAsNumber:!0,min:{value:1,message:"Interval must be at least 1 hour"}})}),T.maintenance_interval_hours&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.maintenance_interval_hours.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"efficiency_rating",children:"Efficiency Rating"}),(0,i.jsx)(X,{id:"efficiency_rating",type:"number",min:"0.1",max:"2.0",step:"0.1",...q("efficiency_rating",{valueAsNumber:!0,min:{value:.1,message:"Efficiency must be at least 0.1"},max:{value:2,message:"Efficiency cannot exceed 2.0"}})}),T.efficiency_rating&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.efficiency_rating.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"average_utilization_percent",children:"Average Utilization (%)"}),(0,i.jsx)(X,{id:"average_utilization_percent",type:"number",min:"0",max:"100",...N("average_utilization_percent",{valueAsNumber:!0,min:{value:0,message:"Utilization must be non-negative"},max:{value:100,message:"Utilization cannot exceed 100%"}})}),T.average_utilization_percent&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.average_utilization_percent.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"uptime_target_percent",children:"Uptime Target (%)"}),(0,i.jsx)(X,{id:"uptime_target_percent",type:"number",min:"0",max:"100",...N("uptime_target_percent",{valueAsNumber:!0,min:{value:0,message:"Uptime target must be non-negative"},max:{value:100,message:"Uptime target cannot exceed 100%"}})}),T.uptime_target_percent&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.uptime_target_percent.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"calendar_id",children:"Calendar ID"}),(0,i.jsx)(X,{id:"calendar_id",...N("calendar_id"),placeholder:"Optional calendar reference"})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:E("is_active"),onCheckedChange:e=>{f.trackInteraction("click","is_active"),C("is_active",e)}}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[u&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{f.trackInteraction("click","cancel-button"),w(),p(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:h||!E("cell_id"),onClick:()=>f.trackInteraction("click","submit-button"),children:[h&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),u?"Update":"Create"," Machine"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"machine_resources",entityName:"Machine",sampleData:{name:"CNC Machine 01",capacity:1,cost_per_hour:45.5,department_id:null,cell_id:"",setup_time_minutes:15,teardown_time_minutes:10,maintenance_window_start:null,maintenance_window_end:null,last_maintenance_date:null,next_maintenance_due:null,maintenance_interval_hours:168,machine_type:"CNC",manufacturer:"Haas",model:"VF-2",year_installed:2020,efficiency_rating:.95,average_utilization_percent:null,uptime_target_percent:.9,calendar_id:null,is_active:!0},onUploadComplete:I,requiredFields:["name","cell_id"],fieldDescriptions:{name:"Machine display name",capacity:"Maximum concurrent jobs (default: 1)",cost_per_hour:"Operating cost per hour",cell_id:"Work cell ID (required)",efficiency_rating:"Efficiency (0.0 to 1.0)",uptime_target_percent:"Target uptime (0.0 to 1.0)"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsxs)(e_,{children:["Machines (",y.filteredCount," of ",y.totalCount,")"]}),(0,i.jsx)(ex,{children:"Manage existing machines with advanced filtering and bulk operations"})]}),(0,i.jsxs)(ef,{className:"space-y-4",children:[(0,i.jsx)(eJ,{options:[{key:"name",label:"Name",type:"text"},{key:"machine_type",label:"Type",type:"text"},{key:"manufacturer",label:"Manufacturer",type:"text"},{key:"is_active",label:"Active",type:"boolean"}],values:y.filters,onChange:y.setFilters,placeholder:"Search machines..."}),(0,i.jsx)(eY,{items:y.filteredItems,selectedItems:y.selectedItems,onToggleSelection:y.toggleSelection,onSelectAll:y.selectAll,onClearSelection:y.clearSelection,onBulkDelete:j,onBulkEdit:g,getId:e=>e.machine_resource_id,isSelectionMode:y.isSelectionMode,onEnterSelectionMode:y.enterSelectionMode}),d?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):y.isEmpty?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:y.filters.length>0?"No machines match your filters":"No machines found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[y.isSelectionMode&&(0,i.jsx)("th",{className:"text-left p-2 w-12",children:(0,i.jsx)("input",{type:"checkbox",checked:y.selectedItems.size===y.filteredItems.length,onChange:()=>{y.selectedItems.size===y.filteredItems.length?y.clearSelection():y.selectAll()},className:"rounded"})}),(0,i.jsx)("th",{className:"text-left p-2 font-medium cursor-pointer hover:bg-gray-50",onClick:()=>y.setSortBy("name"),children:"Name "}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Type"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Department"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Capacity"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Cost/Hour"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Efficiency"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:y.filteredItems.map(e=>{let t=s.find(t=>t.department_id===e.department_id),a=n.find(t=>t.cell_id===e.cell_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[y.isSelectionMode&&(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("input",{type:"checkbox",checked:y.selectedItems.has(e.machine_resource_id),onChange:()=>y.toggleSelection(e.machine_resource_id),className:"rounded"})}),(0,i.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,i.jsx)("td",{className:"p-2",children:e.machine_type||"-"}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{children:[t?"".concat(t.name," (").concat(t.code,")"):"-",a&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["Cell: ",a.name]})]})}),(0,i.jsx)("td",{className:"p-2",children:e.capacity}),(0,i.jsxs)("td",{className:"p-2",children:["$",e.cost_per_hour.toFixed(2)]}),(0,i.jsx)("td",{className:"p-2",children:e.efficiency_rating.toFixed(1)}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{f.trackInteraction("click","edit-button"),p(e.machine_resource_id),C("name",e.name),C("capacity",e.capacity),C("cost_per_hour",e.cost_per_hour),C("department_id",e.department_id||""),C("cell_id",e.cell_id),C("setup_time_minutes",e.setup_time_minutes),C("teardown_time_minutes",e.teardown_time_minutes),C("maintenance_window_start",e.maintenance_window_start||0),C("maintenance_window_end",e.maintenance_window_end||0),C("last_maintenance_date",e.last_maintenance_date||""),C("next_maintenance_due",e.next_maintenance_due||""),C("maintenance_interval_hours",e.maintenance_interval_hours),C("machine_type",e.machine_type||""),C("manufacturer",e.manufacturer||""),C("model",e.model||""),C("year_installed",e.year_installed||new Date().getFullYear()),C("efficiency_rating",e.efficiency_rating),C("average_utilization_percent",e.average_utilization_percent||85),C("uptime_target_percent",e.uptime_target_percent),C("calendar_id",e.calendar_id||""),C("is_active",e.is_active)},disabled:d,children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{f.trackInteraction("click","toggle-active-button"),g([e.machine_resource_id])},className:e.is_active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50",disabled:d,children:e.is_active?"Deactivate":"Reactivate"}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{f.trackInteraction("click","delete-button"),O(e.machine_resource_id)},className:"text-red-600 hover:bg-red-50",disabled:d,children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.machine_resource_id)})})]})})]})]})]})}var eK=s(314);let e0=[{value:"standard",label:"Standard"},{value:"complex",label:"Complex"},{value:"tooling_change",label:"Tooling Change"},{value:"calibration",label:"Calibration"},{value:"cleaning",label:"Cleaning"}],e2=[{value:"simple",label:"Simple"},{value:"moderate",label:"Moderate"},{value:"complex",label:"Complex"},{value:"expert_required",label:"Expert Required"}],e1=[{value:"NOVICE",label:"Novice"},{value:"COMPETENT",label:"Competent"},{value:"PROFICIENT",label:"Proficient"},{value:"EXPERT",label:"Expert"}];function e5(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[u,p]=(0,r.useState)(!1),{toast:h}=(0,J.dj)(),_=(0,eK.eu)("SetupTimeForm"),{register:x,handleSubmit:f,reset:y,setValue:j,watch:g,formState:{errors:b}}=(0,v.mN)({defaultValues:{from_optimized_task_id:"",to_optimized_task_id:"",machine_resource_id:"",setup_time_minutes:15,setup_type:"standard",complexity_level:"simple",requires_operator_skill:"",requires_certification:!1,requires_supervisor_approval:!1,setup_cost:0,efficiency_impact_percent:0,product_family_from:"",product_family_to:""}}),k=(0,r.useCallback)((e,t)=>{let s=performance.now(),a=!0,i="";try{switch(e){case"setup_time_minutes":i=(a=t>=0)?"":"Setup time must be non-negative";break;case"setup_cost":i=(a=t>=0)?"":"Cost must be non-negative";break;case"efficiency_impact_percent":i=(a=t>=0&&t<=100)?"":"Impact must be between 0 and 100%";break;default:a=!0}}catch(e){a=!1,i=String(e)}let r=performance.now()-s;return _.recordValidation(e,r,a,i),{isValid:a,error:i}},[_]),w=async()=>{o(!0),_.startTimer("fetch_setup_times");try{let{result:e}=await eK.oY.measureAsync(async()=>{let{data:e,error:t}=await N.N.from("optimized_task_setup_times").select("*").limit(10);if(t)throw t;return e||[]},"SetupTimeForm","supabase_fetch_setup_times",{table:"optimized_task_setup_times",limit:10});t(e),_.endTimer("fetch_setup_times","fetch_setup_times_complete",!0)}catch(t){let e=String(t);console.error("Error fetching setup times:",t),_.endTimer("fetch_setup_times","fetch_setup_times_error",!1,e),_.recordError(e,"fetch_setup_times"),h({title:"Error",description:"Failed to fetch setup times",variant:"destructive"})}finally{o(!1)}},S=async()=>{try{let{result:e}=await eK.oY.measureAsync(async()=>{let{data:e,error:t}=await N.N.from("optimized_tasks").select("\n              optimized_task_id,\n              name,\n              pattern_id,\n              job_optimized_patterns!inner(name)\n            ").order("name",{ascending:!0});if(t)throw t;return(null==e?void 0:e.map(e=>{var t;return{optimized_task_id:e.optimized_task_id,name:e.name,pattern_id:e.pattern_id,pattern_name:(null==(t=e.job_optimized_patterns)?void 0:t.name)||"Unknown Pattern"}}))||[]},"SetupTimeForm","supabase_fetch_template_tasks",{table:"optimized_tasks",orderBy:"name"});a(e)}catch(t){let e=String(t);console.error("Error fetching template tasks:",t),_.recordError(e,"fetch_template_tasks")}},C=async()=>{try{let{result:e}=await eK.oY.measureAsync(async()=>{let{data:e,error:t}=await N.N.from("machines").select("machine_resource_id, name").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;return e||[]},"SetupTimeForm","supabase_fetch_machines",{table:"machines",filter:"is_active=true"});l(e)}catch(t){let e=String(t);console.error("Error fetching machines:",t),_.recordError(e,"fetch_machines")}};(0,r.useEffect)(()=>{(async()=>{_.startTimer("form_load");try{await Promise.all([w(),S(),C()]);let e=_.endTimer("form_load","form_initial_load",!0);_.recordFormLoad(e)}catch(t){let e=String(t);_.endTimer("form_load","form_initial_load",!1,e),_.recordError(e,"form_initial_load")}})()},[_]);let E=async e=>{p(!0),_.startTimer("form_submission");try{let t=performance.now();if(e.from_optimized_task_id===e.to_optimized_task_id){let e=performance.now()-t;_.recordValidation("task_ids_different",e,!1,"From and To tasks must be different"),_.endTimer("form_submission","form_submission_validation_error",!1,"From and To tasks must be different"),h({title:"Error",description:"From and To tasks must be different",variant:"destructive"}),p(!1);return}let s=performance.now()-t;_.recordValidation("form_validation",s,!0);let a={from_optimized_task_id:e.from_optimized_task_id,to_optimized_task_id:e.to_optimized_task_id,machine_resource_id:e.machine_resource_id,setup_time_minutes:e.setup_time_minutes,setup_type:e.setup_type,complexity_level:e.complexity_level,requires_operator_skill:e.requires_operator_skill||null,requires_certification:e.requires_certification,requires_supervisor_approval:e.requires_supervisor_approval,setup_cost:e.setup_cost,efficiency_impact_percent:e.efficiency_impact_percent,product_family_from:e.product_family_from||null,product_family_to:e.product_family_to||null},{duration:i}=await eK.oY.measureAsync(async()=>{if(d){let{error:e}=await N.N.from("optimized_task_setup_times").update(a).eq("setup_time_id",d);if(e)throw e;return"update"}{let{error:e}=await N.N.from("optimized_task_setup_times").insert([a]);if(e)throw e;return"insert"}},"SetupTimeForm",d?"supabase_update_setup_time":"supabase_insert_setup_time",{editing:!!d,setup_time_minutes:e.setup_time_minutes,setup_type:e.setup_type,complexity_level:e.complexity_level}),r=_.endTimer("form_submission","form_submission_success",!0);_.recordSubmission(r,!0,void 0,{operation:d?"update":"create",database_duration:i,total_duration:r}),h({title:"Success",description:d?"Setup time updated successfully":"Setup time created successfully"}),y(),m(null),w()}catch(s){let e=String(s);console.error("Error saving setup time:",s);let t=_.endTimer("form_submission","form_submission_error",!1,e);_.recordSubmission(t,!1,e,{operation:d?"update":"create"}),h({title:"Error",description:"Failed to save setup time",variant:"destructive"})}finally{p(!1)}},T=async e=>{if(_.recordInteraction("delete_button_click",void 0,{setup_time_id:e}),!confirm("Are you sure you want to delete this setup time?"))return void _.recordInteraction("delete_cancelled");_.recordInteraction("delete_confirmed"),_.startTimer("delete_operation");try{let{duration:t}=await eK.oY.measureAsync(async()=>{let{error:t}=await N.N.from("optimized_task_setup_times").delete().eq("setup_time_id",e);if(t)throw t},"SetupTimeForm","supabase_delete_setup_time",{setup_time_id:e});_.endTimer("delete_operation","delete_operation_success",!0),h({title:"Success",description:"Setup time deleted successfully"}),w()}catch(t){let e=String(t);console.error("Error deleting setup time:",t),_.endTimer("delete_operation","delete_operation_error",!1,e),_.recordError(e,"delete_setup_time"),h({title:"Error",description:"Failed to delete setup time",variant:"destructive"})}},F=(0,r.useCallback)(e=>{_.recordInteraction("focus",e)},[_]),q=(0,r.useCallback)((e,t)=>{_.recordInteraction("blur",e),k(e,t)},[_,k]),A=(0,r.useCallback)((e,t)=>{_.recordInteraction("change",e,{value:"string"==typeof t?t.length:t}),k(e,t)},[_,k]);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:d?"Edit Setup Time":"Create New Setup Time"}),(0,i.jsx)(ex,{children:d?"Update setup time configuration":"Define setup times between template tasks for constraint generation"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:f(E),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"from_optimized_task_id",children:"From Template Task *"}),(0,i.jsxs)(en,{onValueChange:e=>{j("from_optimized_task_id",e),A("from_optimized_task_id",e)},onOpenChange:e=>{e?F("from_optimized_task_id"):q("from_optimized_task_id",g("from_optimized_task_id"))},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select from task"})}),(0,i.jsx)(em,{children:s.map(e=>(0,i.jsxs)(eu,{value:e.optimized_task_id,children:[e.pattern_name," - ",e.name]},e.optimized_task_id))})]}),!g("from_optimized_task_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"From task is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"to_optimized_task_id",children:"To Template Task *"}),(0,i.jsxs)(en,{onValueChange:e=>{j("to_optimized_task_id",e),A("to_optimized_task_id",e)},onOpenChange:e=>{e?F("to_optimized_task_id"):q("to_optimized_task_id",g("to_optimized_task_id"))},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select to task"})}),(0,i.jsx)(em,{children:s.filter(e=>e.optimized_task_id!==g("from_optimized_task_id")).map(e=>(0,i.jsxs)(eu,{value:e.optimized_task_id,children:[e.pattern_name," - ",e.name]},e.optimized_task_id))})]}),!g("to_optimized_task_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"To task is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"machine_resource_id",children:"Machine *"}),(0,i.jsxs)(en,{onValueChange:e=>{j("machine_resource_id",e),A("machine_resource_id",e)},onOpenChange:e=>{e?F("machine_resource_id"):q("machine_resource_id",g("machine_resource_id"))},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select machine"})}),(0,i.jsx)(em,{children:n.map(e=>(0,i.jsx)(eu,{value:e.machine_resource_id,children:e.name},e.machine_resource_id))})]}),!g("machine_resource_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Machine is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"setup_time_minutes",children:"Setup Time (minutes) *"}),(0,i.jsx)(X,{id:"setup_time_minutes",type:"number",min:"0",...x("setup_time_minutes",{valueAsNumber:!0,required:"Setup time is required",min:{value:0,message:"Setup time must be non-negative"}}),onFocus:()=>F("setup_time_minutes"),onBlur:e=>q("setup_time_minutes",parseFloat(e.target.value)||0),onChange:e=>A("setup_time_minutes",parseFloat(e.target.value)||0)}),b.setup_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:b.setup_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"setup_type",children:"Setup Type"}),(0,i.jsxs)(en,{onValueChange:e=>{j("setup_type",e),A("setup_type",e)},onOpenChange:e=>{e?F("setup_type"):q("setup_type",g("setup_type"))},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select setup type"})}),(0,i.jsx)(em,{children:e0.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"complexity_level",children:"Complexity Level"}),(0,i.jsxs)(en,{onValueChange:e=>{j("complexity_level",e),A("complexity_level",e)},onOpenChange:e=>{e?F("complexity_level"):q("complexity_level",g("complexity_level"))},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select complexity"})}),(0,i.jsx)(em,{children:e2.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"requires_operator_skill",children:"Required Operator Skill"}),(0,i.jsxs)(en,{onValueChange:e=>{j("requires_operator_skill",e),A("requires_operator_skill",e)},onOpenChange:e=>{e?F("requires_operator_skill"):q("requires_operator_skill",g("requires_operator_skill"))},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select skill level"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Specific Requirement"}),e1.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"setup_cost",children:"Setup Cost ($)"}),(0,i.jsx)(X,{id:"setup_cost",type:"number",min:"0",step:"0.01",...x("setup_cost",{valueAsNumber:!0,min:{value:0,message:"Cost must be non-negative"}}),onFocus:()=>F("setup_cost"),onBlur:e=>q("setup_cost",parseFloat(e.target.value)||0),onChange:e=>A("setup_cost",parseFloat(e.target.value)||0)}),b.setup_cost&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:b.setup_cost.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"efficiency_impact_percent",children:"Efficiency Impact (%)"}),(0,i.jsx)(X,{id:"efficiency_impact_percent",type:"number",min:"0",max:"100",step:"0.1",...x("efficiency_impact_percent",{valueAsNumber:!0,min:{value:0,message:"Impact must be non-negative"},max:{value:100,message:"Impact cannot exceed 100%"}}),onFocus:()=>F("efficiency_impact_percent"),onBlur:e=>q("efficiency_impact_percent",parseFloat(e.target.value)||0),onChange:e=>A("efficiency_impact_percent",parseFloat(e.target.value)||0)}),b.efficiency_impact_percent&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:b.efficiency_impact_percent.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"product_family_from",children:"Product Family From"}),(0,i.jsx)(X,{id:"product_family_from",...x("product_family_from"),placeholder:"e.g., Product A, Family X",onFocus:()=>F("product_family_from"),onBlur:e=>q("product_family_from",e.target.value),onChange:e=>A("product_family_from",e.target.value)})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"product_family_to",children:"Product Family To"}),(0,i.jsx)(X,{id:"product_family_to",...x("product_family_to"),placeholder:"e.g., Product B, Family Y",onFocus:()=>F("product_family_to"),onBlur:e=>q("product_family_to",e.target.value),onChange:e=>A("product_family_to",e.target.value)})]})]}),(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"requires_certification",checked:g("requires_certification"),onCheckedChange:e=>{j("requires_certification",e),A("requires_certification",e)},onFocus:()=>F("requires_certification"),onBlur:()=>q("requires_certification",g("requires_certification"))}),(0,i.jsx)(Z,{htmlFor:"requires_certification",children:"Requires Certification"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"requires_supervisor_approval",checked:g("requires_supervisor_approval"),onCheckedChange:e=>{j("requires_supervisor_approval",e),A("requires_supervisor_approval",e)},onFocus:()=>F("requires_supervisor_approval"),onBlur:()=>q("requires_supervisor_approval",g("requires_supervisor_approval"))}),(0,i.jsx)(Z,{htmlFor:"requires_supervisor_approval",children:"Requires Supervisor Approval"})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[d&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{_.recordInteraction("cancel_button_click"),y(),m(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:u||!g("from_optimized_task_id")||!g("to_optimized_task_id")||!g("machine_resource_id"),onClick:()=>_.recordInteraction("submit_button_click"),children:[u&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Update":"Create"," Setup Time"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"setup_times",entityName:"Setup Time",sampleData:{from_optimized_task_id:"",to_optimized_task_id:"",machine_resource_id:"",setup_time_minutes:30,teardown_time_minutes:15,changeover_cost:25,complexity_factor:1.2,is_active:!0},onUploadComplete:w,requiredFields:["from_optimized_task_id","to_optimized_task_id","machine_resource_id","setup_time_minutes"],fieldDescriptions:{from_optimized_task_id:"Source task ID",to_optimized_task_id:"Target task ID",machine_resource_id:"Machine ID (required)",setup_time_minutes:"Setup duration in minutes",teardown_time_minutes:"Teardown duration in minutes",changeover_cost:"Cost of changeover operation"}})})]}),!1,(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Setup Times"}),(0,i.jsx)(ex,{children:"Manage existing setup times between template tasks"})]}),(0,i.jsx)(ef,{children:c?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No setup times found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"From Task"}),(0,i.jsx)("th",{className:"text-left p-2",children:"To Task"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Machine"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Time (min)"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Type"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Complexity"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Cost"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{var t,s,a,r,n,l;return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)("div",{className:"font-medium",children:(null==(t=e.from_task)?void 0:t.name)||"Unknown"})})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("div",{className:"text-sm",children:(0,i.jsx)("div",{className:"font-medium",children:(null==(s=e.to_task)?void 0:s.name)||"Unknown"})})}),(0,i.jsx)("td",{className:"p-2",children:(null==(a=e.machine)?void 0:a.name)||"Unknown"}),(0,i.jsx)("td",{className:"p-2 font-medium",children:e.setup_time_minutes}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"capitalize",children:(null==(r=e.setup_type)?void 0:r.replace("_"," "))||"Standard"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"capitalize",children:(null==(n=e.complexity_level)?void 0:n.replace("_"," "))||"Simple"})}),(0,i.jsxs)("td",{className:"p-2",children:["$",(null==(l=e.setup_cost)?void 0:l.toFixed(2))||"0.00"]}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{_.recordInteraction("edit_button_click",void 0,{setup_time_id:e.setup_time_id}),_.startTimer("populate_form"),m(e.setup_time_id),j("from_optimized_task_id",e.from_optimized_task_id),j("to_optimized_task_id",e.to_optimized_task_id),j("machine_resource_id",e.machine_resource_id),j("setup_time_minutes",e.setup_time_minutes),j("setup_type",e.setup_type),j("complexity_level",e.complexity_level),j("requires_certification",e.requires_certification),j("setup_cost",e.setup_cost),_.endTimer("populate_form","populate_form_for_edit",!0)},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>T(e.setup_time_id),children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.setup_time_id)})})]})})})]})]})}let e4=[{value:"linear",label:"Linear"},{value:"exponential",label:"Exponential"},{value:"logarithmic",label:"Logarithmic"},{value:"plateau",label:"Plateau"}];function e6(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)([]),[d,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),[h,_]=(0,r.useState)(!1),{toast:x}=(0,J.dj)();eX("template-task-form");let{register:f,handleSubmit:y,reset:j,setValue:g,watch:b,formState:{errors:k}}=(0,v.mN)({defaultValues:{pattern_id:"",name:"",position:1,department_id:"",is_unattended:!1,is_setup:!1,sequence_id:"",min_operators:1,max_operators:1,operator_efficiency_curve:"linear"}}),w=async()=>{m(!0);try{let{data:e,error:s}=await N.N.from("optimized_tasks").select("\n          *,\n          job_optimized_patterns!inner(name)\n        ").order("position",{ascending:!0});if(s)throw s;t(e||[])}catch(e){console.error("Error fetching optimized tasks:",e),x({title:"Error",description:"Failed to fetch optimized tasks",variant:"destructive"})}finally{m(!1)}},S=async()=>{try{let{data:e,error:t}=await N.N.from("job_optimized_patterns").select("pattern_id, name").order("name",{ascending:!0});if(t)throw t;a(e||[])}catch(e){console.error("Error fetching job optimized patterns:",e)}},C=async()=>{try{let{data:e,error:t}=await N.N.from("departments").select("department_id, name, code").order("name",{ascending:!0});if(t)throw t;l(e||[])}catch(e){console.error("Error fetching departments:",e)}},E=async()=>{try{let{data:e,error:t}=await N.N.from("sequence_resources").select("sequence_id, name").order("name",{ascending:!0});if(t)throw t;o(e||[])}catch(e){console.error("Error fetching sequence resources:",e)}};(0,r.useEffect)(()=>{w(),S(),C(),E()},[]);let T=async e=>{_(!0);try{let t={pattern_id:e.pattern_id,name:e.name,position:e.position,department_id:e.department_id||null,is_unattended:e.is_unattended,is_setup:e.is_setup,sequence_id:e.sequence_id||null,min_operators:e.min_operators,max_operators:e.max_operators,operator_efficiency_curve:e.operator_efficiency_curve||null};if(u){let{error:e}=await N.N.from("optimized_tasks").update(t).eq("optimized_task_id",u);if(e)throw e;x({title:"Success",description:"Optimized task updated successfully"})}else{let{error:e}=await N.N.from("optimized_tasks").insert([t]);if(e)throw e;x({title:"Success",description:"Optimized task created successfully"})}j(),p(null),w()}catch(e){console.error("Error saving optimized task:",e),x({title:"Error",description:"Failed to save optimized task",variant:"destructive"})}finally{_(!1)}},F=async e=>{if(confirm("Are you sure you want to delete this optimized task?"))try{let{error:t}=await N.N.from("optimized_tasks").delete().eq("optimized_task_id",e);if(t)throw t;x({title:"Success",description:"Optimized task deleted successfully"}),w()}catch(e){console.error("Error deleting optimized task:",e),x({title:"Error",description:"Failed to delete optimized task",variant:"destructive"})}};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:u?"Edit Optimized Task":"Create New Optimized Task"}),(0,i.jsx)(ex,{children:u?"Update optimized task information":"Add a new task to a job optimized pattern"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:y(T),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"pattern_id",children:"Job Optimized Pattern *"}),(0,i.jsxs)(en,{onValueChange:e=>g("pattern_id",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select job optimized pattern"})}),(0,i.jsx)(em,{children:s.map(e=>(0,i.jsx)(eu,{value:e.pattern_id,children:e.name},e.pattern_id))})]}),!b("pattern_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Job optimized pattern is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Task Name *"}),(0,i.jsx)(X,{id:"name",...f("name",{required:"Task name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., Assembly Step 1"}),k.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"position",children:"Position *"}),(0,i.jsx)(X,{id:"position",type:"number",min:"1",...f("position",{valueAsNumber:!0,required:"Position is required",min:{value:1,message:"Position must be at least 1"}})}),k.position&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.position.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department *"}),(0,i.jsxs)(en,{onValueChange:e=>g("department_id",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsx)(em,{children:n.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))})]}),!b("department_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Department is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"sequence_id",children:"Sequence Resource"}),(0,i.jsxs)(en,{onValueChange:e=>g("sequence_id",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select sequence resource"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Sequence Resource"}),c.map(e=>(0,i.jsxs)(eu,{value:e.sequence_id,children:[e.name," (",e.sequence_id,")"]},e.sequence_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"min_operators",children:"Minimum Operators"}),(0,i.jsx)(X,{id:"min_operators",type:"number",min:"1",...f("min_operators",{valueAsNumber:!0,min:{value:1,message:"Must have at least 1 operator"}})}),k.min_operators&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.min_operators.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"max_operators",children:"Maximum Operators"}),(0,i.jsx)(X,{id:"max_operators",type:"number",min:"1",...f("max_operators",{valueAsNumber:!0,min:{value:1,message:"Must have at least 1 operator"},validate:e=>e>=(b("min_operators")||1)||"Maximum must be >= minimum operators"})}),k.max_operators&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:k.max_operators.message})]})]}),(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_unattended",checked:b("is_unattended"),onCheckedChange:e=>g("is_unattended",e)}),(0,i.jsx)(Z,{htmlFor:"is_unattended",children:"Unattended Operation"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Task can run without operator supervision"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_setup",checked:b("is_setup"),onCheckedChange:e=>g("is_setup",e)}),(0,i.jsx)(Z,{htmlFor:"is_setup",children:"Setup Task"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"This is a setup or preparation task"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"operator_efficiency_curve",children:"Operator Efficiency Curve"}),(0,i.jsxs)(en,{value:b("operator_efficiency_curve"),onValueChange:e=>g("operator_efficiency_curve",e),children:[(0,i.jsx)(ec,{id:"operator_efficiency_curve",children:(0,i.jsx)(el,{placeholder:"Select efficiency curve"})}),(0,i.jsx)(em,{children:e4.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"How operator efficiency changes with experience"})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[u&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{j(),p(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:h||!b("pattern_id")||!b("department_id"),children:[h&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),u?"Update":"Create"," Task"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"optimized_tasks",entityName:"Template Task",sampleData:{pattern_id:"",name:"Assembly Step 1",position:1,department_id:null,is_unattended:!1,is_setup:!1,sequence_id:null,min_operators:1,max_operators:2,operator_efficiency_curve:"linear"},onUploadComplete:w,requiredFields:["pattern_id","name","position"],fieldDescriptions:{pattern_id:"Job optimized pattern ID (required)",name:"Task display name",position:"Task position in sequence (integer)",department_id:"Department ID where task is performed",min_operators:"Minimum operators required (default: 1)",max_operators:"Maximum operators that can work (default: 1)",is_unattended:"Can run without supervision (true/false)",is_setup:"Is a setup/preparation task (true/false)",operator_efficiency_curve:"linear, exponential, logarithmic, plateau"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Optimized Tasks"}),(0,i.jsx)(ex,{children:"Manage existing optimized tasks"})]}),(0,i.jsx)(ef,{children:d?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No optimized tasks found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Position"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Task Name"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Pattern"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Department"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Operators"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Efficiency Curve"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Flags"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{var t;let s=n.find(t=>t.department_id===e.department_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:e.position}),(0,i.jsx)("td",{className:"p-2",children:e.name}),(0,i.jsx)("td",{className:"p-2",children:(null==(t=e.job_optimized_patterns)?void 0:t.name)||"Unknown"}),(0,i.jsx)("td",{className:"p-2",children:s?"".concat(s.name," (").concat(s.code,")"):"-"}),(0,i.jsxs)("td",{className:"p-2",children:[e.min_operators,"-",e.max_operators]}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"capitalize",children:e.operator_efficiency_curve||"linear"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.is_setup&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:"Setup"}),e.is_unattended&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-green-100 text-green-800",children:"Unattended"})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{p(e.optimized_task_id),g("pattern_id",e.pattern_id),g("name",e.name),g("position",e.position),g("department_id",e.department_id||""),g("is_unattended",e.is_unattended),g("is_setup",e.is_setup),g("sequence_id",e.sequence_id||""),g("operator_efficiency_curve",e.operator_efficiency_curve||"linear"),g("min_operators",e.min_operators),g("max_operators",e.max_operators)},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>F(e.optimized_task_id),children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.optimized_task_id)})})]})})})]})]})}s(8405);class e3{getMetrics(){return[]}getWebVitals(){return[]}getSlowQueries(){return[]}getAverageQueryTime(){return 0}getPerformanceSummary(){return{totalQueries:0,slowQueries:0,averageQueryTime:0,poorWebVitals:0,lastUpdated:new Date().toISOString()}}clear(){}}Promise.resolve().then(s.bind(s,8405)).then(e=>{a=e.performanceMonitor}),a=new e3;class e8{trackPageView(e){if(!this.isEnabled)return;let t=this.pageMetrics.get(e)||{pageLoads:0,userActions:0,sessionDuration:0,lastActivity:Date.now()};this.pageMetrics.set(e,{...t,pageLoads:t.pageLoads+1,lastActivity:Date.now()}),a.getMetrics()}trackUserAction(e,t,s){if(!this.isEnabled)return;let a={type:e,target:t,timestamp:Date.now(),metadata:s};for(let[e,t]of(this.userActions.push(a),this.userActions.length>1e3&&(this.userActions=this.userActions.slice(-500)),this.pageMetrics.entries())){this.pageMetrics.set(e,{...t,userActions:t.userActions+1,lastActivity:Date.now()});break}}getMetrics(){return{pages:Object.fromEntries(this.pageMetrics),actions:[...this.userActions],sessionDuration:Date.now()-this.sessionStart,isEnabled:this.isEnabled}}setEnabled(e){this.isEnabled=e}clear(){this.pageMetrics.clear(),this.userActions=[]}constructor(){this.pageMetrics=new Map,this.userActions=[],this.sessionStart=Date.now(),this.isEnabled=!0}}function e9(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(!1),{toast:h}=(0,J.dj)(),_=(0,eK.eu)("WorkCellForm"),x=eL(e,e=>e.cell_id,{enableFiltering:!0,enableBulkOperations:!0,enableSorting:!0}),f=(0,r.useCallback)((e,t)=>{let s=performance.now(),a=!0,i="";try{switch(e){case"name":i=(a="string"==typeof t&&t.trim().length>0)?"":"Work cell name is required";break;case"capacity":i=(a=Number.isInteger(t)&&t>=1)?"":"Capacity must be at least 1";break;case"wip_limit":i=(a=Number.isInteger(t)&&t>=0)?"":"WIP limit must be non-negative";break;case"target_utilization":i=(a="number"==typeof t&&t>=0&&t<=100)?"":"Target utilization must be between 0 and 100%";break;case"flow_priority":i=(a=Number.isInteger(t)&&t>=1)?"":"Flow priority must be at least 1";break;case"average_throughput_per_hour":i=(a="number"==typeof t&&t>=0)?"":"Throughput must be non-negative";break;case"cell_type":i=(a=U.includes(t))?"":"Invalid cell type";break;default:a=!0}}catch(e){a=!1,i=String(e)}let r=performance.now()-s;return _.recordValidation(e,r,a,i),{isValid:a,error:i}},[_]),y=async e=>{for(let t of e){let e=await F.delete(t);if(!e.success)return void h({title:"Error",description:"Failed to delete work cell: ".concat(e.error),variant:"destructive"})}h({title:"Success",description:"Successfully deleted ".concat(e.length," work cells")}),T(),x.clearSelection()},j=async t=>{for(let s of t){let t=e.find(e=>e.cell_id===s);if(t){let e=await F.update(s,{is_active:!t.is_active});if(!e.success)return void h({title:"Error",description:"Failed to update work cell: ".concat(e.error),variant:"destructive"})}}h({title:"Success",description:"Successfully updated ".concat(t.length," work cells")}),T(),x.clearSelection()},{register:g,handleSubmit:N,reset:k,setValue:w,watch:C,formState:{errors:E}}=(0,v.mN)({resolver:(0,b.u)(B),defaultValues:{name:"",capacity:1,department_id:"",wip_limit:5,flow_priority:1,floor_location:"",cell_type:"production",target_utilization:85,calendar_id:"",average_throughput_per_hour:0,is_active:!0}}),T=async()=>{l(!0),_.startTimer("fetch_work_cells");try{let{result:e}=await eK.oY.measureAsync(async()=>await F.getAll(),"WorkCellForm","service_fetch_work_cells");if(e.success&&e.data)t(e.data),_.endTimer("fetch_work_cells","fetch_work_cells_complete",!0);else{let t=e.error||"Failed to fetch work cells";console.error("Error fetching work cells:",e.error),_.endTimer("fetch_work_cells","fetch_work_cells_error",!1,t),_.recordError(t,"fetch_work_cells"),h({title:"Error",description:t,variant:"destructive"})}}catch(t){let e=String(t);_.endTimer("fetch_work_cells","fetch_work_cells_exception",!1,e),_.recordError(e,"fetch_work_cells"),h({title:"Error",description:"Failed to fetch work cells",variant:"destructive"})}finally{l(!1)}},q=async()=>{try{let{result:e}=await eK.oY.measureAsync(async()=>await S.getAll(!0),"WorkCellForm","service_fetch_departments");if(e.success&&e.data)a(e.data);else{let t=e.error||"Failed to fetch departments";console.error("Error fetching departments:",e.error),_.recordError(t,"fetch_departments")}}catch(t){let e=String(t);_.recordError(e,"fetch_departments")}};(0,r.useEffect)(()=>{let e=performance.now();_.startTimer("form_initial_load"),(async()=>{try{await Promise.all([T(),q()]);let t=performance.now()-e;_.recordFormLoad(t),_.endTimer("form_initial_load","form_load_complete",!0)}catch(t){let e=String(t);_.endTimer("form_initial_load","form_load_error",!1,e),_.recordError(e,"form_initial_load")}})()},[_]),(0,r.useEffect)(()=>()=>{},[_]);let A=async e=>{m(!0);let t=performance.now();_.startTimer("form_submission");try{let{result:s}=await eK.oY.measureAsync(async()=>{if(c)return await F.update(c,e);if(!e.name)throw Error("Name is required for creating work cells");return await F.create(e)},"WorkCellForm",c?"service_update_work_cell":"service_create_work_cell",{editingId:c,operation:c?"update":"create"}),a=performance.now()-t;if(s.success)_.recordSubmission(a,!0,void 0,{operation:c?"update":"create",workCellId:c}),_.endTimer("form_submission","form_submission_success",!0),h({title:"Success",description:"Work cell ".concat(c?"updated":"created"," successfully")}),k(),o(null),T();else{let e=s.error||"Failed to save work cell";_.recordSubmission(a,!1,e,{operation:c?"update":"create",workCellId:c}),_.endTimer("form_submission","form_submission_error",!1,e),_.recordError(e,"form_submission"),console.error("Error saving work cell:",s.error),h({title:"Error",description:e,variant:"destructive"})}}catch(a){let e=String(a),s=performance.now()-t;_.recordSubmission(s,!1,e),_.endTimer("form_submission","form_submission_exception",!1,e),_.recordError(e,"form_submission"),h({title:"Error",description:"Failed to save work cell",variant:"destructive"})}finally{m(!1)}},M=async e=>{if(!confirm("Are you sure you want to delete this work cell?"))return;let t=await F.delete(e);t.success?(h({title:"Success",description:"Work cell deleted successfully"}),T()):(console.error("Error deleting work cell:",t.error),h({title:"Error",description:t.error||"Failed to delete work cell",variant:"destructive"}))};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-3",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"}),!1]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:c?"Edit Work Cell":"Create New Work Cell"}),(0,i.jsx)(ex,{children:c?"Update work cell information":"Add a new work cell for capacity and WIP constraints"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:N(A),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Cell Name *"}),(0,i.jsx)(X,{id:"name",...g("name"),placeholder:"e.g., Production Cell A",onFocus:()=>_.recordInteraction("focus","name"),onBlur:e=>{_.recordInteraction("blur","name"),f("name",e.target.value)},onChange:e=>{_.recordInteraction("change","name")}}),E.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"cell_type",children:"Cell Type"}),(0,i.jsxs)(en,{onValueChange:e=>{w("cell_type",e),_.recordInteraction("select","cell_type",{value:e}),f("cell_type",e)},children:[(0,i.jsx)(ec,{onFocus:()=>_.recordInteraction("focus","cell_type"),children:(0,i.jsx)(el,{placeholder:"Select cell type"})}),(0,i.jsx)(em,{children:U.map(e=>(0,i.jsx)(eu,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department"}),(0,i.jsxs)(en,{onValueChange:e=>w("department_id",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Department"}),s.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"floor_location",children:"Floor Location"}),(0,i.jsx)(X,{id:"floor_location",...g("floor_location"),placeholder:"e.g., Building A, Floor 2, Zone 3"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"capacity",children:"Capacity"}),(0,i.jsx)(X,{id:"capacity",type:"number",min:"1",...g("capacity",{valueAsNumber:!0}),onFocus:()=>_.recordInteraction("focus","capacity"),onBlur:e=>{_.recordInteraction("blur","capacity"),f("capacity",parseInt(e.target.value))},onChange:()=>_.recordInteraction("change","capacity")}),E.capacity&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.capacity.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"wip_limit",children:"WIP Limit"}),(0,i.jsx)(X,{id:"wip_limit",type:"number",min:"0",...g("wip_limit",{valueAsNumber:!0})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Work-in-progress limit for constraint generation"}),E.wip_limit&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.wip_limit.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"utilization_target_percent",children:"Target Utilization (%)"}),(0,i.jsx)(X,{id:"utilization_target_percent",type:"number",min:"0",max:"100",step:"0.1",...g("target_utilization",{valueAsNumber:!0}),placeholder:"85.0"}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Target capacity utilization percentage for optimization"}),E.target_utilization&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.target_utilization.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"flow_priority",children:"Flow Priority"}),(0,i.jsx)(X,{id:"flow_priority",type:"number",min:"1",...g("flow_priority",{valueAsNumber:!0,min:{value:1,message:"Priority must be at least 1"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Higher numbers = higher priority"}),E.flow_priority&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.flow_priority.message})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:C("is_active"),onCheckedChange:e=>w("is_active",!!e)}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[c&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{_.recordInteraction("click","cancel_button"),k(),o(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:d,onClick:()=>_.recordInteraction("click","submit_button",{isEdit:!!c}),children:[d&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update":"Create"," Work Cell"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"work_cells",entityName:"Work Cell",sampleData:{name:"Assembly Line A",type:"ASSEMBLY",department_id:null,max_capacity:5,efficiency_rating:.95,hourly_rate:35,setup_time_minutes:30,teardown_time_minutes:15,is_active:!0},onUploadComplete:T,requiredFields:["name","type"],fieldDescriptions:{name:"Work cell display name",type:"Cell type (e.g., ASSEMBLY, MACHINING, QUALITY)",max_capacity:"Maximum concurrent jobs",efficiency_rating:"Efficiency rating (0.0 to 1.0)",hourly_rate:"Operating cost per hour"}})}),!1]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsxs)(e_,{children:["Work Cells (",x.filteredCount," of ",x.totalCount,")"]}),(0,i.jsx)(ex,{children:"Manage existing work cells with advanced filtering and bulk operations"})]}),(0,i.jsxs)(ef,{className:"space-y-4",children:[(0,i.jsx)(eJ,{options:[{key:"name",label:"Name",type:"text"},{key:"cell_type",label:"Cell Type",type:"text"},{key:"department_id",label:"Department",type:"text"},{key:"is_active",label:"Active",type:"boolean"}],values:x.filters,onChange:x.setFilters,placeholder:"Search work cells..."}),(0,i.jsx)(eY,{items:x.filteredItems,selectedItems:x.selectedItems,onToggleSelection:x.toggleSelection,onSelectAll:()=>x.selectAll(x.filteredItems,e=>e.cell_id),onClearSelection:x.clearSelection,onBulkDelete:y,onBulkEdit:j,getId:e=>e.cell_id,isSelectionMode:x.isSelectionMode,onEnterSelectionMode:x.enterSelectionMode}),n?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):x.isEmpty?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:x.filters.length>0?"No work cells match your filters":"No work cells found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[x.isSelectionMode&&(0,i.jsx)("th",{className:"text-left p-2 w-12",children:(0,i.jsx)("input",{type:"checkbox",checked:x.selectedItems.size===x.filteredItems.length,onChange:()=>{x.selectedItems.size===x.filteredItems.length?x.clearSelection():x.selectAll(x.filteredItems,e=>e.cell_id)},className:"rounded"})}),(0,i.jsx)("th",{className:"text-left p-2 font-medium cursor-pointer hover:bg-gray-50",onClick:()=>x.setSortBy("name"),children:"Name "}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Type"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Department"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Capacity"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"WIP Limit"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Target Util."}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Priority"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2 font-medium",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:x.filteredItems.map(e=>{let t=s.find(t=>t.department_id===e.department_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[x.isSelectionMode&&(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("input",{type:"checkbox",checked:x.selectedItems.has(e.cell_id),onChange:()=>x.toggleSelection(e.cell_id),className:"rounded"})}),(0,i.jsx)("td",{className:"p-2 font-medium",children:(0,i.jsxs)("div",{children:[e.name,e.floor_location&&(0,i.jsx)("div",{className:"text-xs text-gray-500",children:e.floor_location})]})}),(0,i.jsx)("td",{className:"p-2 capitalize",children:e.cell_type}),(0,i.jsx)("td",{className:"p-2",children:t?"".concat(t.name," (").concat(t.code,")"):"-"}),(0,i.jsx)("td",{className:"p-2",children:e.capacity}),(0,i.jsx)("td",{className:"p-2",children:e.wip_limit||"-"}),(0,i.jsxs)("td",{className:"p-2",children:[(100*e.target_utilization).toFixed(1),"%"]}),(0,i.jsx)("td",{className:"p-2",children:e.flow_priority}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{_.recordInteraction("click","edit_button",{workCellId:e.cell_id}),o(e.cell_id),w("name",e.name),w("capacity",e.capacity),w("department_id",e.department_id||""),w("wip_limit",e.wip_limit||0),w("target_utilization",100*e.target_utilization),w("flow_priority",e.flow_priority),w("floor_location",e.floor_location||""),w("cell_type",e.cell_type),w("is_active",e.is_active)},disabled:n,children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{_.recordInteraction("click","toggle_active_button",{workCellId:e.cell_id,action:e.is_active?"deactivate":"reactivate"}),j([e.cell_id])},className:e.is_active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50",disabled:n,children:e.is_active?"Deactivate":"Reactivate"}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{_.recordInteraction("click","delete_button",{workCellId:e.cell_id}),M(e.cell_id)},className:"text-red-600 hover:bg-red-50",disabled:n,children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.cell_id)})})]})})]})]})]})}new e8;let e7=[{bit:0,label:"Monday",abbr:"Mon"},{bit:1,label:"Tuesday",abbr:"Tue"},{bit:2,label:"Wednesday",abbr:"Wed"},{bit:3,label:"Thursday",abbr:"Thu"},{bit:4,label:"Friday",abbr:"Fri"},{bit:5,label:"Saturday",abbr:"Sat"},{bit:6,label:"Sunday",abbr:"Sun"}];function te(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!1),[n,l]=(0,r.useState)(null),[c,o]=(0,r.useState)(!1),{toast:d}=(0,J.dj)(),m=eX("BusinessCalendarForm"),u=(0,r.useRef)(null),[p,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{},[m]);let{register:_,handleSubmit:x,reset:f,setValue:y,watch:j,formState:{errors:g}}=(0,v.mN)({defaultValues:{name:"",description:"",timezone:"UTC",default_start_time:32,default_end_time:64,working_days:[!0,!0,!0,!0,!0,!1,!1],is_default:!1,is_active:!0}});(0,r.useEffect)(()=>{Object.keys(g).length>0&&Object.keys(g).forEach(e=>{var t;m.startValidation(e),m.trackValidation(e,!0,null==(t=g[e])?void 0:t.message)})},[g,m]),(0,r.useEffect)(()=>()=>{m.finalizeMetrics()},[m]);let b=(0,r.useCallback)(async()=>{Date.now(),a(!0);try{let{data:e,error:s}=await N.N.from("business_calendars").select("*").order("name",{ascending:!0});if(s)throw s;t(e||[]),Date.now()}catch(e){console.error("Error fetching business calendars:",e),m.startValidation("data_fetch"),m.trackValidation("data_fetch",!0),d({title:"Error",description:"Failed to fetch business calendars",variant:"destructive"})}finally{a(!1)}},[d,m]);(0,r.useEffect)(()=>{b()},[b]);let k=e=>e7.map(t=>!!(e&1<<t.bit)),w=async e=>{m.trackSubmissionStart(),o(!0);try{let t={name:e.name,description:e.description||null,timezone:e.timezone,default_start_time:e.default_start_time,default_end_time:e.default_end_time,working_days_mask:e.working_days.reduce((e,t,s)=>t?e|1<<s:e,0),is_default:e.is_default,is_active:e.is_active};if(n){let{error:e}=await N.N.from("business_calendars").update(t).eq("calendar_id",n);if(e)throw e;d({title:"Success",description:"Business calendar updated successfully"})}else{let{error:e}=await N.N.from("business_calendars").insert([t]);if(e)throw e;d({title:"Success",description:"Business calendar created successfully"})}f(),l(null),b(),m.trackSubmissionEnd(!0)}catch(e){console.error("Error saving business calendar:",e),m.trackSubmissionEnd(!1),d({title:"Error",description:"Failed to save business calendar",variant:"destructive"})}finally{o(!1)}},S=async e=>{if(confirm("Are you sure you want to delete this business calendar?"))try{let{error:t}=await N.N.from("business_calendars").delete().eq("calendar_id",e);if(t)throw t;d({title:"Success",description:"Business calendar deleted successfully"}),b()}catch(e){console.error("Error deleting business calendar:",e),d({title:"Error",description:"Failed to delete business calendar",variant:"destructive"})}};return(0,i.jsxs)("div",{className:"space-y-6",children:[!1,(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:n?"Edit Business Calendar":"Create New Business Calendar"}),(0,i.jsx)(ex,{children:n?"Update business calendar information":"Define working periods and schedules for departments"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{ref:u,onSubmit:x(w),className:"space-y-4",onClick:e=>{let t=e.target;("BUTTON"===t.tagName||"INPUT"===t.tagName||"TEXTAREA"===t.tagName)&&m.trackInteraction("click",t.tagName.toLowerCase()+(t.id?"#".concat(t.id):""))},children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Calendar Name *"}),(0,i.jsx)(X,{id:"name",..._("name",{required:"Calendar name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., Standard Business Calendar",onFocus:()=>m.trackInteraction("focus","name"),onBlur:()=>{var e;let t=null==(e=document.getElementById("name"))?void 0:e.value;t&&(m.startValidation("name"),m.trackValidation("name",t.length>255))},onChange:e=>{m.trackInteraction("change","name")}}),g.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"timezone",children:"Timezone"}),(0,i.jsx)(X,{id:"timezone",..._("timezone"),placeholder:"e.g., UTC, America/New_York, Europe/London",onFocus:()=>m.trackInteraction("focus","timezone"),onChange:e=>m.trackInteraction("change","timezone")})]}),(0,i.jsx)(ev,{label:"Default Start Time",value:j("default_start_time")||32,onChange:e=>{y("default_start_time",e),m.trackInteraction("click","time-input#default_start_time")},id:"default_start_time",placeholder:"Select start time",helperText:"Default working hours start time for this calendar",required:!0}),(0,i.jsx)(ev,{label:"Default End Time",value:j("default_end_time")||64,onChange:e=>{y("default_end_time",e),m.trackInteraction("click","time-input#default_end_time")},id:"default_end_time",placeholder:"Select end time",helperText:"Default working hours end time for this calendar",required:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"description",children:"Description"}),(0,i.jsx)(K,{id:"description",..._("description"),placeholder:"Calendar description and usage notes",rows:3,onFocus:()=>m.trackInteraction("focus","description"),onChange:e=>m.trackInteraction("change","description")})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{children:"Working Days"}),(0,i.jsx)("div",{className:"grid grid-cols-7 gap-2",children:e7.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"working_day_".concat(t),checked:(j("working_days")||[])[t]||!1,onCheckedChange:e=>{let s=[...j("working_days")||[]];s[t]=e,y("working_days",s),m.trackInteraction("click","checkbox#working_day_".concat(t))}}),(0,i.jsx)(Z,{htmlFor:"working_day_".concat(t),className:"text-sm",children:e.abbr})]},e.label))})]}),(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_default",checked:j("is_default"),onCheckedChange:e=>{y("is_default",e),m.trackInteraction("click","checkbox#is_default")}}),(0,i.jsx)(Z,{htmlFor:"is_default",children:"Default Calendar"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Use as default for new departments and resources"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:j("is_active"),onCheckedChange:e=>{y("is_active",e),m.trackInteraction("click","checkbox#is_active")}}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[n&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{f(),l(null),m.trackInteraction("click","button#cancel")},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:c,onClick:()=>m.trackInteraction("click","button#submit"),children:[c&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Update":"Create"," Calendar"]})]})]})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Business Calendars"}),(0,i.jsx)(ex,{children:"Manage existing business calendars"})]}),(0,i.jsx)(ef,{children:s?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No business calendars found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Name"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Timezone"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Working Hours"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Working Days"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:(0,i.jsxs)("div",{children:[e.name,e.is_default&&(0,i.jsx)("span",{className:"ml-2 px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:"Default"})]})}),(0,i.jsx)("td",{className:"p-2",children:e.timezone}),(0,i.jsx)("td",{className:"p-2",children:eg(e.default_start_time,e.default_end_time)}),(0,i.jsx)("td",{className:"p-2 text-sm",children:(e=>{let t=k(e);return e7.filter((e,s)=>t[s]).map(e=>e.abbr).join(", ")})(e.working_days_mask)}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{l(e.calendar_id),y("name",e.name),y("description",e.description||""),y("timezone",e.timezone),y("default_start_time",e.default_start_time),y("default_end_time",e.default_end_time),y("working_days",k(e.working_days_mask)),y("is_default",e.is_default),y("is_active",e.is_active),m.trackInteraction("click","button#edit-".concat(e.calendar_id))},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{S(e.calendar_id),m.trackInteraction("click","button#delete-".concat(e.calendar_id))},children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.calendar_id))})]})})})]})]})}let tt=[{value:"active",label:"Active"},{value:"on_leave",label:"On Leave"},{value:"terminated",label:"Terminated"},{value:"retired",label:"Retired"}];function ts(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),{toast:u}=(0,J.dj)(),{trackInteraction:p,trackValidation:h,startValidation:_,trackSubmissionStart:x,trackSubmissionEnd:f,isSlowLoading:y,isSlowSubmission:j,hasHighErrorRate:g,getFormSummary:b}=eX("OperatorForm"),{register:k,handleSubmit:w,reset:S,setValue:C,watch:E,formState:{errors:T}}=(0,v.mN)({defaultValues:{name:"",employee_number:"",department_id:"",hourly_rate:25,max_hours_per_day:8,max_hours_per_week:40,overtime_rate_multiplier:1.5,employment_status:"active",efficiency_rating:1,quality_score:1,safety_score:1,hire_date:"",is_active:!0}}),F=(e,t)=>{let s=k(e,t);return{...s,onFocus:t=>{p("focus",e),_(e)},onBlur:t=>{var a,i;p("blur",e);let r=!!T[e],n=null==(a=T[e])?void 0:a.message;h(e,r,n),null==(i=s.onBlur)||i.call(s,t)},onChange:t=>{p("change",e),s.onChange(t)}}},q=async()=>{l(!0);try{let{data:e,error:s}=await N.N.from("operators").select("*").order("name",{ascending:!0});if(s)throw s;t(e||[])}catch(e){console.error("Error fetching operators:",e),u({title:"Error",description:"Failed to fetch operators",variant:"destructive"})}finally{l(!1)}},A=async()=>{try{let{data:e,error:t}=await N.N.from("departments").select("department_id, name, code, is_active").order("name",{ascending:!0});if(t)throw t;a(e||[])}catch(e){console.error("Error fetching departments:",e)}};(0,r.useEffect)(()=>{q(),A()},[]);let M=async e=>{m(!0),x();try{let t={name:e.name,employee_number:e.employee_number||null,department_id:e.department_id||null,hourly_rate:e.hourly_rate,max_hours_per_day:e.max_hours_per_day,max_hours_per_week:e.max_hours_per_week,overtime_rate_multiplier:e.overtime_rate_multiplier,employment_status:e.employment_status,efficiency_rating:e.efficiency_rating,quality_score:e.quality_score,safety_score:e.safety_score,hire_date:e.hire_date||null,is_active:e.is_active};if(c){let{error:e}=await N.N.from("operators").update(t).eq("operator_id",c);if(e)throw e;u({title:"Success",description:"Operator updated successfully"})}else{let{error:e}=await N.N.from("operators").insert([t]);if(e)throw e;u({title:"Success",description:"Operator created successfully"})}S(),o(null),q(),f(!0)}catch(e){console.error("Error saving operator:",e),u({title:"Error",description:"Failed to save operator",variant:"destructive"}),f(!1)}finally{m(!1)}},I=async e=>{if(confirm("Are you sure you want to delete this operator?"))try{let{error:t}=await N.N.from("operators").delete().eq("operator_id",e);if(t)throw t;u({title:"Success",description:"Operator deleted successfully"}),q()}catch(e){console.error("Error deleting operator:",e),u({title:"Error",description:"Failed to delete operator",variant:"destructive"})}};return b(),(0,i.jsxs)("div",{className:"space-y-6",children:[!1,(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:c?"Edit Operator":"Create New Operator"}),(0,i.jsx)(ex,{children:c?"Update operator information":"Add a new operator to the production system"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:w(M),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Operator Name *"}),(0,i.jsx)(X,{id:"name",...F("name",{required:"Operator name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., John Smith"}),T.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"employee_number",children:"Employee Number"}),(0,i.jsx)(X,{id:"employee_number",...F("employee_number"),placeholder:"e.g., EMP-001"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department"}),(0,i.jsxs)(en,{onValueChange:e=>{p("change","department_id"),C("department_id",e)},children:[(0,i.jsx)(ec,{onClick:()=>p("click","department_id"),children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Department"}),s.filter(e=>!1!==e.is_active).map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"employment_status",children:"Employment Status"}),(0,i.jsxs)(en,{onValueChange:e=>{p("change","employment_status"),C("employment_status",e)},children:[(0,i.jsx)(ec,{onClick:()=>p("click","employment_status"),children:(0,i.jsx)(el,{placeholder:"Select status"})}),(0,i.jsx)(em,{children:tt.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"hourly_rate",children:"Hourly Rate ($)"}),(0,i.jsx)(X,{id:"hourly_rate",type:"number",min:"0",step:"0.01",...F("hourly_rate",{valueAsNumber:!0,min:{value:0,message:"Rate must be non-negative"}})}),T.hourly_rate&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.hourly_rate.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"max_hours_per_day",children:"Max Hours Per Day"}),(0,i.jsx)(X,{id:"max_hours_per_day",type:"number",min:"1",max:"24",...F("max_hours_per_day",{valueAsNumber:!0,min:{value:1,message:"Must be at least 1 hour"},max:{value:24,message:"Cannot exceed 24 hours"}})}),T.max_hours_per_day&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.max_hours_per_day.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"max_hours_per_week",children:"Max Hours Per Week"}),(0,i.jsx)(X,{id:"max_hours_per_week",type:"number",min:"1",max:"168",...F("max_hours_per_week",{valueAsNumber:!0,min:{value:1,message:"Must be at least 1 hour"},max:{value:168,message:"Cannot exceed 168 hours per week"}})}),T.max_hours_per_week&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.max_hours_per_week.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"overtime_rate_multiplier",children:"Overtime Rate Multiplier"}),(0,i.jsx)(X,{id:"overtime_rate_multiplier",type:"number",min:"1",step:"0.1",...F("overtime_rate_multiplier",{valueAsNumber:!0,min:{value:1,message:"Multiplier must be at least 1.0"}})}),T.overtime_rate_multiplier&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.overtime_rate_multiplier.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"efficiency_rating",children:"Efficiency Rating"}),(0,i.jsx)(X,{id:"efficiency_rating",type:"number",min:"0",step:"0.01",...F("efficiency_rating",{valueAsNumber:!0,min:{value:0,message:"Rating must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"1.0 = standard efficiency, >1.0 = above average"}),T.efficiency_rating&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.efficiency_rating.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"quality_score",children:"Quality Score"}),(0,i.jsx)(X,{id:"quality_score",type:"number",min:"0",step:"0.01",...F("quality_score",{valueAsNumber:!0,min:{value:0,message:"Score must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"1.0 = standard quality, >1.0 = above average"}),T.quality_score&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.quality_score.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"safety_score",children:"Safety Score"}),(0,i.jsx)(X,{id:"safety_score",type:"number",min:"0",step:"0.01",...F("safety_score",{valueAsNumber:!0,min:{value:0,message:"Score must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"1.0 = standard safety, >1.0 = above average"}),T.safety_score&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:T.safety_score.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"hire_date",children:"Hire Date"}),(0,i.jsx)(X,{id:"hire_date",type:"date",...F("hire_date")})]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:E("is_active"),onCheckedChange:e=>{p("change","is_active"),C("is_active",e)}}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[c&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{p("click","cancel-button"),S(),o(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:d,onClick:()=>p("click","submit-button"),children:[d&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update":"Create"," Operator"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"operators",entityName:"Operator",sampleData:{name:"John Smith",employee_number:"EMP001",department_id:null,hourly_rate:25.5,max_hours_per_day:8,max_hours_per_week:40,overtime_rate_multiplier:1.5,employment_status:"FULL_TIME",efficiency_rating:.95,quality_score:.92,safety_score:.98,is_active:!0},onUploadComplete:q,requiredFields:["name","hourly_rate","employment_status"],fieldDescriptions:{name:"Operator full name",employee_number:"Unique employee identifier",hourly_rate:"Base hourly wage rate",employment_status:"FULL_TIME, PART_TIME, CONTRACT, TEMPORARY",efficiency_rating:"Performance rating (0.0 to 1.0)",quality_score:"Quality rating (0.0 to 1.0)",safety_score:"Safety rating (0.0 to 1.0)"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Operators"}),(0,i.jsx)(ex,{children:"Manage existing operators"})]}),(0,i.jsx)(ef,{children:n?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No operators found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Name"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Employee #"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Department"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Rate/Hour"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Max Hours"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Ratings"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{let t=s.find(t=>t.department_id===e.department_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,i.jsx)("td",{className:"p-2",children:e.employee_number||"-"}),(0,i.jsx)("td",{className:"p-2",children:t?"".concat(t.name," (").concat(t.code,")"):"-"}),(0,i.jsxs)("td",{className:"p-2",children:["$",e.hourly_rate.toFixed(2)]}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsxs)("div",{children:[e.max_hours_per_day,"h/day"]}),(0,i.jsxs)("div",{className:"text-gray-500",children:[e.max_hours_per_week,"h/week"]})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsxs)("div",{children:["Eff: ",e.efficiency_rating.toFixed(2)]}),(0,i.jsxs)("div",{children:["Qual: ",e.quality_score.toFixed(2)]}),(0,i.jsxs)("div",{children:["Safe: ",e.safety_score.toFixed(2)]})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("active"===e.employment_status?"bg-green-100 text-green-800":"on_leave"===e.employment_status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.employment_status.replace("_"," ")}),(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.is_active?"Active":"Inactive"})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{p("click","edit-operator"),o(e.operator_id),C("name",e.name),C("employee_number",e.employee_number||""),C("department_id",e.department_id||""),C("hourly_rate",e.hourly_rate),C("max_hours_per_day",e.max_hours_per_day),C("max_hours_per_week",e.max_hours_per_week),C("overtime_rate_multiplier",e.overtime_rate_multiplier),C("employment_status",e.employment_status),C("efficiency_rating",e.efficiency_rating),C("quality_score",e.quality_score),C("safety_score",e.safety_score),C("is_active",e.is_active)},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{p("click","delete-operator"),I(e.operator_id)},children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.operator_id)})})]})})})]})]})}var ta=s(8475);let ti=r.forwardRef((e,t)=>{let{className:s,value:a,...r}=e;return(0,i.jsx)(ta.bL,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:(0,i.jsx)(ta.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});ti.displayName=ta.bL.displayName;var tr=s(1632);let tn=[{value:"basic",label:"Basic"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"},{value:"expert",label:"Expert"}],tl=[{value:"common",label:"Common"},{value:"uncommon",label:"Uncommon"},{value:"rare",label:"Rare"},{value:"critical",label:"Critical"}],tc=["mechanical","electrical","quality","assembly","testing","machining","splicing","alignment","cleaning"];class to{recordLoadComplete(){this.metrics.loadTime=performance.now()-this.loadStartTime,this.reportMetric("form_load_time",this.metrics.loadTime)}startSubmission(){this.submissionStartTime=performance.now()}recordSubmissionComplete(e){this.submissionStartTime&&(this.metrics.submissionTime=performance.now()-this.submissionStartTime,this.reportMetric("form_submission_time",this.metrics.submissionTime),e?this.reportMetric("form_submission_success",1):(this.metrics.errorCount++,this.reportMetric("form_submission_error",1)))}startValidation(){this.validationStartTime=performance.now()}recordValidationComplete(){this.validationStartTime&&(this.metrics.validationTime=performance.now()-this.validationStartTime,this.reportMetric("form_validation_time",this.metrics.validationTime))}recordInteraction(e,t){this.metrics.interactionCount++,"focus"===e&&t&&(this.metrics.fieldFocusEvents[t]=(this.metrics.fieldFocusEvents[t]||0)+1),this.reportMetric("form_".concat(e,"_interaction"),1)}recordError(e){this.metrics.errorCount++,this.reportMetric("form_validation_error",1),e&&this.reportMetric("form_field_error_".concat(e),1)}reportMetric(e,t){e.includes("time")&&t>1e3&&console.warn("[FORM-PERF] Slow SkillForm ".concat(e,": ").concat(t,"ms")),window.gtag&&window.gtag("event",e,{form_name:"skill_form",value:t,custom_map:{metric1:"form_performance"}})}getMetrics(){return{...this.metrics}}getSummary(){return{formName:"SkillForm",loadTime:this.metrics.loadTime,submissionTime:this.metrics.submissionTime,validationTime:this.metrics.validationTime,interactionCount:this.metrics.interactionCount,errorCount:this.metrics.errorCount,errorRate:this.metrics.interactionCount>0?this.metrics.errorCount/this.metrics.interactionCount*100:0,mostFocusedField:Object.keys(this.metrics.fieldFocusEvents).reduce((e,t)=>this.metrics.fieldFocusEvents[e]>this.metrics.fieldFocusEvents[t]?e:t,""),timestamp:this.metrics.timestamp}}constructor(){this.submissionStartTime=null,this.validationStartTime=null,this.loadStartTime=performance.now(),this.metrics={loadTime:0,submissionTime:0,validationTime:0,interactionCount:0,errorCount:0,fieldFocusEvents:{},timestamp:Date.now()}}}function td(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[u,p]=(0,r.useState)(0),[h,_]=(0,r.useState)(!1),{toast:x}=(0,J.dj)(),f=(0,r.useRef)(new to),y=(0,r.useRef)(!1),j=eL(e,e=>e.skill_id,{enableFiltering:!0,enableBulkOperations:!0,enableSorting:!0}),g=[{key:"name",label:"Skill Name",type:"text"},{key:"category",label:"Category",type:"text"},{key:"complexity_level",label:"Complexity Level",type:"select",options:tn},{key:"skill_scarcity_level",label:"Scarcity Level",type:"select",options:tl},{key:"certification_required",label:"Requires Certification",type:"boolean"},{key:"is_active",label:"Active",type:"boolean"},{key:"training_hours_required",label:"Training Hours",type:"number"},{key:"market_hourly_rate",label:"Market Rate",type:"number"}],{register:b,handleSubmit:k,reset:w,setValue:S,watch:C,formState:{errors:E}}=(0,v.mN)({defaultValues:{name:"",description:"",category:"",department_id:"",complexity_level:"basic",training_hours_required:0,certification_required:!1,certification_expires_after_months:12,market_hourly_rate:0,skill_scarcity_level:"common",is_active:!0}});(0,r.useEffect)(()=>{Object.keys(E).forEach(e=>{f.current.recordError(e)})},[E]);let T=(0,r.useCallback)(async()=>{l(!0);try{let{data:e,error:s}=await N.N.from("skills").select("*").order("name",{ascending:!0});if(s)throw s;t(e||[]),y.current||(f.current.recordLoadComplete(),y.current=!0)}catch(e){console.error("Error fetching skills:",e),f.current.recordError("data_fetch"),x({title:"Error",description:"Failed to fetch skills",variant:"destructive"})}finally{l(!1)}},[x]),F=(0,r.useCallback)(async()=>{try{let{data:e,error:t}=await N.N.from("departments").select("department_id, name, code").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;a(e||[])}catch(e){console.error("Error fetching departments:",e)}},[]);(0,r.useEffect)(()=>{T(),F()},[T,F]),(0,r.useEffect)(()=>()=>{},[]);let q=async e=>{m(!0),f.current.startSubmission(),f.current.startValidation();try{let t={name:e.name,description:e.description||null,category:e.category&&""!==e.category?e.category:null,department_id:e.department_id&&""!==e.department_id?e.department_id:null,complexity_level:e.complexity_level,training_hours_required:e.training_hours_required,certification_required:e.certification_required,certification_expires_after_months:e.certification_required?e.certification_expires_after_months:null,market_hourly_rate:e.market_hourly_rate||null,skill_scarcity_level:e.skill_scarcity_level,is_active:e.is_active};if(c){let{error:e}=await N.N.from("skills").update(t).eq("skill_id",c);if(e)throw e;x({title:"Success",description:"Skill updated successfully"})}else{let{error:e}=await N.N.from("skills").insert([t]);if(e)throw e;x({title:"Success",description:"Skill created successfully"})}f.current.recordValidationComplete(),f.current.recordSubmissionComplete(!0),w(),o(null),T()}catch(e){console.error("Error saving skill:",e),f.current.recordSubmissionComplete(!1),f.current.recordError("submission"),x({title:"Error",description:"Failed to save skill",variant:"destructive"})}finally{m(!1)}},A=async e=>{if(confirm("Are you sure you want to delete this skill?"))try{let{error:t}=await N.N.from("skills").delete().eq("skill_id",e);if(t)throw t;x({title:"Success",description:"Skill deleted successfully"}),T()}catch(e){console.error("Error deleting skill:",e),x({title:"Error",description:"Failed to delete skill",variant:"destructive"})}},M=async e=>{if(confirm("Are you sure you want to delete ".concat(e.length," skill(s)?"))){_(!0),p(0);try{let t=e.length,s=0;for(let a of e){let{error:e}=await N.N.from("skills").delete().eq("skill_id",a);if(e)throw e;s++,p(Math.round(s/t*100))}x({title:"Success",description:"".concat(e.length," skill(s) deleted successfully")}),j.clearSelection(),T()}catch(e){console.error("Error bulk deleting skills:",e),x({title:"Error",description:"Failed to delete some skills",variant:"destructive"})}finally{_(!1),p(0)}}},I=async t=>{_(!0),p(0);try{let s=t.length,a=0;for(let i of t){let t=e.find(e=>e.skill_id===i);if(!t)continue;let{error:r}=await N.N.from("skills").update({is_active:!t.is_active}).eq("skill_id",i);if(r)throw r;a++,p(Math.round(a/s*100))}x({title:"Success",description:"".concat(t.length," skill(s) status updated successfully")}),j.clearSelection(),T()}catch(e){console.error("Error bulk updating skills:",e),x({title:"Error",description:"Failed to update some skills",variant:"destructive"})}finally{_(!1),p(0)}},z=async(e,t)=>{_(!0),p(0);try{let s=e.length,a=0;for(let i of e){let{error:e}=await N.N.from("skills").update({complexity_level:t}).eq("skill_id",i);if(e)throw e;a++,p(Math.round(a/s*100))}x({title:"Success",description:"".concat(e.length," skill(s) complexity level updated successfully")}),j.clearSelection(),T()}catch(e){console.error("Error bulk updating complexity:",e),x({title:"Error",description:"Failed to update complexity for some skills",variant:"destructive"})}finally{_(!1),p(0)}},D=async(e,t)=>{_(!0),p(0);try{let s=e.length,a=0;for(let i of e){let{error:e}=await N.N.from("skills").update({certification_required:t,certification_expires_after_months:t?12:null}).eq("skill_id",i);if(e)throw e;a++,p(Math.round(a/s*100))}x({title:"Success",description:"".concat(e.length," skill(s) certification requirement updated successfully")}),j.clearSelection(),T()}catch(e){console.error("Error bulk updating certification:",e),x({title:"Error",description:"Failed to update certification for some skills",variant:"destructive"})}finally{_(!1),p(0)}},R=e=>{j.sortBy===e?j.setSortDirection("asc"===j.sortDirection?"desc":"asc"):(j.setSortBy(e),j.setSortDirection("asc"))},O=e=>j.sortBy!==e?(0,i.jsx)(tr.A,{className:"h-4 w-4 ml-1 opacity-50"}):"asc"===j.sortDirection?(0,i.jsx)(er.A,{className:"h-4 w-4 ml-1"}):(0,i.jsx)(ei.A,{className:"h-4 w-4 ml-1"});return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:c?"Edit Skill":"Create New Skill"}),(0,i.jsx)(ex,{children:c?"Update skill information":"Add a new skill capability to the system"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:k(q),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Skill Name *"}),(0,i.jsx)(X,{id:"name",...b("name",{required:"Skill name is required",maxLength:{value:255,message:"Name must be 255 characters or less"},onChange:()=>f.current.recordInteraction("change","name")}),placeholder:"e.g., CNC Operation, Quality Inspection",onFocus:()=>f.current.recordInteraction("focus","name")}),E.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"category",children:"Category"}),(0,i.jsxs)(en,{value:C("category")||"",onValueChange:e=>S("category","none"===e?"":e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select category"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Category"}),tc.map(e=>(0,i.jsx)(eu,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department"}),(0,i.jsxs)(en,{value:C("department_id")||"",onValueChange:e=>S("department_id","none"===e?"":e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Department"}),s.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"complexity_level",children:"Complexity Level"}),(0,i.jsxs)(en,{value:C("complexity_level"),onValueChange:e=>S("complexity_level",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select complexity"})}),(0,i.jsx)(em,{children:tn.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"training_hours_required",children:"Training Hours Required"}),(0,i.jsx)(X,{id:"training_hours_required",type:"number",min:"0",...b("training_hours_required",{valueAsNumber:!0,min:{value:0,message:"Training hours must be non-negative"},onChange:()=>f.current.recordInteraction("change","training_hours_required")}),onFocus:()=>f.current.recordInteraction("focus","training_hours_required")}),E.training_hours_required&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.training_hours_required.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"certification_expires_after_months",children:"Certification Validity (months)"}),(0,i.jsx)(X,{id:"certification_expires_after_months",type:"number",min:"1",disabled:!C("certification_required"),...b("certification_expires_after_months",{valueAsNumber:!0,min:{value:1,message:"Must be at least 1 month"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Only applies if certification is required"}),E.certification_expires_after_months&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.certification_expires_after_months.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"market_hourly_rate",children:"Market Hourly Rate ($)"}),(0,i.jsx)(X,{id:"market_hourly_rate",type:"number",min:"0",step:"0.01",...b("market_hourly_rate",{valueAsNumber:!0,min:{value:0,message:"Rate must be non-negative"},onChange:()=>f.current.recordInteraction("change","market_hourly_rate")}),onFocus:()=>f.current.recordInteraction("focus","market_hourly_rate")}),E.market_hourly_rate&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:E.market_hourly_rate.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"skill_scarcity_level",children:"Scarcity Level"}),(0,i.jsxs)(en,{value:C("skill_scarcity_level"),onValueChange:e=>S("skill_scarcity_level",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select scarcity"})}),(0,i.jsx)(em,{children:tl.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"description",children:"Description"}),(0,i.jsx)(K,{id:"description",...b("description",{onChange:()=>f.current.recordInteraction("change","description")}),placeholder:"Detailed description of the skill and its requirements",rows:3,onFocus:()=>f.current.recordInteraction("focus","description")})]}),(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"certification_required",checked:C("certification_required"),onCheckedChange:e=>{f.current.recordInteraction("click","certification_required"),S("certification_required",e)}}),(0,i.jsx)(Z,{htmlFor:"certification_required",children:"Certification Required"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Operators must have formal certification"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:C("is_active"),onCheckedChange:e=>{f.current.recordInteraction("click","is_active"),S("is_active",e)}}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[c&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{f.current.recordInteraction("click","cancel_button"),w(),o(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:d,onClick:()=>f.current.recordInteraction("click","submit_button"),children:[d&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update":"Create"," Skill"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"skills",entityName:"Skill",sampleData:{name:"CNC Programming",description:"Ability to program CNC machines using G-code",category:"Manufacturing",department_id:null,complexity_level:"INTERMEDIATE",training_hours_required:40,certification_required:!0,certification_expires_after_months:24,market_hourly_rate:28.5,skill_scarcity_level:"MEDIUM",is_active:!0},onUploadComplete:T,requiredFields:["name","complexity_level","training_hours_required","skill_scarcity_level"],fieldDescriptions:{name:"Skill display name",category:"Skill category (e.g., Manufacturing, Quality)",complexity_level:"BASIC, INTERMEDIATE, ADVANCED, EXPERT",training_hours_required:"Hours needed to acquire skill",skill_scarcity_level:"LOW, MEDIUM, HIGH, VERY_HIGH"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{className:"flex items-center justify-between",children:(0,i.jsxs)("div",{children:["Skills",(0,i.jsxs)(eE,{variant:"secondary",className:"ml-2",children:[j.filteredCount," of ",j.totalCount]})]})}),(0,i.jsx)(ex,{children:"Manage existing skills with advanced filtering and bulk operations"})]}),(0,i.jsxs)(ef,{className:"space-y-4",children:[(0,i.jsx)(eJ,{options:g,values:j.filters,onChange:j.setFilters,placeholder:"Search skills by name, category, or description..."}),(0,i.jsx)(eY,{items:j.filteredItems,selectedItems:j.selectedItems,onToggleSelection:j.toggleSelection,onSelectAll:()=>{j.selectAll(j.filteredItems,e=>e.skill_id)},onClearSelection:j.clearSelection,onBulkDelete:M,onBulkEdit:e=>{let t=[{label:"Toggle Active Status",action:()=>I(e)},{label:"Set Basic Complexity",action:()=>z(e,"basic")},{label:"Set Intermediate Complexity",action:()=>z(e,"intermediate")},{label:"Set Advanced Complexity",action:()=>z(e,"advanced")},{label:"Set Expert Complexity",action:()=>z(e,"expert")},{label:"Require Certification",action:()=>D(e,!0)},{label:"Remove Certification Requirement",action:()=>D(e,!1)}],s=parseInt(prompt("Select bulk action for ".concat(e.length," skills:\n\n")+t.map((e,t)=>"".concat(t+1,". ").concat(e.label)).join("\n"))||"0")-1;s>=0&&s<t.length&&t[s].action()},getId:e=>e.skill_id,isSelectionMode:j.isSelectionMode,onEnterSelectionMode:j.enterSelectionMode}),h&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,i.jsx)("span",{children:"Processing bulk operation..."}),(0,i.jsxs)("span",{children:[u,"%"]})]}),(0,i.jsx)(ti,{value:u,className:"w-full"})]}),n?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):j.isEmpty?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:0===j.totalCount?"No skills found":"No skills match the current filters"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[j.isSelectionMode&&(0,i.jsx)("th",{className:"text-left p-2 w-12",children:(0,i.jsx)(es,{checked:j.filteredItems.length>0&&j.selectedItems.size===j.filteredItems.length,onCheckedChange:e=>{e?j.selectAll(j.filteredItems,e=>e.skill_id):j.clearSelection()}})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("name"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Name ",O("name")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("category"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Category ",O("category")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("department_id"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Department ",O("department_id")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("complexity_level"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Complexity ",O("complexity_level")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("training_hours_required"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Training Hours ",O("training_hours_required")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("market_hourly_rate"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Market Rate ",O("market_hourly_rate")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("skill_scarcity_level"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Scarcity ",O("skill_scarcity_level")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:(0,i.jsxs)(Q,{variant:"ghost",size:"sm",onClick:()=>R("is_active"),className:"h-auto p-0 font-semibold hover:bg-transparent",children:["Status ",O("is_active")]})}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:j.filteredItems.map(e=>{let t=s.find(t=>t.department_id===e.department_id),a=j.selectedItems.has(e.skill_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50 ".concat(a?"bg-blue-50":""),children:[j.isSelectionMode&&(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)(es,{checked:a,onCheckedChange:()=>j.toggleSelection(e.skill_id)})}),(0,i.jsx)("td",{className:"p-2 font-medium",children:(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[e.name,e.certification_required&&(0,i.jsx)(eE,{variant:"outline",className:"text-xs bg-orange-50 text-orange-700 border-orange-200",children:"Cert Required"})]}),e.description&&(0,i.jsx)("div",{className:"text-xs text-gray-500 line-clamp-1",children:e.description})]})}),(0,i.jsx)("td",{className:"p-2",children:e.category?(0,i.jsx)(eE,{variant:"secondary",className:"capitalize",children:e.category}):(0,i.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,i.jsx)("td",{className:"p-2",children:t?(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("div",{className:"font-medium",children:t.name}),(0,i.jsxs)("div",{className:"text-gray-500",children:["(",t.code,")"]})]}):(0,i.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)(eE,{className:"capitalize ".concat((e=>{switch(e){case"basic":return"bg-green-100 text-green-800";case"intermediate":return"bg-yellow-100 text-yellow-800";case"advanced":return"bg-orange-100 text-orange-800";case"expert":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.complexity_level)),children:e.complexity_level})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("span",{className:"font-medium",children:e.training_hours_required}),(0,i.jsx)("span",{className:"text-xs text-gray-500",children:"hrs"})]})}),(0,i.jsx)("td",{className:"p-2",children:e.market_hourly_rate?(0,i.jsxs)("div",{className:"font-medium text-green-600",children:["$",e.market_hourly_rate.toFixed(2)]}):(0,i.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)(eE,{className:"capitalize ".concat("critical"===e.skill_scarcity_level?"bg-red-100 text-red-800 border-red-200":"rare"===e.skill_scarcity_level?"bg-orange-100 text-orange-800 border-orange-200":"uncommon"===e.skill_scarcity_level?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-green-100 text-green-800 border-green-200"),children:e.skill_scarcity_level})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)(eE,{className:"".concat(e.is_active?"bg-green-100 text-green-800 border-green-200":"bg-red-100 text-red-800 border-red-200"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{f.current.recordInteraction("click","edit_button"),o(e.skill_id),S("name",e.name),S("description",e.description||""),S("category",e.category||""),S("department_id",e.department_id||""),S("complexity_level",e.complexity_level),S("training_hours_required",e.training_hours_required),S("certification_required",e.certification_required),S("certification_expires_after_months",e.certification_expires_after_months||12),S("market_hourly_rate",e.market_hourly_rate||0),S("skill_scarcity_level",e.skill_scarcity_level),S("is_active",e.is_active)},className:"h-8 w-8 p-0",children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{f.current.recordInteraction("click","delete_button"),A(e.skill_id)},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.skill_id)})})]})})]})]})]})}let tm={sequence_id:"OPTO_001",name:"Optical Testing Sequence",description:"Primary optical testing workflow",department_id:null,setup_time_minutes:15,teardown_time_minutes:10,max_concurrent_jobs:1,resource_type:"exclusive",priority:1,is_active:!0};function tu(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),{toast:u}=(0,J.dj)(),{register:p,handleSubmit:h,reset:_,setValue:x,watch:f,formState:{errors:y}}=(0,v.mN)({defaultValues:{sequence_id:"",name:"",description:"",department_id:"",setup_time_minutes:0,teardown_time_minutes:0,max_concurrent_jobs:1,resource_type:"exclusive",priority:1,is_active:!0}}),{trackInteraction:j,trackValidation:g,startValidation:b,trackSubmissionStart:k,trackSubmissionEnd:w,isSlowLoading:S,isSlowSubmission:C,hasHighErrorRate:E,getFormSummary:T}=eX("SequenceResourceForm"),F=async()=>{l(!0);try{let{data:e,error:s}=await N.N.from("sequence_resources").select("*").order("name",{ascending:!0});if(s)throw s;t(e||[])}catch(e){console.error("Error fetching sequence resources:",e),u({title:"Error",description:"Failed to fetch sequence resources",variant:"destructive"})}finally{l(!1)}},q=async()=>{try{let{data:e,error:t}=await N.N.from("departments").select("department_id, name, code").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;a(e||[])}catch(e){console.error("Error fetching departments:",e)}};(0,r.useEffect)(()=>{F(),q()},[F,q]);let A=async e=>{m(!0),k();try{let t={sequence_id:e.sequence_id,name:e.name,description:e.description||null,department_id:"none"===e.department_id?null:e.department_id||null,setup_time_minutes:e.setup_time_minutes,teardown_time_minutes:e.teardown_time_minutes,max_concurrent_jobs:e.max_concurrent_jobs,resource_type:e.resource_type,priority:e.priority,is_active:e.is_active};if(c){let{error:e}=await N.N.from("sequence_resources").update(t).eq("sequence_id",c);if(e)throw e;u({title:"Success",description:"Sequence resource updated successfully"})}else{let{error:e}=await N.N.from("sequence_resources").insert([t]);if(e)throw e;u({title:"Success",description:"Sequence resource created successfully"})}_(),o(null),F(),w(!0)}catch(e){console.error("Error saving sequence resource:",e),u({title:"Error",description:"Failed to save sequence resource",variant:"destructive"}),w(!1)}finally{m(!1)}},M=async e=>{if(confirm("Are you sure you want to delete this sequence resource?"))try{let{error:t}=await N.N.from("sequence_resources").delete().eq("sequence_id",e);if(t)throw t;u({title:"Success",description:"Sequence resource deleted successfully"}),F()}catch(e){console.error("Error deleting sequence resource:",e),u({title:"Error",description:"Failed to delete sequence resource",variant:"destructive"})}};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsxs)(eS,{value:"form",className:"space-y-6",children:[(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:c?"Edit Sequence Resource":"Create New Sequence Resource"}),(0,i.jsx)(ex,{children:c?"Update sequence resource information":"Add a new sequence resource for exclusive access constraints (e.g., Opto, BAT, QC)"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:h(A),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"sequence_id",children:"Sequence ID *"}),(0,i.jsx)(X,{id:"sequence_id",...p("sequence_id",{required:"Sequence ID is required",maxLength:{value:100,message:"ID must be 100 characters or less"}}),placeholder:"e.g., Opto, BAT, QC",disabled:!!c,onFocus:()=>{j("focus","sequence_id"),b("sequence_id")},onBlur:()=>{var e;j("blur","sequence_id"),g("sequence_id",!!y.sequence_id,null==(e=y.sequence_id)?void 0:e.message)},onChange:e=>{j("change","sequence_id"),p("sequence_id").onChange(e)}}),c&&(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Sequence ID cannot be changed when editing"}),y.sequence_id&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:y.sequence_id.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Resource Name *"}),(0,i.jsx)(X,{id:"name",...p("name",{required:"Resource name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., Optical Testing Sequence",onFocus:()=>{j("focus","name"),b("name")},onBlur:()=>{var e;j("blur","name"),g("name",!!y.name,null==(e=y.name)?void 0:e.message)},onChange:e=>{j("change","name"),p("name").onChange(e)}}),y.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:y.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department"}),(0,i.jsxs)(en,{value:f("department_id")||void 0,onValueChange:e=>{x("department_id",e),j("change","department_id")},onOpenChange:e=>{e&&j("click","department_select")},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Department"}),s.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"resource_type",children:"Resource Type"}),(0,i.jsxs)(en,{value:f("resource_type")||void 0,onValueChange:e=>{x("resource_type",e),j("change","resource_type")},onOpenChange:e=>{e&&j("click","resource_type_select")},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select resource type"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"exclusive",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Exclusive"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:"One job at a time (e.g., Opto, BAT)"})]})}),(0,i.jsx)(eu,{value:"shared",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Shared"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:"Multiple jobs simultaneously (e.g., Oven)"})]})}),(0,i.jsx)(eu,{value:"pooled",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:"Pooled"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:"Pool of identical units (e.g., QC Stations)"})]})})]})]}),(0,i.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,i.jsx)("strong",{children:"Exclusive:"})," Only 1 job uses resource. ",(0,i.jsx)("strong",{children:"Shared:"})," Multiple jobs share resource. ",(0,i.jsx)("strong",{children:"Pooled:"})," Jobs assigned to available units."]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"setup_time_minutes",children:"Setup Time (minutes)"}),(0,i.jsx)(X,{id:"setup_time_minutes",type:"number",min:"0",...p("setup_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Setup time must be non-negative"}}),placeholder:"e.g., 15",onFocus:()=>{j("focus","setup_time_minutes"),b("setup_time_minutes")},onBlur:()=>{var e;j("blur","setup_time_minutes"),g("setup_time_minutes",!!y.setup_time_minutes,null==(e=y.setup_time_minutes)?void 0:e.message)},onChange:e=>{j("change","setup_time_minutes"),p("setup_time_minutes").onChange(e)}}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Time to prepare resource for job (calibration, tool changeover, material loading)"}),y.setup_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:y.setup_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"teardown_time_minutes",children:"Teardown Time (minutes)"}),(0,i.jsx)(X,{id:"teardown_time_minutes",type:"number",min:"0",...p("teardown_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Teardown time must be non-negative"}}),placeholder:"e.g., 10",onFocus:()=>{j("focus","teardown_time_minutes"),b("teardown_time_minutes")},onBlur:()=>{var e;j("blur","teardown_time_minutes"),g("teardown_time_minutes",!!y.teardown_time_minutes,null==(e=y.teardown_time_minutes)?void 0:e.message)},onChange:e=>{j("change","teardown_time_minutes"),p("teardown_time_minutes").onChange(e)}}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Time to clean/reset resource after job (cleaning, documentation, tool removal)"}),y.teardown_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:y.teardown_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"max_concurrent_jobs",children:"Max Concurrent Jobs"}),(0,i.jsx)(X,{id:"max_concurrent_jobs",type:"number",min:"1",...p("max_concurrent_jobs",{valueAsNumber:!0,min:{value:1,message:"Must allow at least 1 concurrent job"}}),placeholder:"e.g., 1"}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Maximum number of jobs that can use this resource simultaneously"}),y.max_concurrent_jobs&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:y.max_concurrent_jobs.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"priority",children:"Priority"}),(0,i.jsx)(X,{id:"priority",type:"number",min:"1",...p("priority",{valueAsNumber:!0,min:{value:1,message:"Priority must be at least 1"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Higher numbers = higher priority for conflict resolution"}),y.priority&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:y.priority.message})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"description",children:"Description"}),(0,i.jsx)(K,{id:"description",...p("description"),placeholder:"Detailed description of the sequence resource and its purpose",rows:3,onFocus:()=>{j("focus","description"),b("description")},onBlur:()=>{var e;j("blur","description"),g("description",!!y.description,null==(e=y.description)?void 0:e.message)},onChange:e=>{j("change","description"),p("description").onChange(e)}})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_active",checked:f("is_active"),onCheckedChange:e=>{x("is_active",e),j("change","is_active")},onClick:()=>j("click","is_active_checkbox")}),(0,i.jsx)(Z,{htmlFor:"is_active",children:"Active"})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[c&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{_(),o(null),j("click","cancel_button")},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:d,onClick:()=>j("click","submit_button"),children:[d&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update":"Create"," Resource"]})]})]})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Sequence Resources"}),(0,i.jsx)(ex,{children:"Manage existing sequence resources"})]}),(0,i.jsx)(ef,{children:n?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No sequence resources found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"ID"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Name"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Department"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Type"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Max Concurrent"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Setup/Teardown"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Priority"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{let t=s.find(t=>t.department_id===e.department_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:e.sequence_id}),(0,i.jsx)("td",{className:"p-2",children:e.name}),(0,i.jsx)("td",{className:"p-2",children:t?"".concat(t.name," (").concat(t.code,")"):"-"}),(0,i.jsx)("td",{className:"p-2 capitalize",children:e.resource_type}),(0,i.jsx)("td",{className:"p-2",children:e.max_concurrent_jobs}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsxs)("div",{children:["Setup: ",e.setup_time_minutes,"m"]}),(0,i.jsxs)("div",{children:["Teardown: ",e.teardown_time_minutes,"m"]})]})}),(0,i.jsx)("td",{className:"p-2",children:e.priority}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{o(e.sequence_id),x("sequence_id",e.sequence_id),x("name",e.name),x("description",e.description||""),x("department_id",e.department_id||"none"),x("setup_time_minutes",e.setup_time_minutes),x("teardown_time_minutes",e.teardown_time_minutes),x("max_concurrent_jobs",e.max_concurrent_jobs),x("resource_type",e.resource_type),x("priority",e.priority),x("is_active",e.is_active),j("click","edit_button")},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{M(e.sequence_id),j("click","delete_button")},children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.sequence_id)})})]})})})]})]}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"sequence_resources",entityName:"Sequence Resource",sampleData:tm,onUploadComplete:F,requiredFields:["sequence_id","name","resource_type"],fieldDescriptions:{sequence_id:"Unique sequence resource identifier (e.g., OPTO_001, BAT_001)",name:"Descriptive name for the sequence resource",description:"Detailed description of the resource purpose and workflow",department_id:"Department that owns this resource (optional)",setup_time_minutes:"Time required to prepare resource for job execution",teardown_time_minutes:"Time required to clean/reset resource after job completion",max_concurrent_jobs:"Maximum number of jobs that can use this resource simultaneously",resource_type:"Type of resource constraint: exclusive (1 job), shared (multiple jobs), pooled (unit allocation)",priority:"Resource priority for conflict resolution (higher numbers = higher priority)",is_active:"Whether the resource is currently available for scheduling"}})})]}),!1]})}let tp=[{value:"NOVICE",label:"Novice"},{value:"COMPETENT",label:"Competent"},{value:"PROFICIENT",label:"Proficient"},{value:"EXPERT",label:"Expert"}];function th(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(!1),[n,l]=(0,r.useState)(null),[c,o]=(0,r.useState)(!1),{toast:d}=(0,J.dj)();(0,eK.eu)("MaintenanceTypeForm");let m=(0,r.useRef)(Date.now()),u=(0,r.useRef)([]),p=(0,r.useRef)({loadTime:0,submitTime:0,validationTime:0,errorCount:0,interactionCount:0,focusEvents:0,clickEvents:0,validationErrors:0,renderTime:0}),h=(0,r.useRef)(Date.now()),_=(0,r.useCallback)(e=>{p.current.interactionCount++,"click"===e?p.current.clickEvents++:"focus"===e&&p.current.focusEvents++},[]),x=(0,r.useCallback)((e,t,s,a)=>{u.current.push({field:e,validationTime:t,isValid:s,errorMessage:a}),p.current.validationTime+=t,!s&&(p.current.validationErrors++,p.current.errorCount++),t>100&&console.warn("[PERF] Slow validation for ".concat(e,": ").concat(t,"ms"))},[]),f=(0,r.useCallback)((e,t)=>{p.current.errorCount++,console.error("[MaintenanceTypeForm] Error in ".concat(e,":"),t),window.gtag&&window.gtag("event","form_error",{form_name:"maintenance_type_form",error_context:e,error_message:(null==t?void 0:t.message)||"Unknown error"})},[]),y=(0,r.useCallback)(()=>{let e=p.current,t=u.current.reduce((e,t)=>e+t.validationTime,0),s={form:"MaintenanceTypeForm",loadTime:e.loadTime,submitTime:e.submitTime,totalValidationTime:t,errorCount:e.errorCount,interactionCount:e.interactionCount,focusEvents:e.focusEvents,clickEvents:e.clickEvents,validationErrors:e.validationErrors,renderTime:e.renderTime,validationBreakdown:u.current.slice(-10),timestamp:Date.now()};return console.log("[PERF] MaintenanceTypeForm Performance Summary:",s),window.gtag&&window.gtag("event","form_performance",{form_name:"maintenance_type_form",load_time:e.loadTime,submit_time:e.submitTime,validation_time:t,error_count:e.errorCount,interaction_count:e.interactionCount}),s},[]),{register:j,handleSubmit:g,reset:b,setValue:k,watch:w,formState:{errors:S}}=(0,v.mN)({defaultValues:{name:"",description:"",is_preventive:!0,is_emergency:!1,typical_duration_hours:2,blocks_production:!0,allows_emergency_override:!1,requires_shutdown:!0,required_skill_level:"",requires_external_vendor:!1}}),C=async()=>{let e=Date.now();a(!0);try{let{data:s,error:a}=await N.N.from("maintenance_types").select("*").order("name",{ascending:!0});if(a)throw a;t(s||[]);let i=Date.now()-e;console.log("[PERF] Maintenance types fetch: ".concat(i,"ms")),i>1e3&&console.warn("[PERF] Slow data fetch detected: ".concat(i,"ms"))}catch(e){f("fetch_maintenance_types",e),console.error("Error fetching maintenance types:",e),d({title:"Error",description:"Failed to fetch maintenance types",variant:"destructive"})}finally{a(!1)}};(0,r.useEffect)(()=>{let e=Date.now()-m.current;p.current.loadTime=e,console.log("[PERF] MaintenanceTypeForm load time: ".concat(e,"ms")),e>2e3&&console.warn("[PERF] Slow form load detected: ".concat(e,"ms")),C()},[C]),(0,r.useEffect)(()=>{let e=Date.now()-h.current;p.current.renderTime=e,console.log("[PERF] MaintenanceTypeForm render time: ".concat(e,"ms")),e>500&&console.warn("[PERF] Slow render detected: ".concat(e,"ms")),h.current=Date.now()}),(0,r.useEffect)(()=>{Object.keys(S).forEach(e=>{let t=S[e];t&&x(e,0,!1,t.message)})},[S,x]),(0,r.useEffect)(()=>()=>{y()},[y]);let E=async e=>{let t=Date.now();o(!0);try{let s={name:e.name,description:e.description||null,is_preventive:e.is_preventive,is_emergency:e.is_emergency,typical_duration_hours:e.typical_duration_hours,blocks_production:e.blocks_production,allows_emergency_override:e.allows_emergency_override,requires_shutdown:e.requires_shutdown,required_skill_level:e.required_skill_level||null,requires_external_vendor:e.requires_external_vendor};if(n){let{error:e}=await N.N.from("maintenance_types").update(s).eq("maintenance_type_id",n);if(e)throw e;d({title:"Success",description:"Maintenance type updated successfully"})}else{let{error:e}=await N.N.from("maintenance_types").insert([s]);if(e)throw e;d({title:"Success",description:"Maintenance type created successfully"})}b(),l(null),C();let a=Date.now()-t;p.current.submitTime=a,console.log("[PERF] Form submission successful: ".concat(a,"ms")),a>3e3&&console.warn("[PERF] Slow form submission detected: ".concat(a,"ms"))}catch(s){f("form_submission",s),console.error("Error saving maintenance type:",s),d({title:"Error",description:"Failed to save maintenance type",variant:"destructive"});let e=Date.now()-t;p.current.submitTime=e,console.log("[PERF] Form submission failed: ".concat(e,"ms"))}finally{o(!1);let e=Date.now()-t;console.log("[PERF] Total submission time (including UI updates): ".concat(e,"ms"))}},T=async e=>{if(!confirm("Are you sure you want to delete this maintenance type?"))return;let t=Date.now();_("click");try{let{error:s}=await N.N.from("maintenance_types").delete().eq("maintenance_type_id",e);if(s)throw s;let a=Date.now()-t;console.log("[PERF] Delete operation: ".concat(a,"ms")),a>2e3&&console.warn("[PERF] Slow delete operation detected: ".concat(a,"ms")),d({title:"Success",description:"Maintenance type deleted successfully"}),C()}catch(e){f("delete_maintenance_type",e),console.error("Error deleting maintenance type:",e),d({title:"Error",description:"Failed to delete maintenance type",variant:"destructive"})}},F=(0,r.useCallback)((e,t)=>{let s=j(e,t);return{...s,onFocus:e=>{_("focus")},onBlur:t=>{var a;let i,r=Date.now();return null==(a=s.onBlur)||a.call(s,t),setTimeout(()=>{var t;let s=Date.now()-r,a=void 0!==S[e];x(e,s,!a,null==(t=S[e])?void 0:t.message)},0),i},onChange:e=>{if(0===p.current.interactionCount){let e=Date.now()-m.current;console.log("[PERF] Time to first input: ".concat(e,"ms"))}if(_("click"),s.onChange)return s.onChange(e)}}},[j,_,x,S]),q=(0,r.useCallback)(e=>()=>{_("click"),e()},[_]);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:n?"Edit Maintenance Type":"Create New Maintenance Type"}),(0,i.jsx)(ex,{children:n?"Update maintenance type information":"Define a new type of maintenance activity for scheduling"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:g(E),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Maintenance Type Name *"}),(0,i.jsx)(X,{id:"name",...F("name",{required:"Maintenance type name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),placeholder:"e.g., Preventive Maintenance, Emergency Repair"}),S.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:S.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"typical_duration_hours",children:"Typical Duration (hours)"}),(0,i.jsx)(X,{id:"typical_duration_hours",type:"number",min:"0",step:"0.1",...F("typical_duration_hours",{valueAsNumber:!0,min:{value:0,message:"Duration must be non-negative"}})}),S.typical_duration_hours&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:S.typical_duration_hours.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"required_skill_level",children:"Required Skill Level"}),(0,i.jsxs)(en,{onValueChange:e=>{_("click"),k("required_skill_level",e)},children:[(0,i.jsx)(ec,{id:"required_skill_level",onFocus:()=>_("focus"),children:(0,i.jsx)(el,{placeholder:"Select skill level"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Specific Requirement"}),tp.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))]})]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"description",children:"Description"}),(0,i.jsx)(K,{id:"description",...F("description"),placeholder:"Detailed description of the maintenance type and procedures",rows:3})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(Z,{className:"text-base font-medium",children:"Maintenance Characteristics"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_preventive",name:"is_preventive",checked:w("is_preventive"),onCheckedChange:e=>{_("click"),k("is_preventive",e)}}),(0,i.jsx)(Z,{htmlFor:"is_preventive",children:"Preventive Maintenance"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Scheduled maintenance to prevent failures"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"is_emergency",name:"is_emergency",checked:w("is_emergency"),onCheckedChange:e=>{_("click"),k("is_emergency",e)}}),(0,i.jsx)(Z,{htmlFor:"is_emergency",children:"Emergency Maintenance"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Unplanned maintenance for failures"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"blocks_production",name:"blocks_production",checked:w("blocks_production"),onCheckedChange:e=>{_("click"),k("blocks_production",e)}}),(0,i.jsx)(Z,{htmlFor:"blocks_production",children:"Blocks Production"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Prevents production during maintenance"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"allows_emergency_override",name:"allows_emergency_override",checked:w("allows_emergency_override"),onCheckedChange:e=>{_("click"),k("allows_emergency_override",e)}}),(0,i.jsx)(Z,{htmlFor:"allows_emergency_override",children:"Allows Emergency Override"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Can be interrupted for emergencies"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"requires_shutdown",name:"requires_shutdown",checked:w("requires_shutdown"),onCheckedChange:e=>{_("click"),k("requires_shutdown",e)}}),(0,i.jsx)(Z,{htmlFor:"requires_shutdown",children:"Requires Shutdown"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Equipment must be shut down"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"requires_external_vendor",name:"requires_external_vendor",checked:w("requires_external_vendor"),onCheckedChange:e=>{_("click"),k("requires_external_vendor",e)}}),(0,i.jsx)(Z,{htmlFor:"requires_external_vendor",children:"Requires External Vendor"}),(0,i.jsx)("p",{className:"text-xs text-gray-500 ml-2",children:"Needs external service provider"})]})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[n&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:q(()=>{_("click"),b(),l(null)}),children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:c,onClick:()=>_("click"),children:[c&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Update":"Create"," Maintenance Type"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"maintenance_types",entityName:"Maintenance Type",sampleData:{name:"Preventive Maintenance",description:"Scheduled maintenance to prevent equipment failures",is_preventive:!0,is_emergency:!1,typical_duration_hours:4,blocks_production:!0,allows_emergency_override:!1,requires_shutdown:!0,required_skill_level:"COMPETENT",requires_external_vendor:!1},onUploadComplete:C,requiredFields:["name"],fieldDescriptions:{name:"Maintenance type display name",description:"Detailed description of maintenance procedures",typical_duration_hours:"Expected duration in hours (decimal)",is_preventive:"Scheduled preventive maintenance (true/false)",is_emergency:"Emergency/unplanned maintenance (true/false)",blocks_production:"Prevents production during maintenance (true/false)",allows_emergency_override:"Can be interrupted for emergencies (true/false)",requires_shutdown:"Equipment must be shut down (true/false)",requires_external_vendor:"Needs external service provider (true/false)",required_skill_level:"NOVICE, COMPETENT, PROFICIENT, EXPERT"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Maintenance Types"}),(0,i.jsx)(ex,{children:"Manage existing maintenance types"})]}),(0,i.jsx)(ef,{children:s?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No maintenance types found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Name"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Duration"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Skill Level"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Type"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Impact"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Requirements"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:e.name}),(0,i.jsxs)("td",{className:"p-2",children:[e.typical_duration_hours,"h"]}),(0,i.jsx)("td",{className:"p-2",children:e.required_skill_level?(0,i.jsx)("span",{className:"capitalize",children:e.required_skill_level.toLowerCase()}):"-"}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.is_preventive&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:"Preventive"}),e.is_emergency&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-red-100 text-red-800",children:"Emergency"})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.blocks_production&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800",children:"Blocks Prod"}),e.requires_shutdown&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:"Shutdown"})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.allows_emergency_override&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-green-100 text-green-800",children:"Override OK"}),e.requires_external_vendor&&(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-800",children:"Ext Vendor"})]})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:q(()=>{l(e.maintenance_type_id),k("name",e.name),k("description",e.description||""),k("is_preventive",e.is_preventive),k("is_emergency",e.is_emergency),k("typical_duration_hours",e.typical_duration_hours),k("blocks_production",e.blocks_production),k("allows_emergency_override",e.allows_emergency_override),k("requires_shutdown",e.requires_shutdown),k("required_skill_level",e.required_skill_level||""),k("requires_external_vendor",e.requires_external_vendor)}),children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:q(()=>T(e.maintenance_type_id)),children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.maintenance_type_id))})]})})})]}),!1]})}let t_=[{value:"pending",label:"Pending"},{value:"scheduled",label:"Scheduled"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"},{value:"on_hold",label:"On Hold"}];function tx(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[u,p]=(0,r.useState)(!1),{toast:h}=(0,J.dj)(),{register:_,handleSubmit:x,reset:f,setValue:y,watch:j,formState:{errors:g}}=(0,v.mN)({defaultValues:{template_id:"",name:"",department_id:"",priority:1,due_date:"",earliest_start_date:new Date().toISOString().split("T")[0],customer_order_id:"",batch_id:"",quantity:1,estimated_cost:0,revenue_value:0,status:"pending",estimated_duration_hours:0}}),b=eX("JobInstanceForm");(0,r.useEffect)(()=>{Object.keys(g).length>0&&Object.keys(g).forEach(e=>{var t;b.trackValidation(e,!0,null==(t=g[e])?void 0:t.message)})},[g,b]),(0,r.useEffect)(()=>()=>{b.finalizeMetrics()},[b]);let k=(0,r.useCallback)(async()=>{o(!0);try{let{data:e,error:s}=await N.N.from("job_instances").select("\n          *,\n          job_templates!inner(name)\n        ").order("created_at",{ascending:!1});if(s)throw s;t(e||[])}catch(e){console.error("Error fetching job instances:",e),h({title:"Error",description:"Failed to fetch job instances",variant:"destructive"})}finally{o(!1)}},[h]),w=(0,r.useCallback)(async()=>{try{let{data:e,error:t}=await N.N.from("job_optimized_patterns").select("pattern_id, name").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;let s=(null==e?void 0:e.map(e=>({template_id:e.pattern_id,name:e.name})))||[];a(s)}catch(e){console.error("Error fetching job templates:",e)}},[]),S=(0,r.useCallback)(async()=>{try{let{data:e,error:t}=await N.N.from("departments").select("department_id, name, code").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;l(e||[])}catch(e){console.error("Error fetching departments:",e)}},[]);(0,r.useEffect)(()=>{k(),w(),S()},[k,w,S]);let C=async e=>{b.trackSubmissionStart(),p(!0);try{let t={template_id:e.template_id,pattern_id:e.template_id,name:e.name,department_id:e.department_id||null,priority:e.priority,due_date:e.due_date||null,earliest_start_date:e.earliest_start_date,customer_order_id:e.customer_order_id||null,batch_id:e.batch_id||null,quantity:e.quantity,estimated_cost:e.estimated_cost||null,revenue_value:e.revenue_value||null,status:e.status,estimated_duration_hours:e.estimated_duration_hours||null};if(d){let{error:e}=await N.N.from("job_instances").update(t).eq("instance_id",d);if(e)throw e;h({title:"Success",description:"Job instance updated successfully"})}else{let{error:e}=await N.N.from("job_instances").insert([t]);if(e)throw e;h({title:"Success",description:"Job instance created successfully"})}f(),m(null),k(),b.trackSubmissionEnd(!0)}catch(e){console.error("Error saving job instance:",e),b.trackSubmissionEnd(!1),b.trackValidation("submission",!0,String(e)),h({title:"Error",description:"Failed to save job instance",variant:"destructive"})}finally{p(!1)}},E=async e=>{if(confirm("Are you sure you want to delete this job instance?"))try{let{error:t}=await N.N.from("job_instances").delete().eq("instance_id",e);if(t)throw t;h({title:"Success",description:"Job instance deleted successfully"}),k()}catch(e){console.error("Error deleting job instance:",e),h({title:"Error",description:"Failed to delete job instance",variant:"destructive"})}},T={template_id:"",pattern_id:"",name:"Production Run #001",department_id:null,priority:1,due_date:null,earliest_start_date:new Date().toISOString().split("T")[0],customer_order_id:"ORD-2024-001",batch_id:"BATCH-001",quantity:100,estimated_cost:1500,revenue_value:2e3,status:"pending",estimated_duration_hours:8};return(0,i.jsxs)("div",{className:"space-y-6",children:[!1,(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:d?"Edit Job Instance":"Create New Job Instance"}),(0,i.jsx)(ex,{children:d?"Update job instance information":"Create a new job instance based on a job template"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:x(C),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"template_id",children:"Job Template *"}),(0,i.jsxs)(en,{value:j("template_id"),onValueChange:e=>{b.trackInteraction("change","select_field"),y("template_id",e)},children:[(0,i.jsx)(ec,{onFocus:()=>b.trackInteraction("focus","template_id"),children:(0,i.jsx)(el,{placeholder:"Select job template"})}),(0,i.jsx)(em,{children:s.map(e=>(0,i.jsx)(eu,{value:e.template_id,children:e.name},e.template_id))})]}),!j("template_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Job template is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"name",children:"Job Instance Name *"}),(0,i.jsx)(X,{id:"name",..._("name",{required:"Job instance name is required",maxLength:{value:255,message:"Name must be 255 characters or less"}}),onFocus:()=>b.trackInteraction("focus","name"),onChange:e=>b.trackInteraction("change","name"),placeholder:"e.g., Production Run #001"}),g.name&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.name.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"department_id",children:"Department"}),(0,i.jsxs)(en,{value:j("department_id"),onValueChange:e=>{b.trackInteraction("change","select_field"),y("department_id","none"===e?"":e)},children:[(0,i.jsx)(ec,{onFocus:()=>b.trackInteraction("focus","department_id"),children:(0,i.jsx)(el,{placeholder:"Select department"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Department"}),n.map(e=>(0,i.jsxs)(eu,{value:e.department_id,children:[e.name," (",e.code,")"]},e.department_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"status",children:"Status"}),(0,i.jsxs)(en,{value:j("status"),onValueChange:e=>y("status",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select status"})}),(0,i.jsx)(em,{children:t_.map(e=>(0,i.jsx)(eu,{value:e.value,children:e.label},e.value))})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"priority",children:"Priority"}),(0,i.jsx)(X,{id:"priority",type:"number",min:"1",..._("priority",{valueAsNumber:!0,min:{value:1,message:"Priority must be at least 1"}}),onFocus:()=>b.trackInteraction("focus","priority"),onChange:e=>b.trackInteraction("change","priority")}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Higher numbers = higher priority"}),g.priority&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.priority.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"quantity",children:"Quantity"}),(0,i.jsx)(X,{id:"quantity",type:"number",min:"1",..._("quantity",{valueAsNumber:!0,min:{value:1,message:"Quantity must be at least 1"}})}),g.quantity&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.quantity.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"due_date",children:"Due Date"}),(0,i.jsx)(X,{id:"due_date",type:"date",..._("due_date")}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Critical for minimize lateness objective"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"earliest_start_date",children:"Earliest Start Date"}),(0,i.jsx)(X,{id:"earliest_start_date",type:"date",..._("earliest_start_date",{required:"Earliest start date is required"})}),g.earliest_start_date&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.earliest_start_date.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"customer_order_id",children:"Customer Order ID"}),(0,i.jsx)(X,{id:"customer_order_id",..._("customer_order_id"),placeholder:"e.g., ORD-2024-001"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"batch_id",children:"Batch ID"}),(0,i.jsx)(X,{id:"batch_id",..._("batch_id"),placeholder:"e.g., BATCH-001"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"estimated_cost",children:"Estimated Cost ($)"}),(0,i.jsx)(X,{id:"estimated_cost",type:"number",min:"0",step:"0.01",..._("estimated_cost",{valueAsNumber:!0,min:{value:0,message:"Cost must be non-negative"}})}),g.estimated_cost&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.estimated_cost.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"revenue_value",children:"Revenue Value ($)"}),(0,i.jsx)(X,{id:"revenue_value",type:"number",min:"0",step:"0.01",..._("revenue_value",{valueAsNumber:!0,min:{value:0,message:"Revenue must be non-negative"}})}),g.revenue_value&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.revenue_value.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"estimated_duration_hours",children:"Estimated Duration (hours)"}),(0,i.jsx)(X,{id:"estimated_duration_hours",type:"number",min:"0",step:"0.1",..._("estimated_duration_hours",{valueAsNumber:!0,min:{value:0,message:"Duration must be non-negative"}})}),g.estimated_duration_hours&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.estimated_duration_hours.message})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[d&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{f(),m(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:u||!j("template_id"),children:[u&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Update":"Create"," Job Instance"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"job_instances",entityName:"Job Instance",sampleData:T,onUploadComplete:k,requiredFields:["template_id","name","earliest_start_date"],fieldDescriptions:{template_id:"Job template ID (required)",pattern_id:"Pattern ID (same as template_id for compatibility)",name:"Job instance display name",priority:"Job priority (higher numbers = higher priority)",due_date:"Target completion date (YYYY-MM-DD)",earliest_start_date:"Earliest possible start date (YYYY-MM-DD)",quantity:"Number of items to produce",estimated_cost:"Estimated production cost",revenue_value:"Expected revenue from this job",status:"pending, scheduled, in_progress, completed, cancelled, on_hold"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Job Instances"}),(0,i.jsx)(ex,{children:"Manage existing job instances"})]}),(0,i.jsx)(ef,{children:c?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No job instances found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Name"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Pattern"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Department"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Priority"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Due Date"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Quantity"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Status"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Est. Cost"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Revenue"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{var t;let s=n.find(t=>t.department_id===e.department_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:(0,i.jsxs)("div",{children:[e.name,e.customer_order_id&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["Order: ",e.customer_order_id]})]})}),(0,i.jsx)("td",{className:"p-2",children:(null==(t=e.job_templates)?void 0:t.name)||"Unknown"}),(0,i.jsx)("td",{className:"p-2",children:s?"".concat(s.name," (").concat(s.code,")"):"-"}),(0,i.jsx)("td",{className:"p-2",children:e.priority}),(0,i.jsx)("td",{className:"p-2",children:e.due_date?new Date(e.due_date).toLocaleDateString():"-"}),(0,i.jsx)("td",{className:"p-2",children:e.quantity}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs capitalize ".concat("completed"===e.status?"bg-green-100 text-green-800":"in_progress"===e.status?"bg-blue-100 text-blue-800":"cancelled"===e.status?"bg-red-100 text-red-800":"on_hold"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status.replace("_"," ")})}),(0,i.jsx)("td",{className:"p-2",children:e.estimated_cost?"$".concat(e.estimated_cost.toFixed(2)):"-"}),(0,i.jsx)("td",{className:"p-2",children:e.revenue_value?"$".concat(e.revenue_value.toFixed(2)):"-"}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{m(e.instance_id),y("template_id",e.template_id),y("name",e.name),y("department_id",e.department_id||""),y("priority",e.priority),y("due_date",e.due_date?e.due_date.split("T")[0]:""),y("earliest_start_date",e.earliest_start_date.split("T")[0]),y("customer_order_id",e.customer_order_id||""),y("batch_id",e.batch_id||""),y("quantity",e.quantity),y("estimated_cost",e.estimated_cost||0),y("revenue_value",e.revenue_value||0),y("status",e.status),y("estimated_duration_hours",e.estimated_duration_hours||0)},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>E(e.instance_id),children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.instance_id)})})]})})})]})]})}function tf(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[u,p]=(0,r.useState)(!1),{toast:h}=(0,J.dj)(),{register:_,handleSubmit:x,reset:f,setValue:y,watch:j,formState:{errors:g}}=(0,v.mN)({defaultValues:{pattern_id:"",predecessor_optimized_task_id:"",successor_optimized_task_id:"",min_delay_minutes:0,max_delay_minutes:0,requires_department_transfer:!1,transfer_time_minutes:0}}),b=async()=>{o(!0);try{let{data:e,error:s}=await N.N.from("optimized_precedences").select("*").limit(1);if(s){if("42703"===s.code||"42P01"===s.code){console.warn("optimized_precedences table does not exist yet:",s.message),t([]);return}throw s}let{data:a,error:i}=await N.N.from("optimized_precedences").select("*").limit(10);if(i)throw i;t(a||[])}catch(e){console.error("Error fetching template precedences:",e),console.error("Error details:",{message:null==e?void 0:e.message,details:null==e?void 0:e.details,hint:null==e?void 0:e.hint,code:null==e?void 0:e.code}),h({title:"Warning",description:"Template precedences table not available yet",variant:"default"}),t([])}finally{o(!1)}},k=async()=>{try{let{data:e,error:t}=await N.N.from("optimized_tasks").select("\n          optimized_task_id,\n          name,\n          pattern_id,\n          job_optimized_patterns!inner(name)\n        ").order("name",{ascending:!0});if(t)throw t;let s=(null==e?void 0:e.map(e=>{var t;return{optimized_task_id:e.optimized_task_id,name:e.name,pattern_id:e.pattern_id,pattern_name:(null==(t=e.job_optimized_patterns)?void 0:t.name)||"Unknown Pattern"}}))||[];a(s)}catch(e){console.error("Error fetching optimized tasks:",e)}},w=async()=>{try{let{data:e,error:t}=await N.N.from("job_optimized_patterns").select("pattern_id, name").order("name",{ascending:!0});if(t)throw t;l(e||[])}catch(e){console.error("Error fetching patterns:",e)}};(0,r.useEffect)(()=>{b(),k(),w()},[]);let S=async e=>{p(!0);try{if(e.predecessor_optimized_task_id===e.successor_optimized_task_id){h({title:"Error",description:"Predecessor and successor tasks must be different",variant:"destructive"}),p(!1);return}let t={pattern_id:e.pattern_id,predecessor_optimized_task_id:e.predecessor_optimized_task_id,successor_optimized_task_id:e.successor_optimized_task_id,min_delay_minutes:e.min_delay_minutes,max_delay_minutes:e.max_delay_minutes||null,requires_department_transfer:e.requires_department_transfer,transfer_time_minutes:e.transfer_time_minutes};if(d){let{error:e}=await N.N.from("optimized_precedences").update(t).eq("optimized_precedence_id",d);if(e)throw e;h({title:"Success",description:"Template precedence updated successfully"})}else{let{error:e}=await N.N.from("optimized_precedences").insert([t]);if(e)throw e;h({title:"Success",description:"Template precedence created successfully"})}f(),m(null),b()}catch(e){console.error("Error saving template precedence:",e),h({title:"Error",description:"Failed to save template precedence",variant:"destructive"})}finally{p(!1)}},C=async e=>{if(confirm("Are you sure you want to delete this template precedence?"))try{let{error:t}=await N.N.from("optimized_precedences").delete().eq("optimized_precedence_id",e);if(t)throw t;h({title:"Success",description:"Template precedence deleted successfully"}),b()}catch(e){console.error("Error deleting template precedence:",e),h({title:"Error",description:"Failed to delete template precedence",variant:"destructive"})}},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return s.filter(s=>s.pattern_id===e&&s.optimized_task_id!==t)},T=j("pattern_id"),F=j("predecessor_optimized_task_id");return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsx)(eS,{value:"form",className:"space-y-6",children:(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:d?"Edit Template Precedence":"Create New Template Precedence"}),(0,i.jsx)(ex,{children:d?"Update template precedence relationship":"Define precedence constraints between tasks in optimized patterns"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:x(S),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"pattern_id",children:"Job Optimized Pattern *"}),(0,i.jsxs)(en,{onValueChange:e=>{y("pattern_id",e),y("predecessor_optimized_task_id",""),y("successor_optimized_task_id","")},children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select pattern"})}),(0,i.jsx)(em,{children:n.map(e=>(0,i.jsx)(eu,{value:e.pattern_id,children:e.name},e.pattern_id))})]}),!j("pattern_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Pattern is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"predecessor_optimized_task_id",children:"Predecessor Task *"}),(0,i.jsxs)(en,{onValueChange:e=>y("predecessor_optimized_task_id",e),disabled:!T,children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select predecessor task"})}),(0,i.jsx)(em,{children:E(T,F).map(e=>(0,i.jsx)(eu,{value:e.optimized_task_id,children:e.name},e.optimized_task_id))})]}),!j("predecessor_optimized_task_id")&&T&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Predecessor task is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"successor_optimized_task_id",children:"Successor Task *"}),(0,i.jsxs)(en,{onValueChange:e=>y("successor_optimized_task_id",e),disabled:!T,children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select successor task"})}),(0,i.jsx)(em,{children:E(T,F).map(e=>(0,i.jsx)(eu,{value:e.optimized_task_id,children:e.name},e.optimized_task_id))})]}),!j("successor_optimized_task_id")&&T&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Successor task is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"min_delay_minutes",children:"Minimum Delay (minutes)"}),(0,i.jsx)(X,{id:"min_delay_minutes",type:"number",min:"0",..._("min_delay_minutes",{valueAsNumber:!0,min:{value:0,message:"Minimum delay must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Minimum time between predecessor completion and successor start"}),g.min_delay_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.min_delay_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"max_delay_minutes",children:"Maximum Delay (minutes)"}),(0,i.jsx)(X,{id:"max_delay_minutes",type:"number",min:"0",..._("max_delay_minutes",{valueAsNumber:!0,min:{value:0,message:"Maximum delay must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Maximum time between tasks (0 = no limit)"}),g.max_delay_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.max_delay_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"transfer_time_minutes",children:"Transfer Time (minutes)"}),(0,i.jsx)(X,{id:"transfer_time_minutes",type:"number",min:"0",..._("transfer_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Transfer time must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Time required for material transfer between departments"}),g.transfer_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:g.transfer_time_minutes.message})]})]}),(0,i.jsx)("div",{className:"flex flex-col space-y-4",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(es,{id:"requires_department_transfer",checked:j("requires_department_transfer"),onCheckedChange:e=>y("requires_department_transfer",e)}),(0,i.jsx)(Z,{htmlFor:"requires_department_transfer",children:"Requires Department Transfer"})]})}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[d&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{f(),m(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:u||!j("pattern_id")||!j("predecessor_optimized_task_id")||!j("successor_optimized_task_id"),children:[u&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Update":"Create"," Template Precedence"]})]})]})})]})}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"optimized_precedences",entityName:"Template Precedence",sampleData:{pattern_id:"PATTERN_001",predecessor_optimized_task_id:"TASK_001",successor_optimized_task_id:"TASK_002",min_delay_minutes:0,max_delay_minutes:120,requires_department_transfer:!1,transfer_time_minutes:0,is_mandatory:!0},onUploadComplete:b,requiredFields:["pattern_id","predecessor_optimized_task_id","successor_optimized_task_id"],fieldDescriptions:{pattern_id:"Job optimized pattern ID (required)",predecessor_optimized_task_id:"Task that must complete first (required)",successor_optimized_task_id:"Task that follows the predecessor (required)",min_delay_minutes:"Minimum time delay between tasks in minutes (default: 0)",max_delay_minutes:"Maximum time delay between tasks in minutes (0 = no limit)",requires_department_transfer:"Whether tasks require department transfer (true/false)",transfer_time_minutes:"Time required for material transfer between departments (default: 0)",is_mandatory:"Whether this precedence constraint is mandatory (true/false)"}})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Template Precedences"}),(0,i.jsx)(ex,{children:"Manage existing precedence relationships between template tasks"})]}),(0,i.jsx)(ef,{children:c?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No template precedences found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Pattern"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Predecessor"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Successor"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Min Delay"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Max Delay"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Transfer"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{let t=n.find(t=>t.pattern_id===e.pattern_id),a=s.find(t=>t.optimized_task_id===e.predecessor_optimized_task_id),r=s.find(t=>t.optimized_task_id===e.successor_optimized_task_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:(null==t?void 0:t.name)||"Unknown"}),(0,i.jsx)("td",{className:"p-2",children:(null==a?void 0:a.name)||"Unknown"}),(0,i.jsx)("td",{className:"p-2",children:(null==r?void 0:r.name)||"Unknown"}),(0,i.jsxs)("td",{className:"p-2",children:[e.min_delay_minutes,"m"]}),(0,i.jsx)("td",{className:"p-2",children:e.max_delay_minutes?"".concat(e.max_delay_minutes,"m"):"No limit"}),(0,i.jsx)("td",{className:"p-2",children:e.requires_department_transfer?(0,i.jsxs)("span",{className:"text-orange-600",children:[e.transfer_time_minutes,"m"]}):(0,i.jsx)("span",{className:"text-gray-400",children:"No"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{m(e.optimized_precedence_id),y("pattern_id",e.pattern_id),y("predecessor_optimized_task_id",e.predecessor_optimized_task_id),y("successor_optimized_task_id",e.successor_optimized_task_id),y("min_delay_minutes",e.min_delay_minutes),y("max_delay_minutes",e.max_delay_minutes||0),y("requires_department_transfer",e.requires_department_transfer),y("transfer_time_minutes",e.transfer_time_minutes)},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>C(e.optimized_precedence_id),children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.optimized_precedence_id)})})]})})})]})]})}let ty=[{code:"23505",pattern:/duplicate key value violates unique constraint/i,userMessage:"This record already exists. Please check for duplicates.",category:"constraint"},{pattern:/duplicate key.*"(\w+)".*unique/i,userMessage:"A record with this value already exists.",category:"constraint"},{code:"23503",pattern:/violates foreign key constraint/i,userMessage:"Cannot complete this action because related records exist.",category:"constraint"},{pattern:/is still referenced from table "(\w+)"/i,userMessage:"Cannot delete this record because it is still being used.",category:"constraint"},{code:"23502",pattern:/null value in column "(\w+)" violates not-null constraint/i,userMessage:"Required field is missing. Please fill in all required fields.",category:"validation"},{code:"23514",pattern:/violates check constraint/i,userMessage:"The data entered does not meet the required format.",category:"validation"},{pattern:/permission denied|insufficient privilege/i,userMessage:"You do not have permission to perform this action.",category:"permission"},{pattern:/connection.*refused|network.*unreachable/i,userMessage:"Unable to connect to the database. Please try again.",category:"connection"},{pattern:/timeout|timed out/i,userMessage:"The request took too long. Please try again.",category:"connection"},{pattern:/machine.*already.*assigned/i,userMessage:"This machine is already assigned to another task.",category:"constraint"},{pattern:/operator.*not.*available/i,userMessage:"The selected operator is not available for this time slot.",category:"constraint"},{pattern:/skill.*required.*missing/i,userMessage:"The operator does not have the required skills for this task.",category:"validation"},{pattern:/department.*capacity.*exceeded/i,userMessage:"Department capacity has been exceeded for this time period.",category:"constraint"},{pattern:/maintenance.*window.*conflict/i,userMessage:"This task conflicts with scheduled maintenance.",category:"constraint"}];function tj(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];let t=function(e){let t="string"==typeof e?e:(null==e?void 0:e.message)||String(e),s=(null==e?void 0:e.code)||(null==e?void 0:e.error_code);for(let e of ty){if(e.code&&s===e.code)return{userMessage:e.userMessage,category:e.category,originalError:t};if(e.pattern&&e.pattern.test(t)){let s=e.userMessage,a=t.match(e.pattern);return a&&a[1]&&(s=s.replace(/this value|this field/i,'"'.concat(a[1],'"'))),{userMessage:s,category:e.category,originalError:t}}}return{userMessage:"An unexpected error occurred. Please try again or contact support.",category:"unknown",originalError:t}}(e),s="Error";switch(t.category){case"validation":s="Validation Error";break;case"constraint":s="Data Conflict";break;case"permission":s="Permission Denied";break;case"connection":s="Connection Error";break;default:s="Error"}return{title:s,description:t.userMessage,variant:"destructive"}}let tg={slowLoad:1e3,slowSubmission:2e3,highErrorRate:5};function tv(e){let{formName:t,metrics:s,className:a="mt-6",thresholds:i=tg}=e;return null}let tb={instance_id:"JOB_001",optimized_task_id:"TASK_001",selected_mode_id:"MODE_001",assigned_machine_id:"MACHINE_001",start_time_minutes:0,end_time_minutes:60,actual_duration_minutes:55,setup_time_minutes:5};function tN(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,l]=(0,r.useState)([]),[c,o]=(0,r.useState)([]),[d,m]=(0,r.useState)([]),[u,p]=(0,r.useState)(!1),[h,_]=(0,r.useState)(null),[x,f]=(0,r.useState)(!1),{toast:y}=(0,J.dj)(),j=eX("job-task-form"),{register:g,handleSubmit:b,reset:k,setValue:w,watch:S,formState:{errors:C}}=(0,v.mN)({defaultValues:{instance_id:"",optimized_task_id:"",selected_mode_id:"",assigned_machine_id:"",start_time_minutes:0,end_time_minutes:0,actual_duration_minutes:0,setup_time_minutes:0}}),E=(0,r.useCallback)((e,t)=>({...g(e,t),onFocus:t=>{j.trackInteraction("focus",e)},onBlur:s=>{var a,i;j.startValidation(e);let r=!!C[e];j.trackValidation(e,r),null==(a=(i=g(e,t)).onBlur)||a.call(i,s)},onChange:s=>{var a,i;j.trackInteraction("change",e),null==(a=(i=g(e,t)).onChange)||a.call(i,s)}}),[g,j,C]),T=async()=>{p(!0);try{let{data:e,error:s}=await N.N.from("instance_task_assignments").select("*").order("created_at",{ascending:!1}).limit(10);if(s)throw s;t(e||[])}catch(e){console.error("Error fetching job tasks:",e),y(tj(e,"job tasks","fetch"))}finally{p(!1)}},F=async()=>{try{let{data:e,error:t}=await N.N.from("job_instances").select("instance_id, name, pattern_id").order("name",{ascending:!0});if(t)throw t;a(e||[])}catch(e){console.error("Error fetching job instances:",e)}},q=async()=>{try{let{data:e,error:t}=await N.N.from("optimized_tasks").select("optimized_task_id, name, pattern_id").order("name",{ascending:!0});if(t)throw t;l(e||[])}catch(e){console.error("Error fetching optimized tasks:",e)}},A=async()=>{try{let{data:e,error:t}=await N.N.from("optimized_task_modes").select("optimized_task_mode_id, mode_name, duration_minutes, optimized_task_id").order("mode_name",{ascending:!0});if(t)throw t;o(e||[])}catch(e){console.error("Error fetching task modes:",e)}},M=async()=>{try{let{data:e,error:t}=await N.N.from("machines").select("machine_resource_id, name").eq("is_active",!0).order("name",{ascending:!0});if(t)throw t;m(e||[])}catch(e){console.error("Error fetching machines:",e)}};(0,r.useEffect)(()=>{T(),F(),q(),A(),M()},[]);let I=async e=>{f(!0),j.trackSubmissionStart();try{if(j.startValidation("time_validation"),e.start_time_minutes>=e.end_time_minutes){j.trackValidation("time_validation",!0,"End time must be after start time"),y({title:"Error",description:"End time must be after start time",variant:"destructive"}),j.trackSubmissionEnd(!1),f(!1);return}j.trackValidation("time_validation",!1);let t={instance_id:e.instance_id,optimized_task_id:e.optimized_task_id,selected_mode_id:e.selected_mode_id||null,assigned_machine_id:e.assigned_machine_id||null,start_time_minutes:e.start_time_minutes||null,end_time_minutes:e.end_time_minutes||null,actual_duration_minutes:e.actual_duration_minutes||null,setup_time_minutes:e.setup_time_minutes};if(h){let{error:e}=await N.N.from("instance_task_assignments").update(t).eq("assignment_id",h);if(e)throw e;y({title:"Success",description:"Job task updated successfully"})}else{let{error:e}=await N.N.from("instance_task_assignments").insert([t]);if(e)throw e;y({title:"Success",description:"Job task created successfully"})}k(),_(null),T(),j.trackSubmissionEnd(!0)}catch(e){console.error("Error saving job task:",e),j.trackSubmissionEnd(!1),y(tj(e,"job task",h?"update":"create"))}finally{f(!1)}},z=async e=>{if(confirm("Are you sure you want to delete this job task assignment?"))try{let{error:t}=await N.N.from("instance_task_assignments").delete().eq("assignment_id",e);if(t)throw t;y({title:"Success",description:"Job task deleted successfully"}),T()}catch(e){console.error("Error deleting job task:",e),y(tj(e,"job task","delete"))}},D=S("instance_id"),R=S("optimized_task_id");return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(eN,{defaultValue:"form",className:"w-full",children:[(0,i.jsxs)(ek,{className:"grid w-full grid-cols-2",children:[(0,i.jsx)(ew,{value:"form",children:"Single Entry"}),(0,i.jsx)(ew,{value:"bulk",children:"Mass Upload"})]}),(0,i.jsxs)(eS,{value:"form",className:"space-y-6",children:[(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:h?"Edit Job Task Assignment":"Create New Job Task Assignment"}),(0,i.jsx)(ex,{children:h?"Update job task assignment details":"Assign optimized tasks to job instances with timing and resource allocation"})]}),(0,i.jsx)(ef,{children:(0,i.jsxs)("form",{onSubmit:b(I),className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"instance_id",children:"Job Instance *"}),(0,i.jsxs)(en,{onValueChange:e=>{j.startValidation("instance_id"),w("instance_id",e),w("optimized_task_id",""),w("selected_mode_id",""),j.trackInteraction("click","instance_id"),j.trackValidation("instance_id",!e)},children:[(0,i.jsx)(ec,{onFocus:()=>j.trackInteraction("focus","instance_id"),onClick:()=>j.trackInteraction("click","instance_id"),children:(0,i.jsx)(el,{placeholder:"Select job instance"})}),(0,i.jsx)(em,{children:s.map(e=>(0,i.jsx)(eu,{value:e.instance_id,children:e.name},e.instance_id))})]}),!S("instance_id")&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Job instance is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"optimized_task_id",children:"Optimized Task *"}),(0,i.jsxs)(en,{onValueChange:e=>{j.startValidation("optimized_task_id"),w("optimized_task_id",e),w("selected_mode_id",""),j.trackInteraction("click","optimized_task_id"),j.trackValidation("optimized_task_id",!e)},disabled:!D,children:[(0,i.jsx)(ec,{onFocus:()=>j.trackInteraction("focus","optimized_task_id"),onClick:()=>j.trackInteraction("click","optimized_task_id"),children:(0,i.jsx)(el,{placeholder:"Select optimized task"})}),(0,i.jsx)(em,{children:(e=>{let t=s.find(t=>t.instance_id===e);return t?n.filter(e=>e.pattern_id===t.pattern_id):[]})(D).map(e=>(0,i.jsx)(eu,{value:e.optimized_task_id,children:e.name},e.optimized_task_id))})]}),!S("optimized_task_id")&&D&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:"Optimized task is required"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"selected_mode_id",children:"Task Mode"}),(0,i.jsxs)(en,{onValueChange:e=>w("selected_mode_id",e),disabled:!R,children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select task mode"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Specific Mode"}),c.filter(e=>e.optimized_task_id===R).map(e=>(0,i.jsxs)(eu,{value:e.optimized_task_mode_id,children:[e.mode_name," (",e.duration_minutes,"m)"]},e.optimized_task_mode_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"assigned_machine_id",children:"Assigned Machine"}),(0,i.jsxs)(en,{onValueChange:e=>w("assigned_machine_id",e),children:[(0,i.jsx)(ec,{children:(0,i.jsx)(el,{placeholder:"Select machine"})}),(0,i.jsxs)(em,{children:[(0,i.jsx)(eu,{value:"none",children:"No Machine Assignment"}),d.map(e=>(0,i.jsx)(eu,{value:e.machine_resource_id,children:e.name},e.machine_resource_id))]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"start_time_minutes",children:"Start Time (minutes)"}),(0,i.jsx)(X,{id:"start_time_minutes",type:"number",min:"0",...E("start_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Start time must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Time from schedule start in minutes"}),C.start_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:C.start_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"end_time_minutes",children:"End Time (minutes)"}),(0,i.jsx)(X,{id:"end_time_minutes",type:"number",min:"0",...E("end_time_minutes",{valueAsNumber:!0,min:{value:0,message:"End time must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Task completion time in minutes"}),C.end_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:C.end_time_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"actual_duration_minutes",children:"Actual Duration (minutes)"}),(0,i.jsx)(X,{id:"actual_duration_minutes",type:"number",min:"0",...E("actual_duration_minutes",{valueAsNumber:!0,min:{value:0,message:"Duration must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Actual time taken to complete task"}),C.actual_duration_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:C.actual_duration_minutes.message})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(Z,{htmlFor:"setup_time_minutes",children:"Setup Time (minutes)"}),(0,i.jsx)(X,{id:"setup_time_minutes",type:"number",min:"0",...E("setup_time_minutes",{valueAsNumber:!0,min:{value:0,message:"Setup time must be non-negative"}})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Time required for task setup"}),C.setup_time_minutes&&(0,i.jsx)("p",{className:"text-sm text-red-600",children:C.setup_time_minutes.message})]})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[h&&(0,i.jsx)(Q,{type:"button",variant:"outline",onClick:()=>{j.trackInteraction("click","cancel_button"),k(),_(null)},children:"Cancel"}),(0,i.jsxs)(Q,{type:"submit",disabled:x||!S("instance_id")||!S("optimized_task_id"),onClick:()=>j.trackInteraction("click","submit_button"),children:[x&&(0,i.jsx)(eq.A,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Update":"Create"," Job Task"]})]})]})})]}),(0,i.jsxs)(ep,{children:[(0,i.jsxs)(eh,{children:[(0,i.jsx)(e_,{children:"Job Task Assignments"}),(0,i.jsx)(ex,{children:"Manage existing job task assignments and their execution details"})]}),(0,i.jsx)(ef,{children:u?(0,i.jsx)("div",{className:"flex justify-center py-4",children:(0,i.jsx)(eq.A,{className:"h-6 w-6 animate-spin"})}):0===e.length?(0,i.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No job tasks found"}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left p-2",children:"Job Instance"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Task"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Mode"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Machine"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Start"}),(0,i.jsx)("th",{className:"text-left p-2",children:"End"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Duration"}),(0,i.jsx)("th",{className:"text-left p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{let t=s.find(t=>t.instance_id===e.instance_id),a=n.find(t=>t.optimized_task_id===e.optimized_task_id),r=c.find(t=>t.optimized_task_mode_id===e.selected_mode_id),l=d.find(t=>t.machine_resource_id===e.assigned_machine_id);return(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"p-2 font-medium",children:(null==t?void 0:t.name)||"Unknown"}),(0,i.jsx)("td",{className:"p-2",children:(null==a?void 0:a.name)||"Unknown"}),(0,i.jsxs)("td",{className:"p-2",children:[(null==r?void 0:r.mode_name)||"No mode",(null==r?void 0:r.duration_minutes)&&(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:[r.duration_minutes,"m"]})]}),(0,i.jsx)("td",{className:"p-2",children:(null==l?void 0:l.name)||"Unassigned"}),(0,i.jsx)("td",{className:"p-2",children:null!==e.start_time_minutes?"".concat(e.start_time_minutes,"m"):"-"}),(0,i.jsx)("td",{className:"p-2",children:null!==e.end_time_minutes?"".concat(e.end_time_minutes,"m"):"-"}),(0,i.jsx)("td",{className:"p-2",children:null!==e.actual_duration_minutes?(0,i.jsxs)("span",{className:"text-green-600",children:[e.actual_duration_minutes,"m"]}):(0,i.jsx)("span",{className:"text-gray-400",children:"Planned"})}),(0,i.jsx)("td",{className:"p-2",children:(0,i.jsxs)("div",{className:"flex space-x-1",children:[(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>{_(e.assignment_id),w("instance_id",e.instance_id),w("optimized_task_id",e.optimized_task_id),w("selected_mode_id",e.selected_mode_id||""),w("assigned_machine_id",e.assigned_machine_id||""),w("start_time_minutes",e.start_time_minutes||0),w("end_time_minutes",e.end_time_minutes||0),w("actual_duration_minutes",e.actual_duration_minutes||0),w("setup_time_minutes",e.setup_time_minutes)},children:(0,i.jsx)(eU.A,{className:"h-4 w-4"})}),(0,i.jsx)(Q,{size:"sm",variant:"outline",onClick:()=>z(e.assignment_id),children:(0,i.jsx)(eB.A,{className:"h-4 w-4"})})]})})]},e.assignment_id)})})]})})})]})]}),(0,i.jsx)(eS,{value:"bulk",className:"space-y-6",children:(0,i.jsx)(eO,{tableName:"instance_task_assignments",entityName:"Job Task",sampleData:tb,onUploadComplete:T,requiredFields:["instance_id","optimized_task_id"],fieldDescriptions:{instance_id:"Job instance ID (required)",optimized_task_id:"Optimized task ID (required)",selected_mode_id:"Task execution mode ID",assigned_machine_id:"Machine resource ID for task execution",start_time_minutes:"Task start time in minutes from schedule start",end_time_minutes:"Task completion time in minutes from schedule start",actual_duration_minutes:"Actual time taken to complete task",setup_time_minutes:"Time required for task setup and preparation"}})})]}),(0,i.jsx)(tv,{formName:"Job Task Form",metrics:j})]})}let tk=[{title:"Organization",icon:l.A,items:[{key:"departments",label:"Departments",icon:l.A},{key:"work-cells",label:"Work Cells",icon:c.A},{key:"business-calendars",label:"Business Calendars",icon:o.A}]},{title:"Templates",icon:d.A,items:[{key:"job-templates",label:"Job Templates",icon:d.A},{key:"template-tasks",label:"Template Tasks",icon:m.A},{key:"template-precedences",label:"Template Precedences",icon:u.A}]},{title:"Resources",icon:p.A,items:[{key:"machines",label:"Machines",icon:p.A},{key:"operators",label:"Operators",icon:h.A},{key:"skills",label:"Skills",icon:_.A},{key:"sequence-resources",label:"Sequence Resources",icon:u.A}]},{title:"Scheduling",icon:x.A,items:[{key:"setup-times",label:"Setup Times",icon:x.A},{key:"maintenance-windows",label:"Maintenance Types",icon:f.A}]},{title:"Jobs",icon:y.A,items:[{key:"job-instances",label:"Job Instances",icon:y.A},{key:"job-tasks",label:"Job Tasks",icon:m.A}]}];function tw(){let[e,t]=(0,r.useState)("departments"),[s,a]=(0,r.useState)({Organization:!0,Templates:!1,Resources:!1,Scheduling:!1,Jobs:!1}),[l,c]=(0,r.useState)(!1);return(0,i.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,i.jsx)("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:(0,i.jsx)("button",{onClick:()=>c(!l),className:"p-2 bg-white rounded-md shadow-md hover:bg-gray-50 transition-colors",children:l?(0,i.jsx)(j.A,{className:"h-6 w-6"}):(0,i.jsx)(g.A,{className:"h-6 w-6"})})}),l&&(0,i.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>c(!1)}),(0,i.jsx)("div",{className:(0,n.cn)("fixed lg:static inset-y-0 left-0 z-50 w-80 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out",l?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[(0,i.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,i.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Vulcan MES"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manufacturing Execution System"})]}),(0,i.jsx)("nav",{className:"flex-1 overflow-y-auto py-4",children:tk.map(r=>(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsxs)("button",{onClick:()=>{var e;return e=r.title,void a(t=>({...t,[e]:!t[e]}))},className:"flex items-center justify-between w-full px-6 py-3 text-left text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(r.icon,{className:"mr-3 h-5 w-5 text-gray-500"}),r.title]}),(0,i.jsx)("div",{className:(0,n.cn)("transform transition-transform duration-200",s[r.title]?"rotate-90":"rotate-0"),children:""})]}),s[r.title]&&(0,i.jsx)("div",{className:"ml-4 border-l border-gray-200",children:r.items.map(s=>(0,i.jsxs)("button",{onClick:()=>{t(s.key),c(!1)},className:(0,n.cn)("flex items-center w-full pl-8 pr-6 py-2 text-sm transition-colors",e===s.key?"text-blue-700 bg-blue-50 border-r-2 border-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[(0,i.jsx)(s.icon,{className:"mr-3 h-4 w-4"}),s.label]},s.key))})]},r.title))}),(0,i.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,i.jsx)("p",{children:"Version 1.0.0"}),(0,i.jsx)("p",{children:"Manufacturing Scheduling"})]})})]})}),(0,i.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,i.jsx)("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,i.jsx)("div",{className:"flex items-center",children:(0,i.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 ml-12 lg:ml-0",children:(()=>{for(let t of tk){let s=t.items.find(t=>t.key===e);if(s)return s.label}return"Vulcan MES"})()})})}),(0,i.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:(0,i.jsx)("div",{className:"max-w-4xl",children:(()=>{switch(e){case"departments":return(0,i.jsx)(eW,{});case"job-templates":return(0,i.jsx)(eG,{});case"machines":return(0,i.jsx)(eZ,{});case"setup-times":return(0,i.jsx)(e5,{});case"template-tasks":return(0,i.jsx)(e6,{});case"work-cells":return(0,i.jsx)(e9,{});case"business-calendars":return(0,i.jsx)(te,{});case"operators":return(0,i.jsx)(ts,{});case"skills":return(0,i.jsx)(td,{});case"sequence-resources":return(0,i.jsx)(tu,{});case"maintenance-windows":return(0,i.jsx)(th,{});case"job-instances":return(0,i.jsx)(tx,{});case"template-precedences":return(0,i.jsx)(tf,{});case"job-tasks":return(0,i.jsx)(tN,{});default:return(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)("p",{className:"text-gray-500",children:"Select a form from the sidebar to get started"})})}})()})})]})]})}function tS(){return(0,i.jsx)(tw,{})}},9671:(e,t,s)=>{"use strict";s.d(t,{cn:()=>r});var a=s(4584),i=s(2292);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,a.$)(t))}}},e=>{e.O(0,[474,412,347,508,358],()=>e(e.s=1848)),_N_E=e.O()}]);